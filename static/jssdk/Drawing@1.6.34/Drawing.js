"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),version="2019-11-6-18-15",Glodon=window.Glodon||{};Glodon.Version=version,function(){function e(e,t){for(var i=t.split("."),n=e,o=i.length,a=0;a<o;a++)void 0===n[i[a]]&&(n[i[a]]={}),n=n[i[a]];return n}e(Glodon,"Web.Lang.Utility.Namespace").ensureNamespace=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Common"),t=function(e){"string"==typeof e&&(e=JSON.parse(res)),this.code=e.code,this.message=e.message};t.prototype={getErrorCode:function(){return this.code},getErrorMessage:function(){return this.message}},e.Error=t}(),function(){function e(e){function t(){}return t.prototype=e,new t}function t(t,i){var n=e(i.prototype);n.constructor=t,t.prototype=n}Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Type").inheritPrototype=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),t=function(e){var t,i={type:"get",cache:!0,headers:{"Content-type":"application/x-www-form-urlencoded"},data:null,async:!0,success:null,failure:null},n=Object.assign(i,e);t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState){var e=t.status;e>=200&&e<300||0==e?n.success&&n.success(t.responseText,t.responseXML):n.failure&&n.failure(e)}},t.open(n.type,n.url,n.async);for(var o in n.headers)t.setRequestHeader(o,n.headers[o]);t.send(n.data)},i=function(e,t){var i={};if(i[e])t&&t();else{var n=document.createElement("script");n.type="text/javascript",n.src=e,document.head.appendChild(n),i[e]=!0,n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,t&&t())}:n.onload=function(){t&&t()}}},n=function(e,i){return new Promise(function(n,o){t({url:e,method:"GET",success:function(e){try{var t=JSON.parse(e)}catch(t){return n(e)}"success"==t.code||"noCode"==i?n("noCode"==i?t:t.data):o("requestError，dataCode:"+t.code+", dataMessage:"+t.message)},failure:function(e){o(e)}})})};e.ajax=t,e.promiseJSONRequest=n,e.getScript=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.FullScreen"),t=function(e){if(!e)return!1;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},i=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},n=function(){return document.webkitIsFullScreen||!!document.mozFullScreenElement||!!document.msFullScreenElement||!1},o=function(e){var t=function(){e&&e()};document.onfullscreenchange=t,document.onwebkitfullscreenchange=t,document.documentElement.onwebkitfullscreenchange=t,document.onmozfullscreenchange=t,document.onmsfullscreenchange=t};e.fullScreen=t,e.exitFullScreen=i,e.onFullScreenChanged=o,e.isFullScreen=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.ClientHelper"),t=function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),o=/(?:Firefox)/.test(e),a=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||o&&/(?:Tablet)/.test(e));return!(/(?:iPhone)/.test(e)&&!a||n||i||a)},i=function(){return/(?:iPhone)/.test(navigator.userAgent)},n=function(e){var t=function(e){return e.replace("viewToken.json","").replace(/\.\//g,"/").replace(/\/\//g,"/")};if(e.indexOf("://")>-1){var i=e.split("://");e=i[0]+"://"+t(i[1])}else e="./"!=e.slice(0,2)?t(e):"."+t(e.slice(1));return e},o=function(e,t,i){i=i||"asc";var n=!1;t?t.indexOf(".")>-1&&(n=!0):t="name",e=e.sort(function(e,o){if(n){var r=a(e,t),s=a(o,t);return"asc"==i?r.localeCompare(s):s.localeCompare(r)}return"asc"==i?e[t].localeCompare(o[t]):o[t].localeCompare(e[t])});var o=[],r=[],s=[],l=[];return e.map(function(e,i){var c;c=n?a(e,t):e[t],/^[a-zA-Z]*$/.test(c.slice(0,1))?o.push(e):/^[\u4e00-\u9fa5]*$/.test(c.slice(0,1))?r.push(e):/^\d+(\.\d+)?$/.test(c.slice(0,1))?s.push(e):l.push(e)}),l.concat(s,o,r)},a=function(e,t){var i=t.split("."),n=e;return i.map(function(e,t){n=n[e]}),n},r=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},s=function(e,t,i,n,o,a){var r=void 0,s=void 0,l=void 0,c=void 0,u=0,d=Math.sqrt((i-e)*(i-e)+(n-t)*(n-t));if(0===d)return[0,{x:i,y:n}];var h=Math.sqrt((o-e)*(o-e)+(a-t)*(a-t));if(0===h)return[0,{x:o,y:a}];var f=Math.sqrt((i-o)*(i-o)+(n-a)*(n-a));if(0===f)return u=d,[u,{x:i,y:n}];if(d<h){if(n===a?r=i<o?0:Math.PI:(c=(o-i)/f,c-1>1e-5&&(c=1),r=Math.acos(c),n>a&&(r=2*Math.PI-r)),c=(e-i)/d,c-1>1e-5&&(c=1),s=Math.acos(c),n>t&&(s=2*Math.PI-s),l=s-r,l<0&&(l=-l),l>Math.PI&&(l=2*Math.PI-l),l>Math.PI/2)return[d,{x:i,y:n}];if(i===o)return[h*Math.sin(l),{x:i,y:t}];if(n===a)return[h*Math.sin(l),{x:e,y:n}];var g=0,p=0,v=(a-n)/o-i,m=-1/v,y=t-e*m;return g=(a-o*v-y)/(m-v),p=m*g+y,[d*Math.sin(l),{x:g,y:p}]}if(n===a?r=i<o?Math.PI:0:(c=(i-o)/f,c-1>1e-5&&(c=1),r=Math.acos(c),a>n&&(r=2*Math.PI-r)),c=(e-o)/h,c-1>1e-5&&(c=1),s=Math.acos(c),a>t&&(s=2*Math.PI-s),l=s-r,l<0&&(l=-l),l>Math.PI&&(l=2*Math.PI-l),l>Math.PI/2)return[h,{x:o,y:a}];if(i===o)return[h*Math.sin(l),{x:i,y:t}];if(n===a)return[h*Math.sin(l),{x:e,y:n}];var w=0,b=0,C=(a-n)/o-i,x=-1/C,P=t-e*x;return w=(a-o*C-P)/(x-C),b=x*w+P,[h*Math.sin(l),{x:w,y:b}]};e.getIsDesktop=t,e.getIsIphone=i,e.getIsIE=r,e.formatURL=n,e.sortByName=o,e.PointToLineDistance=s}();var Cursor={pan:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABjRJREFUWAnFlstvU1cQxu/1fcR2HMd52DV5kVABUZ4tkIqIx6KRKBKbCqJukKjURbtghSr4S1gg0U2zQqjbthISYkElVCoEIZAQkiYpCXm/4zh+u7+xcoxDbCe0UjvS6B7fO2fmOzPfzLGm/c+i/4v4uXvT/9RPrpNiPpSdY9tIfovKbwmeylGW+xfluNgOsTFQEy1B1R55JyoSQyNoElWA5LlnZpQzbHeJ+iZBJHAZWurz+by2bSfD4XDK7/d/YllWgPWTqampYb7HUQEhgERVZljmFzlVPlHB5buNusvKysrr6uouezyer3UklUrFq6qq3IZhOBYXF58C5Ifl5eUxPqVXV1cX2bOGhtGimVApxG6HCAAJ7kQ9LpfLGQgEWg8ePHj+2rVrrZcuXXItLCykL1686Llx44YvFovVjo2NnaysrLxcXV39LeqLx+PDW1tbm+xXZWG5W4plwMLcS+DGAwcOfEPaewmUxrHW1dXlGR4ettfX1/XS0lK9ubk51tTU5Ozt7fU2NjYat2/f/hzbUTLShw9Virx8yJcBOb2w24WWE7znzJkzX1y/fj1ACSycagQ00un01uvXr9fcbrfe2trqXllZMQFjnjt3zkVJyvr7+xcTicQQ/FjFT8EsqLbCZpcIEAlkojplSJ89e1bDafjx48fh48ePl0HIyhcvXlhwwWhoaNCmp6ejb9++TbS3tyf53klJTuJDyigHVbxi+U4KZUAspDyukpISN+lsOnz48McAcFFrg/o72traTE4XHhkZCQHEcejQIWtoaChO3TXs3PPz85XPnj2bZ+8A79bxJR2xqwz5AGCXQSuI7Wg0Gie19cFgsAUQFt2QJNAGWUmfOHFCuGDCBcfp06ftN2/epMmCduTIEclchNbUKNkc+ie+pEUFxA4pBEAZGbSbTRYkSFVtbW2NnG50dNSizuaxY8eMpaWlyPj4+BYzwQSk/vLlyzCg06dOnfKQhcDAwMBcJBJ5yjtpyV1ZKARA1SuTBRxE6ILG+vr6jpaWFpPej7569WrdNE2ts7PTRUa0jY0NHXBO6Yry8nIDW3NtbS08MTERB/wMJJ0AgOoIdcDsKM2+YKGCqyHkJAslkNCi5BU1NTV+0u2h9hanN7q7u03mgwMSGl6v10EWLDTT3pDTJlPBwcHBWUA8gcBR/EtHZCVfBgSAOHCj3m21IdMqJ68j0KcdHR0G7ZkisF5RUZEJLMGx3SFOp1OHsFF4EmZ+TJOFKQwSaJYL7wOQ4OJIWqeCIdQCu78jnd9zmnaItQSjY2Shivq7JTijF9PCQocIT4JkbGZubu4JlpKFogAEVClaSeDenp6er65evVrNpPsIVjfMzs7WcPpysqAz/zErLtwdDpkNz58/n8dyFF7IU7KQacl8GZB3mSlIBj5jCnZduHChRGbA0aNHTUhlAiRGKRIAlItqT4GgMVo0DJARWnKUDdKSBQEoDrioYenMzEyAU/hhv0XNbSacRurj2223dwqIFAqFUnTKJu3bDykHtwFkypBhKy9yRT5Iu2xMTk7+To2dt27dsql925UrV5yc3BbN3bDXWuYCJIzBoezJ1Z73S6DeS3oESJqaLfCcg0R+xoFfLiJasjjzlJftJyM58uDBgyFK95D/CuO8FiLmLYHaqgBkyEINl0E/wz1QRTqDcEEXcinjYk9mh3b//n0H+hst+QuZXMa+IAlzfeWCSBF4NZlMUpVJH/1cS3sKFwplMOvn3r17oTt37gzRgr+SgT/4ICM5O4z2ciAgxFgQy//AENNsnAvHA5BaukBXU4/vO4SMaY8ePQr39fVtMrZ/JvhdhtkKRjsupb0AiFMFQoAkSWF4c3NzhFrq1LYGcunyR0X+mIixCExPS+CbN2+uwZ2fCP4jo3iaT1uoHCYr2U3ZN/kXYic1F/bLv2MfF5Hcjt1Mui8J3ow6uIgSZMkiWArm9/O8S+8/5ORC5BC66zLaLwD2vvuPwFoGlQCRu8LNPVANKYNMRjcl2qBz/oIzKqj8GZG6Z8rIc4d8CADZKPaiUjoZQnJniMpazRQplbSZUjm1vMvOf9ZZ+VAAslHtkaeURcCIym9RFUw9hUOieUU5y/txHy9z9+euiwbdh9//zuRvyW3yFM73IK0AAAAASUVORK5CYII=",orbit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAB55JREFUWAntlltM1PkVx2eG28ww3EdA5CKgSBXEKO6Klxq3dsFbDTZa120Tre1ufdjY1sRoNqm1aaPxYetjEy/RxLrbpGiiVWQbUPfBW8CqRHe1UapVizCIIMMwwMz0852d34RycdOnvvSXnPld/7/zPed8z/mNxfI/btb/Qr/OjhbzeYjBaDF7b+y/CcBIhTHcNFJszM33QcYBZDjSazwSENPxm7lgvF3tSYmUxiHxiB1JiIxj6bUvRVI8iAwg/ogM0QuIwOnMuG0iALpYIiVSmoi4CgsLv52YmPhOfHx8ZUxMTGYoFEq0Wq2DwWCw3e/33+7v7//86dOnFwcHB19zvh8RIAERCMmYNh4AY7msdiIpRUVFNampqb9IS0vLqKmpCVRXV2fk5ubakpOTLT6fz/LkyZPQ+fPnXzU0NIRe0l69evXJo0ePPufbXsSLyDvjgpgIgNzuSElJmVRQUPA7FK3Ys2dP/Jw5cxzHjh3zXL58OeTxeBKHh4cT4uLifADzLV++3Lpp0yZ3S0uLd//+/UPd3d0NDx48+A3e8HBXXwSE4QbTr9tIABobkeuds2fP3mO323926tSphMOHD3vOnTvnwOK/9vX1Xezt7f2KcY/D4UgDYInL5VrG+LsrVqzwbd++3b1t27ZOADy4d+/eB4Do5D4DYkJOmJiLZC4kIyEhoRgQdZWVlYP0lzIyMr7D+gwkH8lBsiO95jPS09Ory8vLL61atcrT2dkZ2rBhQ0dZWdln7BUjaYiILD1jmhZNzNPz8vLKmE9GpiBTp02b9j59ISKlbkSXpY4QzbWeh5TNnDnzjwLR1dUVWrJkSTcc2sa67hKZFd5o00RuFwChc+Xk5JRkZ2efY9yIq3voffDqPr1YLTIppQTWpKTCpaZUFOOHsb6F0FX29PS4Nm7caL969WoZYOoCgYBSVOcUhnATAGO90KWB9iCuLiC9Sl+8eNHAmlJJIgLpvAtXT83Pz38PoGsYl5KOHvjgYy8MgN4CQb9C6fs7duxIrK+vt6C8DWI+ipzRXWpWXSiRNSnFxcXrsrKyNpw5cybl9OnTqeT6Cz76O3u6WEBd7H+rpKTkL4sXL160evXq+awtGBoa+pBaUO/1epV2utwKniDZUUiWuDHKdvfu3Tg88wV78qIBwPBr5Zkw+S3I5rly5coAFoXUa87625yZguRgbdW8efNCR48e1ZFo03zhwoW9KFzEuVxEpKzAS7tXrlzZifLg3Llz/8Ga7hKXxBkZHaP4hasd+f5zFAaqqqqUBRb18+fP76HCbW9tbf01S8FJkyatgtX+LVu2hM/onBpzy82bN2OoDSvx2LHS0tIavDcbhFnwxwkQq81my2H9o9jY2D7WWwD1KZ8G5FYbLiqnvP4gKSnJtm/fvm5deuDAgW5y26Z1wJWzFMelOQsWLBABx7RZs2bZuVyZE4v7n0PCH5MJVbW1tX7usaxbt65vzZo11aT2T7XPOekO/wQpIJOx9NDZs2cbKDou2G+BAwkUnqsDAwNHtc9ZeDX8L5CLyWPatWvXhrTPxtDjx49bKT5/ev36dXDnzp1yt2X37t1pmmudMt3KkjIh/EgpFjqk2LxNrNoUM9B3KoasVSCKaa5irFiPxwFxQxzhnGrFFHFnAk69xX4mIr02ZYCaQWPjknJevCwywgIQC8xtYl+vmx9vePFU0/37938ESf3t7e2248ePD+CpAaxeDQceck6PzxDnAnjuZXNzc9X69evtW7du7SOt9/HNjch9yoagipApREKUCh++h/z2xIkTacSs/+HDh9+HSF9GPqKzOAGZJ0IS82zy+3lHR0c9Z/7JnpTrYt0ZrisVFRV/4Ow8Fafbt29/wPpLRO+CUjtoPMA43GzkcidkrIWxdizwPXv2bAYKGtlVBZMMQqIeisxN5TVWNzPXi6diJU/qTmWWSBaC/X+jFtRi/YdwQBxRRZXycPxHA7BikU2uu3PnzrKDBw+mNzU1JXHBZFkQ+UhKVEh0iaw1l0mpA0ni7XgHj7QzDkDoLjz1ZwxpY26Um5D/x8Mgt6lZyeXnkKjgxo0b2YcOHXLz/ueotqu8Yq2UyjqBl+gNkeJkSvi06dOnfwKHPnK73VP5Y3IRg7w83V3sy0PmHRCAcBvtAS3KNSE+bsZ9i65fv+44cuSIWw8Lbv8h8S9yOp129mRxAkDzKc9L+If0k8zMzI/Xrl2bRg1JqqurK+JfVAyuv8Q5pa6Uh++mjzZjtVnQ3Fjlogi5qfu/Iv2qd+3aFUeqOU+ePNnV2Niov14O3gAH7vVjrXfp0qXWzZs3u2/duuXbu3fvIFbXkxkfA1x/RnyIwhaOO320jQagjXB1pJdrxeRksuJdrPkl1qfzf9BKfU9VeYUrFhRZ+CMa5P9g14ULF2IIXxfe+z3F5gLf6jkfE3fWom08ANo0IMy778QbSbh5Ge5/l3JaQQiyqenxPNte4txBhWsmg5ra2tq+4HulmVJy3LizHm0TAdAB7RmyCYgeIInqhbwjDuiMCBVOT3rFWkpNdsjtUcYzHtPeBECHtW/EsF6KNRY4NcVVSqRspBjCjYk756LtmwBEDzIwQEb2Zn+kMjM2e//v3+iBfwN/OI2ZyYaa1QAAAABJRU5ErkJggg==",measure:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAbCAYAAAH3zbSEAAAAAXNSR0IArs4c6QAAAn5JREFUSA29lr9uGkEQxu8A47MTKSf5j2RbjnDhAAUVVKbhBeiiNHmLPIxbt64i+QF4A3iBpEiUIkWUCEVBcSz/uXy/1S1aH3fxcoKM9LG7szv77c7MzhEEQRAKFWEutXkvCKoMqkmS3Foly+vCa6ugjdwBm907imoo+8QqwjCMavp5axVqzWTUarWuNKg6E/MurJvCS2F+lHR2Q+0XFkSiuU6VjxrRbaHg3OyyIJVut3sj7cHCjBTWOZ+zkzJKrLMa2UnGISvyJtAZy/F4vDDf6/VMUAaaOVyYDYKv6OpsPZ1Ok06nc6Hxs5yFharNfr9/qdmGkOvuIksTBjH/KVpQpJ9MJhF+fCha8ITe2EXcOU/+pdfGhrmQIC8E7mLuDEgzmwrufFGfI99iiIcJNv27FGqeliPuOhwOyekTwZu9KSPSeSAslRg8r7NljbhXLNBOBR/ZZhFOiRW7Tz4Wdo0y6QSmhrArfBd8xKzFcE+M33ws7Box7mN4qmh8sEqfVmXnFTHzjpuzaaWMkbEvbUg4ZjrzG7Uku49Qi2c4x01yH0PK4p013FJIfmWt4jg+H41G76SHpWzlyG5rxnwETqkaVFAeS7vdfi8duX8k8D0r7UfZ5gqbGtKUbKBxQ+CFLlWFtd5LcC+BfCHwQCkJPFDqifuB1rC0wAHwFiFK6KCoyb0fUQgIB8EDqwAeO9D+5MWesEHqQmyLXUv9mUC5XZXA8TzdjPYnt+QfxU6K3yiFVZMSPurljxSG9JjsdWUdYxEeC3VcC0zVVrtugQc+kyzN7M3cW6+iz/7iasJnWGH+n0JmcQJT4vj3t2Yx75Tsperwx9hm2DpuD5l9Gdd/AVIlXMI9fgkPAAAAAElFTkSuQmCC",section:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABBpJREFUWAntVUtLG1EUniRjEo2amKjVxBiFqlAXRUVFEBFKF6KLgii47kIKXVX36rra0lXRnd1IFftYqFAoBFyJ2AdUixqoMU18a3ylSZwk/b6pCRmfP6AZuJlz7znfd8797rkTQUg9KQVSCqQUSClwgwKxWEzV0NBgrq6u/tbf36/m/IZw2cUYxhJD7G0Y9XWEJGlsbKw5Ozv7qlKp7h8eHuoGBgZuLYAxjCWGWHKQ67o8VxISMDMz8yASiUyUlZUZV1ZWhNra2jvRaPTAarVGpqamHsF+AVLHObFbrVY/a21t/eDz+TSwc+bn57fKy8uF1dXVQ41G09HS0vIZvNGLhVyqjMmR4LEkSZ/a2tqMw8PDMgZzQzgc1kxPT7cj+WRzc7ODPg7aXKOPMYwliD5ykIucVymhKKCjo4MJXoFspKurS+jr6xOysrLkAtLS0rSwtfANIaEwODgo1NTUyIM21+hjDGMJIpYc5CInuZlDJjz/kQtgo9TV1VnW1tZGIftTVCr09PQkxwk4U7Xb7S5ErJ2EFx+u0RcKhQyMTfaTi5zkZg7mijenHNjZ2aluamoK4ux0ycBkGzvQYGeyHNzZdQ+SZzL2Oj9zMBdzMkb+qaysVB0dHaVXVVU9B/l7Vjs0NKTg4K4sFksIBDsjIyMKHydjY2MCfUjOY1I0N7nISW7mYC7mJE4hFSSKVVRUvMvPz39LQlwp4fj4mHGJJzc3943T6RR6e3uFhYUFgTeENtfgG00EwiCWHOQiJ7mZIzlGPJ/wegS0Wu02Agx2u33GYDD40LlPlpeX9YzBmUUxwkVFRU7s1DQ7O9uOpCb6cM38BQUFkzabzQmlwhjyUXZ3dwsulytYWlr62mw2f8f6b+bA9yEAmHwlE1KxOx0Ohx7yWJDADhkdfr+/en19vQsAa319/T1cJz9IbPDdxTsfI50FoLA/GNvAufD2iqJompubW0LP+IqLi8dMJtMX+NzAebKzs/fQzMGJiYkIsYlmWVpaimEHUcgYCgQCQZBIOp3uBIAf+/v7FbA/Go3GDRTBZpWADeN9iiL8SLoF28PkiDvd3d214mv4EB+ilzj3n/D9wvdhHfaex+MJxZOzgIQCnPBBs6hxVbR6vT4bUxtIefUkyOzC2sbBwUEMdgZGJpLLUsMfwtGdYARycnJUwWCwEDZVEjE2wOPF2lFJSUkY/Iqv4aUC4kXgLe7s7GShcgtsqJm2h/k+uldaXFwkToNzl/Gbm5tsrAh8MfjEvLw8M46NuDOc+R7m7GTpYnKsXVaAi3ywKxWaCCch6kAi4ljC2L1Cvn+Ryl/2ElTQZWRkaFE8TkwK4ZMsQQlF98dRimsYX+SbAAJxfQJer/cYf0LB8fFxhXzJ8XGbMYwlhtibkscxqXdKgf9bgb8e4D98kWiZrgAAAABJRU5ErkJggg==",rotate:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABUhJREFUWAntVmssZGcY/s6YGYPBYC3WfRsqS2tTiawUcUuUSFRdE3GtS2ormuxqJEK1iR9t0jaSjVtRIUII5U9VdhsjVSl1DSK2a+LaDcZl3OZiZk6fz8ZkzVKxPzZp6kuO855z3u99nu95L4OQ63WtwLUC/3cFmNcRIDMz03Rra0skEAiER0dHips3b8rq6up2GIZhrxrvUgIsy3KioqLeR/APARimUChcNRoNTIHa0NBQe3x8zCiVSgO1Ws2YmJisarXaYfh0ubq6/lJZWXlwGaELCZSVlXFHR0fvczicInNzc7PAwECBj48Px9nZmQCYQAGyvb1NhEIhsbKyInw+n6yurpLZ2Vl2YGBAvrCwwPB4vEYjI6MvW1tb1y8ici6B6OjoOzhxN8CcsrKyDHEqIhaLWRBiKKiBgQExNjYmUIHFycnh4SEjl8uJqakp8fT0ZAMCAhh3d3fS1dWlefLkiRyHyOru7m4/L0WvEEhMTPRCXoeys7OFLi4uTEVFBQVg7ezsjmxsbGQikUiFQMc4kQx3KrEAlzlSZQQ/7vr6unBzc9Nsd3eXk5aWRtzc3EhxcTHdc7+zs7Nen8QZAjU1NbzHjx9PJycnvw1H0tzcTLy8vKT29vbzAOjFyf/AXQK5VVBFg2ct8s/A5oAED8+2qA8f7P1AJpO9NzMzc8vJyYmTnp5OCgoKlI6Ojneqqqok8NUtrs6CMT4+7ge53vL29iYPHz5kkfdZSP0Nl8sVA3gXEivj4+OP9U9xGqO/v//vlZWVWZDqsrCw8PLz8/tseHg4fGxsjBcSEsIfGhr6tL29vTAhIUFzukdHAJu5TU1N9yA7B8yJtbX1HgroE+R5IiUl5egi0NNA9B4cHKzGjV6HANpBGlZsbW2tRkZG7gUFBTGTk5OB6BCaskNcJ4tKd7JQRAaQ6HBpaYnx8PAgGxsbgsXFRem/gUNaUWRk5HdQ50wqaUCcUgXya8vLy3ykkSAuLVo1UsR7gfjir44ATqtB1Y/jpGq0EImJieHPzc39FhsbG3QeAN67geQo/JMaGhqELweldlJS0q2enh6aCu/Q0FCmr6+PxWwQY1ZQhXRLR4DKh7V49+7dP6urqwmKh3nw4MEN5P9ngI2iNSMpEXrBDkOeJ8LDw28joAj9bkQj5ufnm2FoJcfFxfXu7+8v4HtYYWEht6ioiHbDhqWl5U9IrUKHDuOMdMgbH3kLRK8/Qs+7gwyDjiD19fWap0+ftkdERGSinz/Gvm9LSkoM6QDKy8tjUagSTEQrlUolxCnVyLcAs4BgIJG2tjaCmSAFga9B/ofc3FzZhQToB7SiMWQNQLAvnj179g7qQAibBZnK+fn55wcHB1+hlTgAIrDJ1NQULViCaUnoUKLpGxwcJKh+ggJUA3gJs+MRWrQlIyNDql/MZxSgBKjEvb29/LW1tduwY1E0CSBhgUD5GFDWExMT30N2k/LycoJnUlpaSjB4TsjQsQyZtbgOHBwctqGMGG39I2JM5eTk7OmDU7xXCNCXdAGc09LSQn/tbPHoiUADeGcOu2x6evojgAoxLQl+cFhfX99NFDH9cdqBz1/w6Yf/7xhQS7BlkJ1OznPXhQROvSmRxsZGPlpO2dHRwdnZ2bFH8ByJRJID+a0BrESxxaFYJZBZhj5X4p0cLad4eeCcxtO/X0pAfwMlhBF9A3MjRiqVfg41RCjOd1NTU59DYq2+/2XPukl4mePpdwoCEpu1tbVt+Edkxd/fPxwdIH8dcBrzygToJlpMWHso1l9RrGNmZmZnWov6vLEFIldO4xsjdw30n1DgH4y0hp8mM/gUAAAAAElFTkSuQmCC",translate:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABLxJREFUWAntVllIZEcUvd1jOxrbNW7jihoRxQWhjaKixiUS42DEBZn8iCGifghxIWAQhsjgR0JIPiL4pRkTFDU/CsK4oOJCUHFBUVEEcUSNg6Ktjt3a7cupgtdp5fXrkTDkx4LuV6+We86799xbRfTQHjzwP3tAcR/8oqIij/Pz8xfY461Wq+svLy81RqPxCfq/9fT0vLmPLXGtUuxYe1ZVValPT0836urqvi4sLHx6cnKyEBQU9HtmZuYPZ2dnf7W1tdlZsyE1b9UDgiAo8vPz47C5VK/XV/b19XE7JSUl1NjYSDExMVRTU0MHBwcVIPgYk64RERE/ol1IAd4ds+qB4uLiGGyazMvLq3RwcKCZmRmysbGhtLQ0WllZ4faysrLo6Ojo19jY2F/S09Ofr66u9nR3dz+6Cyb1LktgdHTUxtbW9llSUpKqtLSUysrKaGhoyAQq9lNSUugRWkVFBdXW1pK/v/9nS0tLPlKAd8dkCWxsbNgGBgbqxC9lQAsLCwQhUlhYGCkUClpbWyPmmcTERAKoidzOzk4hwidrny22tuA6ODh4XKvVGkQgjUZD4+PjHAgCpOHhYROo2EcYCCL9tqOjw55PyvzJEigvLzeoVKp1X1/f16Jxc1DWZ2QMBgMxYru7u7S/v0+urq4UGRnptbi4+JEMNp+SJQAXCzCuBYHesbExDhQXF2cC8vLyooCAAC5MSIALc2RkhBtm5EColOlIjoQsAbYRIbh0c3P7E57QswxgQKmpqSQCsQyYnp7mGNnZ2TQ/P8/7TBPX19eV0JEDH7DwJ5kqLPchqE8hwJdTU1NPUe0mXVxcPt7b23vCwJ2dnQmVj3JzcykkJITXAmQLgShlZGSQUqnkqQoh2kA7r+bm5rYt4EsPI4ft8TVabBT6+/uFnJycNw0NDT8D8AZVD/wE4fj4mD/l/iYmJoSCgoKXra2tKmkkC1mAiucCl9v7+fnxr0TFc0cqfoWvNIgZwIRmrYWHh5NOp/scaWoxGyQ1AOEJUPVmfX09F1xCQgI1NTWpMa4Ss8EaOJt3cnKim5sbR/wsnhOSBLD3xMfH5zkq2t+szq+vr1N0dDShvrOaTzgF3wWfLi4uuBawXlJrzIgkAZRdPWL7Cqfdd1FRUbuIP0+10NBQ6uzsJHt7ix69RWxra4twVL9F6IRbE2YvkgRY/qMIaeG6Xm9v79r4+PjN5uZmQaz9Zvtlu4ODg+Tp6bmJrLi2tFCSAFsskkD6Dbi7u1cnJycvtbS0CF1dXZZs3RpHBtHs7KwRafoHbOluTZq9vNN9ADlvh7Neg1i+mJycxOGYpGQnH8t9qXZ4eMhPRWTBLLT0JUK6BRI3UmstekBczDyBO8ElyvEMYv8N7gEDy8vLV9XV1bwCokiJS+nq6ooGBgaIzaFE73t4eHyPydeWwNlGqx4wWUeHFRRcRoKRjlU4dJ5BZG4oTEoA8WXsIIJQdXD7NrzzE4TczbTEPsLcjnn/XgTYRnbTQXH5EMXqEwB8AaEmIDQfgJjRzs7uAEt6AdiHGrCNS+yFHDizd28CbBOAFe3t7Y/hcjUU7oifE7yiBwktps8cHR3fImz/xoZtel+NkWFewdOqnt4Xhwe7/8kD/wDeTzMCbKkf6QAAAABJRU5ErkJggg==",zoom:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAA6pJREFUWAntVltIk2EY/rZ/bO7gNCx1aswrYzSGkKAYIUE3mg6TlPBwIcEoJnRVkCFOJAblTeAo5lUIEi5spLCbBCUSBIOh1KAbldIxSZdzOZ079L6jf/yb23/q0n7Yvu89Ps/3fkdC/n9nvQLUvxSgp6enqqKiwt3Q0DC/trYWEpNLKiYIY/r7+y/s7e3NG43G69iiLCaXKAI2m00TCAQ8bW1tNWNjYwRblFEvhoSgGACRt7S0zNvt9iTzQxn1aBeUUIgzAEpbW1tdg4ODyVgsxsRPyahHO/rxzSvh64hJodSOo6Oje3TMxMQEqa6uJuvr68RisdBqUlBQ8Gp2dtYqkUgSaWWejiyP/pTa5XKpzGbzVzB4gUzZzMyMrry8POWn0+kIRVGko6PDD6ABUH5Ff2jDKQeWP96l6uzsPFSpVK8B6ObW1tZdrVaLI02lxhZl1KMd/dCfBTdt4k0Ay9nb2xsqLCwM+P3+Mhw180MZ9WhHPz7lx3jeBBhgVDweN+YigHrwE3S4CSYQDAZlJycnNbkIoB7tDLKcXcEE1Go1EtDnIaBHOycqw0EwAZhbKhqNlsEdwEhDCBJCPdozDByCYALHx8cy+BVnVwAJoR7tHJgZZsEEYKtpEomEoqSkJCMRyqhHe4aBQxBEAA4gCWy1S9mjpzFQj3b0o3VcrSACCwsLFJTYxEYA7ejHBUzbWZniSOByeQBJn0NAem7b29uJ1Wqlc6Rbh8NB3G53WoZOTKFQPJybm3sBizPJNNB9VgLT09PK/f19M8zrk5WVlctw4eCFRMfmbeEiIk6nM1FXV/elsrLyaVFR0fuurq5IrgBWAliBqamp4nA4fOPg4MC2tLRkaGpqkgwMDBCp9PTswSIk4+PjZHFxMdnY2OiDY9mm0Wg+dHd3/xJVAWSMJCYnJ1Wwx6/AVWxbXl6+VlpaKhseHiYAkB4UECQjIyNkZ2cnVl9f/xEuKJtcLv/c19d3mA8cg1krkM4OHZgOeSgUqoHz/tHq6upt6CtHR0eJXq8nm5ubZGhoCG/EiMlkegs34jPof4OyR5k5cvV5E8BgIEEBcBWQsGxsbNz3+Xzn4A1A4G1ADAZDEB4nLwHcCeA/ADyeCzBbJ4gABsOUSGFKzkcikVu7u7uPvV7vxdra2u9wENmVSuU7KPlPKDnnS4gmIpjAXxISWOVaWIhXgdAdAHwDC/AT7BJ8B+TcbjRgdiuKAE3C4/HIt7e31XAP/G5ubo4KBc8mczblP8eTrmVjlSb0AAAAAElFTkSuQmCC"};if(function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.MouseMotion"),t=function(e){function t(){i&&"walk"==e.getViewer().getEditorManager().editor.name||(n.addClass("motion-zoom"),o=Date.now(),setTimeout(function(){Date.now()-o>180&&n.removeClass("motion-zoom")},200))}var i=!1,n=e.getDomElement(),o=void 0,a=!1,r=!1,s=null;Glodon.Bimface.Viewer.Viewer3D&&e instanceof Glodon.Bimface.Viewer.Viewer3D&&(i=!0),n.addEventListener("keydown",function(e){17==event.keyCode&&(a=!0)}),n.addEventListener("keyup",function(e){17==event.keyCode&&(a=!1)}),n.addEventListener("mousedown",function(t){e._opt.enableZoomRect||a||(s={x:t.clientX,y:t.clientY})}),n.addEventListener("mousemove",function(t){if(s&&!r&&!(Math.abs(s.x-t.clientX)<2&&Math.abs(s.y-t.clientY)<2)){if(i){var o=e.getUseLeftHandedInput();"walk"==e.getViewer().getEditorManager().editor.name?1==t.buttons&&n.addClass("motion-rotate"):1==t.buttons?n.addClass(o?"motion-rotate":"motion-translate"):n.addClass(o?"motion-translate":"motion-rotate")}else 1==t.buttons&&n.addClass("motion-translate");r=!0}}),n.addEventListener("mousewheel",t,!1),n.addEventListener("DOMMouseScroll",t,!1),n.addEventListener("mouseup",function(e){s=!1,r=!1,n.removeClass("motion-translate"),n.removeClass("motion-rotate")})};e.setCursor=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e,t){var i=document.createElement(e);return i.setAttribute("class",t),i};e.create=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);return i.setAttribute("class",t),i};e.createNS=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e){return e.indexof("#")?document.getElementById(e.replace("#","")):e.indexof(".")?document.getElementsByClassName(e.replace(".","")):document.getElementsByTagName(e)};e.select=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),i=function(e){var i={element:null,handle:null,axis:"all",cursor:"move",distance:0,start:null,move:null,stop:null},n=Object.assign(i,e),o=n.element;if(!o)return!1;var a=n.handle||o,r=void 0,s=!1,l=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(n.distance,2)&&(n.start&&n.start(r),!0)},c=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e},u=function(e){var t=o.offsetLeft,i=o.offsetTop,a=t+e.x<0?0:t+e.x,r=i+e.y<0?0:i+e.y;switch(n.axis){case"x":o.style.left=a+"px";break;case"y":o.style.top=r+"px";break;case"all":default:o.style.left=a+"px",o.style.top=r+"px"}},d=function(e){var i=e;if(t){if(!c(i.button))return;r={x:i.clientX,y:i.clientY},document.addEventListener("mousemove",h)}else r={x:i.touches[0].clientX,y:i.touches[0].clientY},a.addEventListener("touchmove",h);n.start&&n.start(r)},h=function(e){var i=e;if(t)var o={x:i.clientX,y:i.clientY};else var o={x:i.touches[0].clientX,y:i.touches[0].clientY};var a={x:o.x-r.x,y:o.y-r.y};s?(n.move&&n.move(r,o,a),r=o,u(a)):s=l(a)},f=function(){s&&n.end&&n.end(r),s=!1,document.removeEventListener("mousemove",h),a.removeEventListener("touchmove",h)};t?(a.style.cursor=n.cursor,a.style.userSelect="none",a.addEventListener("mousedown",d),document.addEventListener("mouseup",f)):(a.addEventListener("touchend",f),a.addEventListener("touchstart",d))};e.drag=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(t){var i={element:null,axis:"all",minWidth:100,minHeight:100,distance:0,start:null,sizable:null,stop:null},n=Object.assign(i,t),o=n.element;if(!o)return!1;var a,r,s=void 0,l=!1,c=e.create("div","bf-resize"),u=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(n.distance,2)&&(n.start&&n.start(s),!0)},d=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e},h=function(e){var t=o.offsetLeft,i=o.offsetTop,s=a+e.x<n.minWidth?n.minWidth:a+e.x,l=r+e.y<n.minHeight?n.minHeight:r+e.y;switch(n.resize&&n.resize(s,l),o.style.left=t+"px",o.style.top=i+"px",n.axis){case"x":o.style.width=s+"px";break;case"y":o.style.height=l+"px";break;case"all":default:o.style.width=s+"px",o.style.height=l+"px"}},f=function(e){a=o.clientWidth,r=o.clientHeight;var t=e;d(t.button)&&(s={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",g),document.addEventListener("touchmove",g))},g=function(e){var t=e,i={x:t.clientX,y:t.clientY},o={x:i.x-s.x,y:i.y-s.y};l?(n.sizable&&n.sizable(s,i,o),h(o)):l=u(o)},p=function(){l&&n.end&&n.end(s),l=!1,document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",g)};o.addClass("bf-sizable"),o.appendChild(c),c.addEventListener("mousedown",f),c.addEventListener("touchstart",f),document.addEventListener("mouseup",p),document.addEventListener("touchend",p)};e.sizable=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(t){var i=this,n={element:null,min:0,max:100,cur:50,step:1,isShowProgress:!0,input:null,change:null,currentColor:"#11dab7",defaultColor:"#999"},o=Object.assign(n,t);this._opt=o;var a=e.create("div","bf-range"),r=e.create("input","bf-input-range");i.input=r,r.setAttribute("type","range"),r.setAttribute("step",o.step),r.setAttribute("min",o.min),r.setAttribute("max",o.max),r.setAttribute("value",o.cur);var s=e.create("span","bf-range-min");s.innerText=o.min;var l=e.create("span","bf-range-cur");i.cur=l,l.innerText=o.cur;var c=e.create("span","bf-range-max");c.innerText=o.max;var u=e.create("span","bf-range-progress");a.appendChild(r),o.isShowProgress&&(a.appendChild(s),a.appendChild(l),a.appendChild(c)),a.appendChild(u),o.element.appendChild(a),i.setProgress(o.cur),r.addEventListener("input",function(){i.setProgress(this.value),o.input&&o.input(this.value)}),r.addEventListener("change",function(){i.setProgress(this.value),o.change&&o.change(this.value)})};t.prototype.setProgress=function(e){var t=this._opt,i=t.max-t.min,n=this.input,o=this.cur,a=(e-t.min)/i*100;n.value=e,n.style.background="linear-gradient(to right,"+t.currentColor+" 0%,"+t.currentColor+"  "+a+"%,"+t.defaultColor+" "+a+"%, "+t.defaultColor+" 100%)",o.innerText=e},t.prototype.reset=function(){this.setProgress(this._opt.cur)},e.range=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e){var t={element:null,min:0,max:100,from:null,to:null,step:1,currentColor:"#11dab7",defaultColor:"#999",change:null};this._opt=Object.assign(t,e),this._opt.from=this._opt.from||this._opt.min,this._opt.to=this._opt.to||this._opt.max,this.init()};t.prototype={init:function(){var t=e.create("div","bf-multiple-range"),i=e.create("div","bf-range-track"),n=e.create("span","bf-slider bf-slider-min");n.id="minSlider",n.type="minimum";var o=e.create("span","bf-slider bf-slider-max");o.id="maxSlider",o.type="maximum",this._state={from:this._opt.from,to:this._opt.to},i.style.backgroundColor=this._opt.currentColor,t.style.backgroundColor=this._opt.defaultColor,t.appendChild(i),t.appendChild(n),t.appendChild(o),this._opt.element.appendChild(t),this._track=i,this._sliders={min:n,max:o},this._element=t,this.bindEvent(),this.update(!1)},bindEvent:function(){var e,t,i=this,n=!1,o=function(i){var i=i||event;t=i.screenX,e=this,n=!0},a=function(o){if(n){var o=o||event,a=o.screenX-t,r=Math.round(a/i._pix/i._opt.step)*i._opt.step;0!=r&&(t=r*i._pix+t,"minimum"==e.type?i._state.from+=r:i._state.to+=r,i.recalculate(e),i.update(!0))}},r=function(){e=null,n=!1};this._sliders.min.addEventListener("mousedown",o),this._sliders.max.addEventListener("mousedown",o),document.addEventListener("mousemove",a),document.addEventListener("mouseup",r)},update:function(e){var t=this._sliders.min.offsetWidth,i=this._sliders.max.offsetWidth;if(!this._pix){var n=this._element.offsetWidth,o=this._opt.max-this._opt.min,a=(n-t-i)/o;this._pix=a}var r=(this._state.from-this._opt.min)*this._pix,s=(this._state.to-this._opt.min)*this._pix+t+i;this._track.style.left=r+t/2+"px",this._track.style.width=s-r-t/2-i/2+"px",this._sliders.min.style.left=r+"px",this._sliders.max.style.left=s+"px",this._opt.change&&e&&this._opt.change(this._state)},recalculate:function(e){this._state.to>=this._opt.max&&(this._state.to=this._opt.max),this._state.from<=this._opt.min&&(this._state.from=this._opt.min),e&&("maximum"==e.type&&this._state.to<=this._state.from&&(this._state.to=this._state.from),"minimum"==e.type&&this._state.from>=this._state.to&&(this._state.from=this._state.to))},getProgress:function(){return this._state},setProgress:function(e){this._state=e,this.recalculate(),this.update(!1)}},e.multipleRange=t}(),function(){var e=function(e){var t,i;this.addEventListener("touchstart",function(e){t=Date.now()}),this.addEventListener("touchend",function(n){(i=Date.now())-t<200&&e(n)})};HTMLElement.prototype.tap=e}(),function(){(window.ActiveXObject||"ActiveXObject"in window)&&(HTMLElement.prototype.remove=function(){var e=this.parentNode||this.parentElement;e&&e.removeChild(this)},window.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,i=(t.parentNode||t.document).querySelectorAll(e),n=-1;i[++n]&&i[n]!=t;);return!!i[n]}}(Element.prototype),window.Element&&function(e){e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(Element.prototype))}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.UUID"),t=function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")};e.createUUID=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang"),t=function(){this.container={}};t.prototype.addEvent=function(e,t){return"string"==typeof e&&"function"==typeof t&&(void 0===this.container[e]?this.container[e]=[t]:this.container[e].push(t)),this},t.prototype.fireEvent=function(e){if(e&&this.container[e]){var t=Array.prototype.slice.call(arguments);t.shift();for(var i=this.container[e].length,n=0;n<i;n++){this.container[e][n].apply(null,t)}}return this},t.prototype.removeEvent=function(e,t){if("function"==typeof t&&"string"==typeof e){var i=this.container[e];if(i instanceof Array){for(var n=0,o=i.length;n<o;n+=1)if(i[n]===t){i.splice(n,1);break}0==i.length&&delete this.container[e]}return this}},e.EventManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Geometry"),t=function(e,t,i){this.x=e,this.y=t,this.z=i};t.prototype={get:function(){return{x:this.x,y:this.y,z:this.z}},set:function(e,t,i){this.x=e,this.y=t,this.z=i}},e.Point3d=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Geometry"),t=function(t,i){var n={},o=new e.Point3d,a=new e.Point3d;return o.set(t.x,t.y,t.z),a.set(i.x,i.y,i.z),n.min=o,n.max=a,n};e.BoundingBox=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility"),t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t};e.RGBToHex=t}(),!hostConfig)var hostConfig={APIHost:"https://api.bimface.com",resourceHost:"https://m.bimface.com",staticHost:"https://static.bimface.com",dataEnvType:"BIMFACE"};!function(){function e(e,t){function i(e){return"FloorPlan"==e||"CeilingPlan"==e}if("DrawingSheet"!=t.viewType)return null;var n=t.viewInfo,o=n.preview.width,a=n.preview.height,r=n.outline[0],s=n.outline[2],l=n.outline[1],c=n.outline[3],u=s-r,d=c-l;n=t;for(var h=n.portsAndViews,f=0;f<h.length;f++){var g=h[f];if(i(g.viewType)){var p=function(t,i,n,s,c){var h=e.x/o,f=(a-e.y)/a;if("Elevation"==c.viewType){f=(o-e.x)/o,h=e.y/a;var g=c.viewPoint.viewDirection;1!=Math.round(g[0])&&-1!=Math.round(g[1])||(h=(a-e.y)/a)}var p=(t-r)/u,v=(i-r)/u;if(h<p||h>v)return null;var m=(n-l)/d,y=(s-l)/d;if(f<m||f>y)return null;var w=(h-p)/(v-p),b=(f-m)/(y-m),C=((c.outline[2]-c.outline[0])*w+c.outline[0])*c.viewPoint.scale,x=((c.outline[3]-c.outline[1])*b+c.outline[1])*c.viewPoint.scale;return new THREE.Vector3(C,x,0)}(g.viewport[0],g.viewport[3],g.viewport[1],g.viewport[4],g);if(null!=p){if(i(g.viewType))null!==p&&(p.z=g.elevation);else if("Elevation"==g.viewType){var v=g.viewPoint.viewDirection,m=g.cropBox;0!=Math.round(v[0])?null!==p&&(p.z=p.y,p.y=p.x,p.x=v[0]<0?m[3]:m[0]):0!=Math.round(v[1])&&null!==p&&(p.z=p.y,p.y=v[1]<0?m[4]:m[1])}return p}}}return null}function t(e,t,i){if("DrawingSheet"!=t.viewType)return!1;var n=t.preview.width,o=t.preview.height,a=t.outline[0],r=t.outline[2],s=t.outline[1],l=t.outline[3],c=t.portsAndViews;for(var u in c){var d=c[u]
;if("FloorPlan"===d.viewType){var h=d.viewPoint.scale,f=d.outline[0]*h,g=d.outline[2]*h,p=d.outline[1]*h,v=d.outline[3]*h;if(!(e.x<f||e.x>g||e.y<p||e.y>v)){var m=(e.x-f)/(g-f),y=(e.y-p)/(v-p),w=d.viewport[3]-d.viewport[0],b=d.viewport[4]-d.viewport[1];i(n*((d.viewport[0]+w*m-a)/(r-a)),o-o*((d.viewport[1]+b*y-s)/(l-s)),d)}}}return!0}var i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility.Relation"),n=function(e,t,i){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/views.json",success:function(n){var o=JSON.parse(n).viewList,n=[];for(var a in o){var r=o[a];r.viewType==t&&(r.preview.path=hostConfig.resourceHost+"/"+e+"/"+r.preview.path,n.push(r))}i&&i(n)}})},o=function(e,t,i){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/drawings.json",success:function(e){for(var n=JSON.parse(e).drawingList,o=0;o<n.length;o++){var a=n[o];if(a.viewInfo.id==t){i&&i(a);break}}}})},a=function(t,i){if("DrawingSheet"==i.viewType)return e(t,i);if("FloorPlan"!=i.viewType)return console.warn("Not support yet!"),null;var n=i.preview.width,o=i.preview.height,a=i.outline[0],r=i.outline[2],s=i.outline[1],l=i.outline[3],c=r-a,u=l-s,d=(0-a)/c,h=l/u,f=(t.x-n*d)/n,g=(o*h-t.y)/o;return f=f*c*i.viewPoint.scale,g=g*u*i.viewPoint.scale,new Glodon.Web.Geometry.Point3d(f,g,i.elevation)},r=function(e,i){var n=[];if(t(e,i,function(e,t,i){n.append({x:e,y:t})}))return 0==n.length?null:n;if("FloorPlan"!=i.viewType)return console.warn("Not support yet!"),null;var o=i.preview.width,a=i.preview.height,r=i.outline[0],s=i.outline[2],l=i.outline[1],c=i.outline[3],u=s-r,d=c-l,h=(0-r)/(s-r),f=c/(c-l),g=e.x/(u*i.viewPoint.scale),p=e.y/(d*i.viewPoint.scale);return g=g*o+o*h,p=a*f-p*a,{x:g,y:p,z:0}};i.getViews=n,i.getDrawingSheets=o,i.point2DToPoint3D=a,i.point3DToPoint2D=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility"),t=function(e){var t=new Image;return new Promise(function(i,n){t.onload=function(){i(t)},t.onerror=function(e){n(e)},t.crossOrigin="anonymous",t.src=e,!0===t.complete&&i(t)})};e.ImageContainer=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics"),t=Glodon.Web.Graphics.Utility.RGBToHex,i=function(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n},n=function(e,t){/^#[0-9a-fA-F]{6}$/.test(e)&&(this.red=parseInt(e.slice(1,3),16),this.green=parseInt(e.slice(3,5),16),this.blue=parseInt(e.slice(5),16)),"number"==typeof t?(t>1&&(t=1),t<0&&(t=0),this.alpha=t):this.alpha=1},o=function(){arguments.length<4?n.apply(this,arguments):i.apply(this,arguments)};o.prototype={getRGB:function(){return"rgba("+this.red+","+this.green+","+this.blue+")"},getRGBA:function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")"},getHEX:function(){return""+t(this.red)+t(this.green)+t(this.blue)},getAlpha:function(){return this.alpha}},e.Color=o}(),function(){SVGElement.prototype.getClass=HTMLElement.prototype.getClass=function(e){return this.getAttribute("class")},SVGElement.prototype.hasClass=HTMLElement.prototype.hasClass=function(e){var t=this.getClass();return!!t&&(t&&t.split(" ")).indexOf(e)>-1},SVGElement.prototype.addClass=HTMLElement.prototype.addClass=function(e){var t=this.getClass(),i=t&&t.split(" ");return t?-1==i.indexOf(e)&&(i.push(e),t=i.join(" "),this.setAttribute("class",""+t)):this.setAttribute("class",""+e),this},SVGElement.prototype.removeClass=HTMLElement.prototype.removeClass=function(e){if(!this.hasClass(e))return this;var t=this.getClass().replace(e,"").trim();return t?this.setAttribute("class",""+t):this.removeAttribute("class"),this},SVGElement.prototype.toggleClass=HTMLElement.prototype.toggleClass=function(e,t){var i=(this.getClass(),this.hasClass(e));return void 0!=t?(t&&!i&&this.addClass(e),t||this.removeClass(e)):i?this.removeClass(e):this.addClass(e),!i}}(),function(){Array.prototype.getObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0;o<n;o++)if(i[o][e]==t)return i[o];return!1},Array.prototype.removeObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0;o<n;o++)if(i[o][e]==t)return i=i.splice(o,1);return!1},Array.prototype.getAllObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0,a=[];o<n;o++)i[o][e]==t&&a.push(i[o]);return a},Array.prototype.removeByValue=function(e){for(var t=this,i=t.length,n=i-1;n>=0;n--)t[n]==e&&t.splice(n,1);return t},Array.prototype.insert=function(e,t){return this.splice(e,0,t),this}}(),function(){SVGElement.prototype.setCss=HTMLElement.prototype.setCss=function(e){if(e)for(var t in e)this.style[t]=e[t]},SVGElement.prototype.getCss=HTMLElement.prototype.getCss=function(){return this.style}}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Authentication"),t=function(){return{APIHost:hostConfig.APIHost,viewToken:null}};e.AuthenticationConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Authentication"),t=(Glodon.Web,Glodon.Web.Lang.Utility.HttpRequest),i=function(e){this.config=e};i.prototype.authenticate=function(e,i){var n=this,o=n.config;t.ajax({url:o.APIHost+"/inside/databag?viewToken="+o.viewToken,success:function(t){var a=JSON.parse(t);"success"==a.code?(a.data.viewToken=o.viewToken,n.data=a.data,e&&e(a.data)):i&&i(a)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.AuthenticationManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.MetaDataManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest.promiseJSONRequest,i=Glodon.Web.Lang.Utility.HttpRequest.ajax,n={getAreas:function(e){var i=e.relativeUrl+"/data/spaces.json";return t(i)},getModelTree:function(e){if("singleModel"==e.modelType)var i=e.relativeUrl+"/data/tree.json";else var i=e.relativeUrl+"/data/specialtyTree.json";return t(i)},getObjectData:function(e,t){return new Promise(function(i,n){if(t._objectData)i(t._objectData);else{var o=new Glodon.Bimface.Data.ObjectPropertyManager(e.relativeUrl+"/property");o.load(function(){t._objectData=o,i(t._objectData)})}})},getMaterialProperty:function(e,i){var n=i.split(".");if("singleModel"==e.modelType)var o=e.relativeUrl+"/metadata/materialmap.json";else var o=e.relativeUrl+"/metadata/"+n[0]+"/materialmap.json";return t(o,"noCode")},getMaterialPropertyItem:function(e,i,n){var o=i.split("."),a="singleModel"==e.modelType?e.relativeUrl+"/metadata/materials/"+n+".json":e.relativeUrl+"/metadata/"+o[0]+"/materials/"+n+".json";return t(a,"noCode")},getAreaProperty:function(e,i){var n=e.split("_");if("singleModel"==i.modelType)var o=i.relativeUrl+"/metadata/areas.json";else var o=i.relativeUrl+"/metadata/"+n[0]+"/areas.json";return t(o,"noCode")},getRoomProperty:function(e,i){var n=e.split("_");if("singleModel"==i.modelType)var o=i.relativeUrl+"/metadata/rooms.json";else var o=i.relativeUrl+"/metadata/"+n[0]+"/rooms.json";return t(o,"noCode")},getFiles:function(e){var i=e.relativeUrl+"/data/files.json";return t(i)},getDrawingsheets:function(e,i){if("singleModel"==e.modelType)var n=e.relativeUrl+"/metadata/drawings.json";else var n=e.relativeUrl+"/data/"+i+"/drawingsheets.json";return t(n,"noCode")},getLevels:function(e){if("singleModel"==e.modelType)var i=e.relativeUrl+"/metadata/levels.json";else var i=e.relativeUrl+"/metadata/levels.json";return t(i,"noCode")},getMapInfo:function(e){var t=this,n=(t._opt,{}),o=[];t._helper;return i({url:e.relativeUrl+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,i.push(r)}n.Grids=i}}),i({async:!1,url:e.relativeUrl+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),i({async:!1,url:e.relativeUrl+"/resource/v3/maps/output.json",dataType:"text",success:function(t){var i=JSON.parse(t);for(var n in i){var a=i[n];void 0==a.id&&(a.id=n),a.path=e.relativeUrl+"/resource/v3/maps/"+a.id+".png",a.name=n,o.push(a)}}}),{axisGrid:n,floors:o}},getAllDrawingsheets:function(e){var i=e.relativeUrl+"/metadata/drawings.json";return t(i,"noCode")},decodeElementId:function(e,t){if(/^[0-9]*\.*[0-9]*$/.test(t))return Promise.resolve(t);var i=t.split("."),n=i[0];return this.getFiles(e).then(function(e){var t=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var l=r.value,c=!0,u=!1,d=void 0;try{for(var h,f=l.linkedBy[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){if(h.value==n)return l.fileId+"."+i[1]}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}}}catch(e){o=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw a}}}).then(function(e){return e})},getCategoryVisibility:function(e){var i=e.relativeUrl+"/metadata/categoryVisibility.json";return t(i,"noCode")},getSegmentGroups:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(i,"noCode")},getSegmentFromGroups:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+i+"/segments?view_token="+e.viewToken;return t(n,"noCode")},getSegmentTree:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(i,"noCode")},getSegmentById:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"?view_token="+e.viewToken;return t(n,"noCode")},getSegmentElementIds:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"/elementIds?view_token="+e.viewToken;return t(n,"noCode")},getPartialElementsMetadata:function(e,i){var n=e.relativeUrlWithoutDatabagId+"/"+i+"/metadata/partial_elements_metadata.json";return t(n,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/resource/v3/model"},getModelGroup:function(e,i){var n=e.relativeUrlWithoutDatabagId+"/"+i+"/metadata/collectionTree.json";return t(n,"noCode")}};e.OfflineDataProdiver=n}(),function(){function e(e){this._config=e}var t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data.OfflineDataProdiver");e.prototype={getComponentProperty:function(e,t,n){var o=this;if(!e)return console.warn("elementId must not be empty!."),void(n&&n());var a=null;i.getObjectData(this._config,this).then(function(t){return a=t,i.decodeElementId(o._config,e)}).then(function(e){var i=a.getBoundingBox(e),n=a.getElementProperties(e),o={},r=!0,s=!1,l=void 0;try{for(var c,u=n[0].items[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var d=c.value;o[d.key]=d.value}}catch(e){s=!0,l=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw l}}t({boundingBox:i,elementId:o.ID,familyGuid:"",guid:o.GUID,name:o.familyType,properties:n})})},getMaterialProperty:function(e,t,n){var o=this;i.decodeElementId(o._config,e).then(function(e){i.getMaterialProperty(o._config,e).then(function(a){var r=e.split(".");r="singleModel"==o._config.modelType?r[0]:r[1];var s=[];if(a[r]){var l=!0,c=!1,u=void 0;try{for(var d,h=a[r][Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var f=d.value;s.push(i.getMaterialPropertyItem(o._config,e,f))}}catch(e){c=!0,u=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw u}}Promise.all(s).then(function(e){t&&t(e)})}else n&&n(a)})})},getAreas:function(e,t){i.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getModelTree:function(e,t){var n=this;i.getModelTree(n._config).then(function(t){e&&e(t,n._config.modelType)}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,n){var o=this;i.getRoomProperty(e,this._config).then(function(n){var a="singleModel"==o._config.modelType?e:e.split("_")[1],r=!0,s=!1,l=void 0;try{for(var c,u=n[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var d=c.value;if(d.id==a)return void i.getObjectData(o._config,o).then(function(i){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var n=i.getElementProperties(e);n.splice(0,1),d.properties=n,t&&t(d)})}}catch(e){s=!0,l=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw l}}})},getAreaProperty:function(e,t,n){var o=this;i.getAreaProperty(e,this._config).then(function(n){var a="singleModel"==o._config.modelType?e:e.split("_")[1],r=!0,s=!1,l=void 0;try{for(var c,u=n.areas[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var d=c.value;d.id==a&&i.getObjectData(o._config,o).then(function(i){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var n=i.getElementProperties(e);n.splice(0,1),d.properties=n,t&&t(d)})}}catch(e){s=!0,l=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw l}}})},getModelGroup:function(e,t){i.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getFiles:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getLinkGraph:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,n,o){var a=this;i.getDrawingsheets(this._config,e).then(function(e){n&&n(e,a._config.modelType,a._config.dataEnvType)})},getFloors:function(e,t){var n=this;i.getLevels(this._config).then(function(t){var i=!0,o=!1,a=void 0;try{for(var r,s=t.levels[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var l=r.value;l.miniMap=n._config.databagId+"/resource/v3/maps/"+l.name+".png"}}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}e&&e(t.levels)})},getElementByConditions:function(e,t,n){var o=this;i.getObjectData(this._config,o).then(function(i){n&&n(i.getElementByConditions(e,t,o._config))})},getMapInfo:function(e){var t=i.getMapInfo(this._config);e&&e(t)},getAllDrawingsheets:function(e,t,n,o){var a=this;i.getAllDrawingsheets(this._config).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){n&&n({drawingList:[]},a._config.modelType)})},getCategoryVisibility:function(e,t){i.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentGroups:function(e,t){i.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,n){i.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentTree:function(e,t){i.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,n){i.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentElementIds:function(e,t,n){i.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadata:function(e,t,n){i.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadataFile:function(e){return i.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return i.getDatabagResource(this._config,e)}},t.OfflineDataManager=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest.promiseJSONRequest,i=Glodon.Web.Lang.Utility.HttpRequest.ajax,n={getModelTree:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/tree?v=2.0&view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/tree?view_token="+e.viewToken+"&treeType=specialty";return t(i)},getDrawingList:function(e){function i(i,n){var o=e.APIHost+"/data/v2/files/"+i+"/drawingsheets?elementId="+n+"&view_token="+e.viewToken;return t(o)}function n(i,n,o){var a=e.APIHost+"/data/v2/integrations/"+i+"/drawingsheets?fileIdHash="+n+"&elementId="+o+"&view_token="+e.viewToken;return t(a)}var e=e;return{fromSingleModel:i,fromIntegrateModel:n}},getAreas:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;return t(i)},getRoomProperty:function(e,i){if("singleModel"==i.modelType)var n=i.APIHost+"/data/v2/files/"+i.modelId+"/rooms/"+e+"?view_token="+i.viewToken;else var n=i.APIHost+"/data/v2/integrations/"+i.modelId+"/rooms/"+e+"?view_token="+i.viewToken;return t(n)},getAreaProperty:function(e,i){if("singleModel"==i.modelType)var n=i.APIHost+"/data/v2/files/"+i.modelId+"/areas/"+e+"?view_token="+i.viewToken;else var n=i.APIHost+"/data/v2/integrations/"+i.modelId+"/areas/"+e+"?view_token="+i.viewToken;return t(n)},getObjectData:function(e,i){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;else{var o=i.split(".");if(1==o.length)var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?view_token="+e.viewToken}return t(n)},getEditedObjectData:function(e,i){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+i+"?includeOverrides=true&view_token="+e.viewToken;else{var o=i.split(".");if(1==o.length)var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+i+"?includeOverrides=true&view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?includeOverrides=true&view_token="+e.viewToken}return t(n)},getFiles:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files?includeDrawingSheet=true&view_token="+e.viewToken;return t(i)},getMaterialOverride:function(e,i,n){i=void 0==i?n.viewToken:i,e=void 0==e?n.modelId:e;var o=n.APIHost+"/data/v2/materialoverridesets/"+e+"?materialFormat=FULL_INSTANCE_JSON&sort=true&view_token="+i+"&compact=true";return t(o)},getLinkGraph:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/linkGraph?view_token="+e.viewToken;return t(i)},getMaterialProperty:function(e,i){if(!i)return void(failure&&failure({}));var n=i.split(".");if("singleModel"==e.modelType)var o=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+n[0]+"/materials?view_token="+e.viewToken;else var o=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+n[0]+"/elements/"+n[1]+"/materials?view_token="+e.viewToken;return t(o)},getDrawingsheets:function(e,i){var n=e.APIHost+"/data/v2/files/"+i+"/drawingsheets?fileId="+i+"&view_token="+e.viewToken;return t(n)},getAllDrawingsheets:function(e,i){var n=e.resourceHost+"/"+(e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId)+"/metadata/drawings.json";return t(n,"noCode")},getLinksJson:function(e,i){var n=e.resourceHost+"/"+e.databagId+"/metadata/links.json";return t(n,"noCode")},getFloors:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?view_token="+e.viewToken;return t(i)},getElementByConditions:function(e,i,n){var o="";for(var a in n)o+="&"+a+"="+n[a];if("singleModel"==e.modelType)var r=e.APIHost+"/data/element/id?fileId="+i+o+"&view_token="+e.viewToken;else var r=e.APIHost+"/data/v2/integrations/"+i+"/elementIds?view_token="+e.viewToken+o;return t(r)},getMapInfo:function(e){var t=this,n=(t._opt,{}),o=[];t._helper;return i({url:e.resourceHost+"/"+e.databagId+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,i.push(r)}n.Grids=i}}),i({async:!1,url:e.resourceHost+"/"+e.databagId+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),i({async:!1,url:e.resourceHost+"/"+e.databagId+"/resource/model/maps/output.json",dataType:"text",success:function(t){var i=JSON.parse(t);for(var n in i){var a=i[n];void 0==a.id&&(a.id=n),a.path=e.resourceHost+"/"+e.databagId+"/resource/model/maps/"+a.id+".png",a.name=n,o.push(a)}}}),{axisGrid:n,floors:o}},getCategoryVisibility:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/categoryVisibility.json";return t(i,"noCode")},getScheduleList:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/schedule.json";return t(i,"noCode")},getScheduleById:function(e,i){var n=i.resourceHost+"/"+i.databagId+"/metadata/schedule/"+e+".txt";return t(n,"noCode")},getSegmentGroups:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(i,"noCode")},getSegmentFromGroups:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+i+"/segments?view_token="+e.viewToken;return t(n,"noCode")},getSegmentTree:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(i,"noCode")},getSegmentById:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"?view_token="+e.viewToken;return t(n,"noCode")},getSegmentElementIds:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"/elementIds?view_token="+e.viewToken;return t(n,"noCode")},getPartialElementsMetadata:function(e,i){var n=e.resourceHost+"/"+i+"/metadata/partial_elements_metadata.json";return t(n,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.resourceHost+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.resourceHost+"/"+t+"/resource/v3/model"},getModelGroup:function(e,i){var n=e.resourceHost+"/"+e.databagId+"/metadata/collectionTree.json";return t(n,"noCode")}};e.OnlineDataProdiver=n}(),function(){function e(e){this._config=e}var t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data.OnlineDataProdiver");e.prototype={getComponentProperty:function(e,t,n){if(!e)return console.warn("elementId must not be empty!."),void(n&&n());i.getObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getComponentOverriddenProperty:function(e,t,n){if(!e)return console.warn("elementId must not be empty!."),void(n&&n());i.getEditedObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getMaterialProperty:function(e,t,n){i.getMaterialProperty(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getModelTree:function(e,t){var n=this;i.getModelTree(n._config).then(function(t){e&&e(t,n._config.modelType)}).catch(function(e){t&&t(e)})},getAreas:function(e,t){i.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,n){i.getRoomProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getDrawingList:function(e,t,n,o){var a=this._config.modelType;if("integrateModel"==a){var r=t.split(".")[0],s=t.split(".")[1];i.getDrawingList(this._config).fromIntegrateModel(e,r,s).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})}else"singleModel"==a&&i.getDrawingList(this._config).fromSingleModel(e,t).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})},getModelGroup:function(e,t){i.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getAreaProperty:function(e,t,n){i.getAreaProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getFiles:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getMaterialOverride:function(e,t,n,o){i.getMaterialOverride(e,t,this._config).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})},getLinkGraph:function(e,t){i.getLinkGraph(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,n,o){var a=this;e=e||a._config.modelId,i.getDrawingsheets(this._config,e).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getAllDrawingsheets:function(e,t,n,o){var a=this;e=e||a._config.modelId,i.getAllDrawingsheets(this._config,e).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getLinksJson:function(e,t,n,o){var a=this;e=e||a._config.modelId,i.getLinksJson(this._config,e).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getFloors:function(e,t){i.getFloors(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getElementByConditions:function(e,t,n,o){i.getElementByConditions(this._config,e,t).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})},getMapInfo:function(e){var t=i.getMapInfo(this._config);e&&e(t)},getCategoryVisibility:function(e,t){i.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getScheduleList:function(e,t){i.getScheduleList(this._config).then(function(t){e&&e(t.scheduleList)}).catch(function(e){t&&t(e)})},getScheduleById:function(e,t,n){i.getScheduleById(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentGroups:function(e,t){i.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,n){i.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentTree:function(e,t){i.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,n){i.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentElementIds:function(e,t,n){i.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadata:function(e,t,n){i.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadataFile:function(e){return i.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return i.getDatabagResource(this._config,e)}},t.OnlineDataManager=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=(Glodon.Web.Lang.Utility.HttpRequest,function(t){if(this._config=t,this._objectData=null,"Local"==t.dataEnvType?this.dataManager=new e.OfflineDataManager(t):this.dataManager=new e.OnlineDataManager(t),!t.viewToken)return!1});t.prototype={getComponentProperty:function(e,t,i){this.dataManager.getComponentProperty(e,t,i)},getComponentOverriddenProperty:function(e,t,i){this.dataManager.getComponentOverriddenProperty(e,t,i)},getDrawingList:function(e,t,i,n){this.dataManager.getDrawingList(e,t,i,n)},getModelTree:function(e,t){this.dataManager.getModelTree(e,t)},getModeTree:function(e,t){console.warn("This function is deprecated. Please use getModelTree instead."),this.getModelTree(e,t)},getFloors:function(e,t){this.dataManager.getFloors(e,t)},getAreas:function(e,t){this.dataManager.getAreas(e,t)},getAreaProperty:function(e,t,i){this.dataManager.getAreaProperty(e,t,i)},getModelGroup:function(e,t){this.dataManager.getModelGroup(e,t)},getMaterialProperty:function(e,t,i){this.dataManager.getMaterialProperty(e,t,i)},getRoomProperty:function(e,t,i){this.dataManager.getRoomProperty(e,t,i)},getFiles:function(e,t){this.dataManager.getFiles(e,t)},getMaterialOverride:function(e,t,i,n){this.dataManager.getMaterialOverride(e,t,i,n)},getLinkGraph:function(e,t){this.dataManager.getLinkGraph(e,t)},getDrawingsheets:function(e,t,i,n){this.dataManager.getDrawingsheets(e,t,i,n)},getElementByConditions:function(e,t,i,n){this.dataManager.getElementByConditions(e,t,i,n)},getAllDrawingsheets:function(e,t,i,n){this.dataManager.getAllDrawingsheets(e,t,i,n)},getLinksJson:function(e,t,i,n){this.dataManager.getLinksJson(e,t,i,n)},getMapInfo:function(e){this.dataManager.getMapInfo(e)},getCategoryVisibility:function(e,t){this.dataManager.getCategoryVisibility(e,t)},getScheduleList:function(e,t){this.dataManager.getScheduleList(e,t)},getScheduleById:function(e,t,i){this.dataManager.getScheduleById(e,t,i)},getSegmentGroups:function(e,t){this.dataManager.getSegmentGroups(e,t)},getSegmentFromGroups:function(e,t,i){this.dataManager.getSegmentFromGroups(e,t,i)},getSegmentTree:function(e,t){this.dataManager.getSegmentTree(e,t)},getSegmentById:function(e,t,i){this.dataManager.getSegmentById(e,t,i)},getSegmentElementIds:function(e,t,i){this.dataManager.getSegmentElementIds(e,t,i)},getPartialElementsMetadata:function(e,t,i){this.dataManager.getPartialElementsMetadata(e,t,i)},getPartialElementsMetadataFile:function(e){return this.dataManager.getPartialElementsMetadataFile(e)},getDatabagResource:function(e){return this.dataManager.getDatabagResource(e)}},e.MetaDataManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.resourceHost,databagId:null}};e.FamilyDataManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,i=function(e){if(!e.databagId)return!1;this.__config=e};i.prototype.getFamilyTypes=function(e,i){var n=this.__config,o=void 0;o="Local"==n.dataEnvType?"./"+n.databagId+"/metadata/floorTree.json":n.resourceHost+"/"+n.databagId+"/metadata/familyInfo.json",t.ajax({url:o,success:function(t){for(var t=JSON.parse(t),i=t.Types||t.types,n=0,o=i.length;n<o;n++)i[n].id=i[n].Id||i[n].id,i[n].name=i[n].Name||i[n].name,delete i[n].Id,delete i[n].Name;e&&e(i)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.FamilyDataManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.staticHost}};e.IBLManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,i=function(e){this.__config=e};i.prototype.getIBLConfig=function(e,i){var n=this.__config,o=void 0;if("Local"==n.dataEnvType)return!1;o=n.resourceHost+"/resources/IBL/IBLConfig.json",t.ajax({url:o,success:function(t){var i=JSON.parse(t);e&&e(i)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.IBLManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=(Glodon.Web.Lang.Utility.HttpRequest,t||{});t.version=1,t.EnumObjectTableIndex={OTI_OBJECTS_VALUES:0,OTI_PROPERTY_SCHEMAS:1,OTI_ELEMENT_PROPERTIES:2,OTI_FAMILY_PROPERTIES:3,OTI_FAMILIES:4,OTI_ELEMENTS:5,OTI_BOUNDING_BOX:6,OTI_ELEMENTS_CLASS:7};var i=function(e){this.url=e,this.objectsDB=[]};i.prototype={load:function(e){for(var t=this,i=["Values.json.gz","Schemas.json.gz","ElementProperties.json.gz","FamilyTypeProperties.json.gz","Families.json.gz","Elements.json.gz","BoundingBox.json.gz","ElementsClass.json.gz"],n=i.length,o=0,a=i.length;o<a;++o)!function(o){(new THREE.FileLoader).load(t.url+"/"+i[o],function(i){t.objectsDB[o]=JSON.parse(i),0==(n-=1)&&e()})}(o)},getFamilyTypeProperties:function(e){var i=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILIES],n=i[e];if(void 0===n)return null
;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILY_PROPERTIES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,l=0,c=0,u={},d=[],h=0,f=0,g=n[2],p=n[1];f<g;++f){s=2*(p+f),l=4*a[s],c=a[s+1],h=r[l];var v=u[h];void 0===v&&(v=[],u[h]=v,d.push(h)),v.push({key:o[r[l+1]],unit:o[r[l+3]],valueType:r[l+2],value:o[c]})}for(var m=[],f=0,y=d.length;f<y;++f)h=d[f],m.push({group:o[h],items:u[h]});return m},getElementProperties:function(e){if(null==e)return null;var i=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS],n=i[e];if(void 0===n)return null;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENT_PROPERTIES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,l=0,c=0,u={},d=[],h=0,f=0,g=n[2],p=n[1];f<g;++f){s=2*(p+f),l=4*a[s],c=a[s+1],h=r[l];var v=u[h];void 0===v&&(v=[],u[h]=v,d.push(h)),v.push({key:o[r[l+1]],unit:o[r[l+3]],valueType:r[l+2],value:o[c]})}for(var m=[],f=0,y=d.length;f<y;++f)h=d[f],m.push({group:o[h],items:u[h]});var w=this.getFamilyTypeProperties(n[3]);if(!w)return m;var b={},C=[];m=w.concat(m);var x=!0,P=!1,k=void 0;try{for(var M,I=m[Symbol.iterator]();!(x=(M=I.next()).done);x=!0){var E=M.value;if(b[E.group]){var A=[].concat.apply(b[E.group].items,E.items),S=[],B=!0,_=!1,D=void 0;try{for(var L,G=A[Symbol.iterator]();!(B=(L=G.next()).done);B=!0){var T=L.value,N=!0,O=!0,W=!1,U=void 0;try{for(var V,H=S[Symbol.iterator]();!(O=(V=H.next()).done);O=!0){var R=V.value;T.key==R.key&&(N=!1)}}catch(e){W=!0,U=e}finally{try{!O&&H.return&&H.return()}finally{if(W)throw U}}N&&S.push(T)}}catch(e){_=!0,D=e}finally{try{!B&&G.return&&G.return()}finally{if(_)throw D}}b[E.group]={group:b[E.group].group,items:S}}else b[E.group]=E}}catch(e){P=!0,k=e}finally{try{!x&&I.return&&I.return()}finally{if(P)throw k}}for(var E in b)"基本属性"==b[E].group?C.unshift(b[E]):C.push(b[E]);return C},getElementByConditions:function(e,i,n){var o=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS_CLASS],a=Object.keys(i),r=[],s=[],l={},c={min:{x:null,y:null,z:null},max:{x:null,y:null,z:null}},u=[],d=!0,h=!1,f=void 0;try{for(var g,p=a[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var v=g.value;u.push({typeIndex:this._getGroupsKey(v,i[v],o),typeValue:i[v]})}}catch(e){h=!0,f=e}finally{try{!d&&p.return&&p.return()}finally{if(h)throw f}}for(var m=0;m<o.groups.length;m+=3){var y=!0,w=!0,b=!1,C=void 0;try{for(var x,P=u[Symbol.iterator]();!(w=(x=P.next()).done);w=!0){var k=x.value,M=o.groups[m][k.typeIndex];if(o.values[M]!=k.typeValue){y=!1;break}}}catch(e){b=!0,C=e}finally{try{!w&&P.return&&P.return()}finally{if(b)throw C}}if(y)if("singleModel"==n.modelType)r=r.concat(o.groups[m+1][""]);else{var I=o.groups[m+1],E=o.groups[m+2];for(var A in I){var S=!0,B=!1,_=void 0;try{for(var D,L=I[A][Symbol.iterator]();!(S=(D=L.next()).done);S=!0){var G=D.value;s.push({fileId:A,elementId:G})}}catch(e){B=!0,_=e}finally{try{!S&&L.return&&L.return()}finally{if(B)throw _}}}(c.min.x>E[0]||null==c.min.x)&&(c.min.x=E[0]),(c.min.y>E[1]||null==c.min.y)&&(c.min.y=E[1]),(c.min.z>E[2]||null==c.min.z)&&(c.min.z=E[2]),(c.max.x<E[3]||null==c.max.x)&&(c.max.x=E[3]),(c.max.y<E[4]||null==c.max.y)&&(c.max.y=E[4]),(c.max.z<E[5]||null==c.max.z)&&(c.max.z=E[5])}}return"singleModel"==n.modelType?r:0==s.length?[]:(l.elements=s,l.boundingBox=c,l)},_getGroupsKey:function(e,t,i){for(var n=0,o=0;o<i.keys.length;o++)if(i.keys[o]==e){n=o;break}return n},getBoundingBox:function(e){if(null==e)return null;var i=this.objectsDB[t.EnumObjectTableIndex.OTI_BOUNDING_BOX],n="";try{n={min:{x:i[e][0],y:i[e][1],z:i[e][2]},max:{x:i[e][3],y:i[e][4],z:i[e][5]}}}catch(e){console.log("no boundingBox Data"),n=""}return n}},e.ObjectPropertyManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.FileManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,i=function(e){this.__config=e};i.prototype.getViewToken=function(e,i,n){var o=this.__config,a=void 0;return"singleModel"!=o.modelType&&("Local"==o.dataEnvType?void(i&&i()):(a=o.APIHost+"/data/v2/integrations/"+o.modelId+"/files/"+e+"/viewToken?view_token="+o.viewToken,void t.ajax({url:a,type:"post",success:function(e){var t=JSON.parse(e);i&&i(t.data)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);n&&n(t)})})))},e.FileManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=(Glodon.Web.Lang.Utility.HttpRequest,null),i={getInstance:function(){return null==t&&(t={},t.sendingPeriod=6e4,t.requestList=[],t.isEnabled=!0,t.modelType="",t.modelId="",t.send=function(e,i){t.isEnabled&&this.requestList.push(e+"."+i)},setInterval(function(){if(t.isEnabled){var e=t.requestList,i=e.length;if(i>0){var n=e.slice(0,i);t._send(n),e.splice(0,i)}}},t.sendingPeriod),t._send=function(e){var t="https://api.bimface.com/inside/track?ModelType="+this.modelType+"&ModelId="+this.modelId,i={FunctionNames:e},n={"Content-Type":"application/json"};fetch(t,{method:"PUT",mode:"cors",body:JSON.stringify(i),headers:n,cache:"default"}).then(function(e){})},t.setIsEnabled=function(e){t.isEnabled=!0===e},t.getIsEnabled=function(){return t.isEnabled}),t}};e.StatisticsDataManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=(Object.freeze({TranslucentOthers:"",HideOthers:""}),function(){var e=new Glodon.Web.Lang.EventManager;this.getEventManager=function(){return e}});t.prototype.init=function(){},t.prototype.addView=function(e){var t=this,i=Glodon.Bimface.Authentication.AuthenticationManager,n=(t._opt,new Glodon.Bimface.Authentication.AuthenticationConfig);n.viewToken=e,n.APIHost=this._opt.APIHost,(this.authenticate=new i(n)).authenticate(function(e){"bimView"==e.renderType&&(e.renderType="3DView"),t.loadViewCore(e)},function(e){var i=Glodon.Bimface.Viewer.Viewer3DEvent;t.getEventManager().fireEvent(i.Error,e)})},t.prototype.loadViewCore=function(){},t.prototype.addEventListener=function(e,t){this.getEventManager().addEvent(e,t)},t.prototype.removeEventListener=function(e,t){this.getEventManager().removeEvent(e,t)},t.prototype.enableFullScreen=function(e){var t=this._opt.domElement,i=this;e?Glodon.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon.Web.Lang.Utility.FullScreen.exitFullScreen(),setTimeout(function(){i.resize()},200)},e.Viewer=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=function(){return{domElement:null,resourceHost:hostConfig.resourceHost,staticHost:hostConfig.staticHost+"/api/Glodon",APIHost:hostConfig.APIHost,sdkUrl:null,staticPath:"/api/Glodon",enableLineWidth:!1,displayMode:0,enableHover:!0}};e.ViewerDrawingConfig=t}(),function(){var e=Object.freeze({Loaded:"Loaded",MouseClicked:"MouseClicked",MouseDragged:"MouseDragged",Rendered:"Rendered",ViewZoomed:"ViewZoomed",Hover:"Hover",Error:"Error",ComponentsSelectionChanged:"ComponentsSelectionChanged"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer").ViewerDrawingEvent=e}(),function(){var e="Glodon.Bimface.Viewer.ViewerDrawing",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"GlobalData"),o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics"),r=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),s=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Bimface.Viewer.ViewerDrawingEvent);n.isInitialized=n.isInitialized||!1;var l=Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),c=function(e){i.Viewer.call(this);var t=this,n=e;this._opt=e,this.isInitialized=!1,this.hasBindEvents=!1,this.grids=null,this.snapIsEnabled=!1;var o=r.create("div","bf-drawing-container ");if(l)var a=r.create("div","bf-drawing-wrap");else{var a=r.create("div","bf-drawing-wrap bf-mobile"),c=e.domElement.offsetWidth,u=e.domElement.offsetHeight;a.style.fontSize=90*Math.min(c,u,414)/750+"px"}var d,h=e.domElement;h.addClass("viewerDrawingWrap"),h.id?d=h.id:(d=Glodon.Web.Lang.Utility.UUID.createUUID(),h.id=d),o.id="Drawing"+d,o.setCss({width:"100%",height:"100%",position:"relative",zIndex:1,background:"rgb(50, 50, 55)"}),a.setCss({width:"100%",height:"100%",position:"relative"}),a.appendChild(o),h.appendChild(a),n.domElement=o,this._domElement=h,this._viewConfig=n,this.rootElement=o,this.getDomElement=function(){return a},this.getRootElement=function(){return o},this.getViewer=function(){return this._drawingViewer},l?(o.addEventListener("mousedown",function(e){e.preventDefault(),this.oldMouseX=e.clientX,this.oldMouseY=e.clientY}),o.addEventListener("mouseup",function(e){e.preventDefault();var i=Math.abs(this.oldMouseX-e.clientX)<=1&&Math.abs(this.oldMouseY-e.clientY)<=1;if(0===e.button){var n,o,a,r=this.getBoundingClientRect(),l={};if(n=e.clientX-r.x,o=e.clientY-r.y,a={x:n,y:o},i){if(!e.target.hasClass("bf-drawable-context")&&"canvas"!=e.target.tagName.toLocaleLowerCase())return;var c,u;if(u=t._drawingViewer.toWorldPoint([n,o]),t._drawingViewer.preSelect(n,o),c=t._drawingViewer.getHighlightIds(),l={worldPosition:{x:u[0],y:u[1]},clientPosition:a,objectId:c[0]||null,clientX:e.clientX,clientY:e.clientY,event:e},t.grids&&(l.grid=t.getNearestGrid({x:n,y:o})),t.snapIsEnabled){var d=t._drawingViewer.snapToPoint(n,o);if(0!=d.GetID()){var h=d.GetSnapType(),f={x:d.GetPoint()[0],y:d.GetPoint()[1]},g=t._drawingViewer.toScreenPoint([f.x,f.y]),a={x:g[0],y:g[1]};l.snapPoint={type:h,clientPosition:a,worldPosition:f}}}t.getEventManager().fireEvent(s.MouseClicked,l)}else l={clientPosition:a},t.getEventManager().fireEvent(s.MouseDragged,l)}})):(o.addEventListener("touchstart",function(e){if(e.target.hasClass("bf-drawable-context")||"canvas"==e.target.tagName.toLocaleLowerCase()){var t=e.targetTouches[0];this.oldTouchX=t.clientX,this.oldTouchY=t.clientY}}),o.addEventListener("touchend",function(e){var i,n,o,a=e.changedTouches[0],r=this.oldTouchX==a.clientX&&this.oldTouchY==a.clientY,l=this.getBoundingClientRect(),c={};if(i=a.clientX-l.x,n=a.clientY-l.y,o={x:i,y:n},r){if(!e.target.hasClass("bf-drawable-context")&&"canvas"!=e.target.tagName.toLocaleLowerCase())return;var u,d;d=t._drawingViewer.toWorldPoint([i,n]),t._drawingViewer.preSelect(i,n),u=t._drawingViewer.getHighlightIds(),c={worldPosition:{x:d[0],y:d[1]},clientPosition:o,objectId:u||null,clientX:a.clientX,clientY:a.clientY,event:e},t.grids&&(c.grid=t.getNearestGrid({x:i,y:n})),t.getEventManager().fireEvent(s.MouseClicked,c)}else c={clientPosition:o},t.getEventManager().fireEvent(s.MouseDragged,c)})),Glodon.Bimface.WebglDrawingSheet.onLoadProgress=function(e){var t=document.querySelector(".bf-drawing-container  .bf-loading-text");t&&e&&(t.innerText=parseInt(100*e)+"%")}};o.Type.inheritPrototype(c,i.Viewer),c.prototype=Object.assign({},i.Viewer.prototype,{addModel:function(e,t,i){if(this._data&&this._data.renderVersion!=e.renderVersion)return console.log("this model can not be added."),!1;var o=Glodon.Bimface.Data.StatisticsDataManager.getInstance();o.modelType=e.modelType,o.modelId=e.modelId;var a,r=this,s=(r.getViewer(),r._opt,e.dataPath,e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId),l=Glodon.Web.Lang.Utility.ClientHelper.formatURL((e.path||this._viewConfig.resourceHost)+"/"+s+"/resource/drawing");a=l,e.drawingUrl=a,r._data=e,r.isInitialized||n.isInitialized?r.loadIndexJson(e,t,i,function(){n.isInitialized&&!r.isInitialized&&(r._drawingViewer=r.createDrawingViewer(r.rootElement.id)),r.loadModel(a,t,i)}):r.loadIndexJson(e,t,i,function(){if("bimView"==e.renderType&&e.subRenders&&0!=e.subRenders.length)for(var o=0;o<e.subRenders.length;o++)"drawingView"==e.subRenders[o].renderType&&(Glodon.Bimface.DrawingSheet.sdkUrl=(r._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||e.sdkPath||r._viewConfig.staticHost)+"/"+e.subRenders[o].jsSDKVersion);else Glodon.Bimface.DrawingSheet.sdkUrl=(r._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||e.sdkPath||r._viewConfig.staticHost)+"/"+e.jsSDKVersion;"2"==r.version?r.loadWebGL(a,t,i):Glodon.Bimface.DrawingSheet.initialize(function(){r._drawingViewer=r.createDrawingViewer(r.rootElement.id),r.loadModel(a,t,i),n.isInitialized=!0})}),this.showLoading()},showLoading:function(){var e=r.create("div","bf-loading"),t=r.create("div","bf-loading-gif"),i=r.create("div","bf-loading-text");e.appendChild(t),e.appendChild(i),this.loading=e,this.rootElement.appendChild(e)},enableHover:function(i){t.send(e,"enableHover"),this._opt.enableHover=i,this._drawingViewer.enableHover(i)},enableSnap:function(i){t.send(e,"enableSnap"),this.snapIsEnabled=i,this._drawingViewer.mouseEditorMgr.enableSnap(i)},destroy:function(){this._drawingViewer.viewer.ReleaseModel()},enableMiniMap:function(i,n){t.send(e,"enableMiniMap");var o=this._drawingViewer;if(!0===i){if(1==o.hasMinimap())return void o.enableMinimap(!0);var a=this.rootElement.id,r={width:300,height:240},s=this._viewConfig.resourceHost,l=this.authenticate.data.databagId,c=s+"/"+l+"/thumbnail/512.png",u=s+"/"+l+"/resource/preview/Model_4028.json";Glodon.Web.Lang.Utility.HttpRequest.ajax({url:u,success:function(e){function t(e){var t=e.indexOf("{"),i=e.indexOf("}"),n=e.slice(t+1,i).split(",");return{x:parseFloat(n[0]),y:parseFloat(n[1])}}var i=JSON.parse(e).boundingbox,s=t(i.minPoint),l=t(i.maxPoint);o.createMinimap(a,c,r.width,r.height),n&&n(),o.setMinimapBoundingBox({min:s,max:l})}})}else o.enableMinimap(!1)},load:function(i,o,a){t.send(e,"load");var r=this,s=arguments;if(n.loading)return setTimeout(function(){r.load.apply(r,s)},500);n.loading=!0,r.isInitialized||n.isInitialized?i&&this.getViewMetaData(i,function(e){r.loadIndexJson(e,o,a,function(){n.isInitialized&&!r.isInitialized&&(r._drawingViewer=r.createDrawingViewer(r.rootElement.id)),r._drawingViewer.clearAll(),r.loadModel(e.drawingUrl,o,a)})}):i&&this.getViewMetaData(i,function(e){r.loadIndexJson(e,o,a,function(){var t=Glodon.Bimface.Data.StatisticsDataManager.getInstance();t.modelType=e.modelType,t.modelId=e.modelId,r.initialize(e,o,a)})}),this.showLoading()},loadIndexJson:function(e,t,i,n){var o=this,a=e.drawingUrl;t&&(a=a+(i?"/"+i:"")+"/"+t),this.url=a,this.getIndexJson(a,function(e){var t=document.querySelector(".bf-drawing-container  .bf-loading-text");"2"==e.metadata.version||"2"==e.metadata["version:"]?(o.version="2",t.innerText="0%"):(o.version="1",t.innerText=BimfaceLanguage.bf_load),n()})},getViews:function(){return this._drawingViewer.getLayouts()},getModelPosition:function(i,n,o){t.send(e,"getModelPosition");var a=this.authenticate.data.databagId,r=null,s=this._drawingViewer.getModelBBox().GetMinPt(),l=this._drawingViewer.getModelBBox().GetMaxPt(),c=new THREE.Vector2(s[0],s[1]),u=new THREE.Vector2(l[0],l[1]),d=new THREE.Box2(c,u),h=(n.x-d.min.x)/d.getSize().x,f=(n.y-d.min.y)/d.getSize().y,g=new THREE.Vector3(h,f);Glodon.Web.Graphics.Utility.Relation.getDrawingSheets(a,i,function(e){r=e,r.viewType=e.viewInfo.viewType;var t=r.viewInfo.preview.width,i=r.viewInfo.preview.height,n=new THREE.Vector2(t*g.x,i*(1-g.y)),a=Glodon.Web.Graphics.Utility.Relation.point2DToPoint3D(n,r);o&&o(a)})},getLayers:function(){return this._drawingViewer.getLayers()},changeLayers:function(i){t.send(e,"changeLayers"),this._drawingViewer.changeLayers(i),this.update()},getColor:function(e){return"rgba("+(255&e)+", "+(e>>8&255)+", "+(e>>16&255)+", 1)"},hideLayer:function(i){t.send(e,"hideLayer");for(var n=this.getLayers(),o=0,a=n.length;o<a;++o){var r=n[o];if(r.id==i){r.visible=!1;break}}this.changeLayers(n)},showLayer:function(i){t.send(e,"showLayer");for(var n=this.getLayers(),o=0,a=n.length;o<a;++o){var r=n[o];if(r.id==i){r.visible=!0;break}}this.changeLayers(n)},hideAllLayers:function(){t.send(e,"hideAllLayers");for(var i=this.getLayers(),n=0,o=i.length;n<o;++n){i[n].visible=!1}this.changeLayers(i)},showAllLayers:function(i){t.send(e,"showAllLayers");for(var n=this.getLayers(),o=0,a=n.length;o<a;++o){n[o].visible=!0}this.changeLayers(n)},getElementBoxColor:function(){t.send(e,"getElementBoxColor");var i=this._drawingViewer.getElementBoxColor();return new Glodon.Web.Graphics.Color(i.red,i.green,i.blue,i.alpha)},setElementBoxColor:function(i){t.send(e,"setElementBoxColor"),this._drawingViewer.setElementBoxColor(i.red,i.green,i.blue,i.alpha)},getElementBoxStyle:function(){return t.send(e,"getElementBoxStyle"),this._drawingViewer.getElementBoxStyle()},setElementBoxStyle:function(i){return t.send(e,"setElementBoxStyle"),-1==["Rectangle","CloudRect"].indexOf(i)?void console.error("params error!"):this._drawingViewer.setElementBoxStyle(i)},showViewById:function(i){t.send(e,"showViewById"),this._drawingViewer.activeLayoutById(i||0)},getCurrentViewId:function(){return this._drawingViewer.getActiveLayoutId()},rectZoom:function(){t.send(e,"rectZoom"),this._drawingViewer.mouseEditorMgr.activeEditorByName("zoom"),this._opt.enableZoomRect=!0},getZoomFactor:function(){return this._drawingViewer.getZoomFactor()},getCurrentState:function(){return this._drawingViewer.getState()},setState:function(i){t.send(e,"setState"),this._drawingViewer.setState(i),this._drawingViewer.update()},createSnapshotAsync:function(i,n){t.send(e,"createSnapshotAsync"),i&&(i="rgba("+i.red+","+i.green+","+i.blue+","+i.alpha+")"),n&&n(this._drawingViewer.snapshot(i))},enableFullScreen:function(e){var t=this.getDomElement();e?Glodon.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon.Web.Lang.Utility.FullScreen.exitFullScreen()},home:function(){this._drawingViewer.zoomToExtent(),this._drawingViewer.update()},getViewMetaData:function(e,t){var i=this,n=Glodon.Bimface.Authentication.AuthenticationManager,o=new Glodon.Bimface.Authentication.AuthenticationConfig;o.viewToken=e,o.APIHost=this._viewConfig.APIHost,(this.authenticate=new n(o)).authenticate(function(e){var n=e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId;e.drawingUrl=i._viewConfig.resourceHost+"/"+n+"/resource/drawing",t(e)})},getIndexJson:function(e,t){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:e+"/index.json.gz",success:function(e){var i=JSON.parse(e);i&&t(i)}})},initialize:function(e,t,i){if(this.isInitialized)return!1;var o=this;if("bimView"==e.renderType&&e.subRenders&&0!=e.subRenders.length)for(var a=0;a<e.subRenders.length;a++)"drawingView"==e.subRenders[a].renderType&&(Glodon.Bimface.DrawingSheet.sdkUrl=(o._viewConfig.sdkUrl||o._viewConfig.staticHost)+"/"+e.subRenders[a].jsSDKVersion);else Glodon.Bimface.DrawingSheet.sdkUrl=(o._viewConfig.sdkUrl||o._viewConfig.staticHost)+"/"+e.jsSDKVersion;"2"==o.version||"2.0"==e.renderVersion?this.loadWebGL(e.drawingUrl,t,i):Glodon.Bimface.DrawingSheet.initialize(function(){o._drawingViewer=o.createDrawingViewer(o.rootElement.id),o.loadModel(e.drawingUrl,t,i),n.isInitialized=!0})},loadWebGL:function(e,t,i){var o=this;this.grids=null,t&&(e=e+(i?"/"+i:"")+"/"+t),Glodon.Bimface.WebglDrawingSheet.loadModel(e,o.rootElement.id,function(e){for(var i=document.querySelectorAll(".bf-drawing-container .bf-loading"),a=i.length,r=0;r<a;r++)i[r].remove();if(n.loading=!1,null!==e){var c;if(o._drawingViewer=c=Glodon.Bimface.WebglDrawingSheet.createDrawing(o.rootElement.id,e),c.zoomToExtent(),c.update(),t){for(var u=c.getLayouts(),d=null,r=0;r<u.length;r++)if("Layout1"==u[r].name){d=u[r].id;break}d&&o.showViewById(d);var h;h=new Glodon.Bimface.RevitInterop,h.initialize(c),c.revitInterop=h}o._drawingViewer.mouseEditorMgr=l?Glodon.Bimface.WebglDrawingSheet.createMouseEditorManager(c):Glodon.Bimface.WebglDrawingSheet.createTouchEditorManager(c),o._drawingViewer.mouseEditorMgr.bindEvents(),o.observer(o._drawingViewer.mouseEditorMgr),o._drawingViewer.mouseEditorMgr.activeEditorByName("pick"),window.addEventListener("resize",function(){c&&c.onResize()}),o._drawingViewer.onViewChanges=function(){o.getEventManager().fireEvent(s.Rendered,o._drawingViewer)},o.getEventManager().fireEvent(s.Loaded,o._drawingViewer.mouseEditorMgr),Glodon.Web.Lang.Utility.MouseMotion.setCursor(o),o.enableHover(o._opt.enableHover)}})},observer:function(e){var t=null,i=this;e.observer=function(e,n,o,a,r,l){if("zoom"==e&&"exit"==n&&(i.getEventManager().fireEvent(s.ViewZoomed),i._opt.enableZoomRect=!1),("measure"==e||"area-measure"==e)&&"change"==n){var c=i.getViewScale(),u=null;o&&o.distance?u={distance:o.distance*c,start:[o.start[0]*c,o.start[1]*c],end:[o.end[0]*c,o.end[1]*c]}:o&&o.area&&(u={area:o.area*c*c}),i.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measured,u)}if("pick"==e&&"selection"==n&&i.getEventManager().fireEvent(s.ComponentsSelectionChanged,o),"pick"==e&&"highlight"==n)if(o.length>0){if(t==o[0])return;var d=i._drawingViewer.toWorldPoint([a,r]);i.getEventManager().fireEvent(s.Hover,{objectId:o[0],clientPosition:{x:a,y:r},worldPosition:{x:d[0],y:d[1]},event:l}),t=o[0]}else t=null}},createDrawingViewer:function(e){for(var t=document.querySelectorAll("#"+e+" canvas"),i=0;i<t.length;i++)t[i].remove();var n=Glodon.Bimface.DrawingSheet.createDrawing(e);return n.mouseEditorMgr=l?Glodon.Bimface.DrawingSheet.createMouseEditorManager(n):Glodon.Bimface.DrawingSheet.createTouchEditorManager(n),this.isInitialized=!0,n},toRevitId:function(e){return console.log("This method is obsolete,  please use  toModelId() instead "),this.toModelId(e)},toLinkRevitId:function(i,n){return t.send(e,"toLinkRevitId"),this._drawingViewer.revitInterop.toLinkRevitId(i,n)},fromRevitId:function(e){return this._drawingViewer.revitInterop.fromRevitId(e)},fromLinkRevitId:function(i,n){return t.send(e,"fromLinkRevitId"),this._drawingViewer.revitInterop.fromLinkRevitId(i,n)},toModelId:function(i){return t.send(e,"toModelId"),this._drawingViewer.revitInterop.toRevitId(i)},toDrawingId:function(i){return t.send(e,"toDrawingId"),this._drawingViewer.revitInterop.fromRevitId(i)},zoomToObject:function(i,n){t.send(e,"zoomToObject"),n=n||.5,this.clearSelection(),this._drawingViewer.zoomToObject(i,n),this._drawingViewer.canSelectInBlock()?this.selectIdWithBlock(0,i):this.selectByIds(i)},zoomToObjectWithBlock:function(e,t,i){i=i||.5,this.clearSelection(),this._drawingViewer.zoomToObjectWithBlock(e,t[0],i);for(var n=0;n<t.length;n++)this.selectIdWithBlock(e,t[n]);this.update()},setZoomRatio:function(e){e=e||1.1,(e>=2||e<0)&&(e=1.9),this._drawingViewer.setZoomRatio(e)},getZoomRatio:function(){return this._drawingViewer.getZoomRatio()},selectByIds:function(i){t.send(e,"selectByIds"),Array.isArray(i)||(i=[i]),this._drawingViewer.selectByIds(i),this.update()},selectIdWithBlock:function(e,t){("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this._drawingViewer.selectIdWithBlock(e,t)},clearSelection:function(){this._drawingViewer.clearSelection(),this.update(!0)},showLineWidth:function(i){t.send(e,"showLineWidth"),this._opt.enableLineWidth=i,this._drawingViewer.viewer.ShowLineWidth=i,this.update(!0)},isEnableLineWidth:function(){return this._opt.enableLineWidth},loadModel:function(e,t,i){var o=this,a=this._drawingViewer,r=a.mouseEditorMgr;a.touchEditorMgr;this.grids=null,t&&(e=e+(i?"/"+i:"")+"/"+t,Glodon.Bimface.DrawingSheet.loadGrids(e,function(e){e&&(o.grids=e.grids,console.log(e))})),Glodon.Bimface.DrawingSheet.loadModel(e,function(e){if(null!==e){if(a.setModel(e),a.clearSelection(),t){for(var i=a.getLayouts(),l=null,c=0;c<i.length;c++)if("Layout1"==i[c].name){l=i[c].id;break}l&&o.showViewById(l);var u;u=new Glodon.Bimface.RevitInterop,u.initialize(a),a.revitInterop=u}o.hasBindEvents||(r.bindEvents(),o.hasBindEvents=!0),o.observer(r),r.activeEditorByName("pick"),n.loading=!1;for(var d=document.querySelectorAll(".bf-drawing-container .bf-loading"),h=d.length,c=0;c<h;c++)d[c].remove();window.addEventListener("resize",function(){a&&a.onResize()}),a.onViewChanges=function(){o.getEventManager().fireEvent(s.Rendered,a)},o.home(),o.setDisplayMode(o._opt.displayMode),o.showLineWidth(o._opt.enableLineWidth),o.getEventManager().fireEvent(s.Loaded,r),Glodon.Web.Lang.Utility.MouseMotion.setCursor(o),o.enableHover(o._opt.enableHover)}else{console.log("failed to load model!"),n.loading=!1;for(var d=document.querySelectorAll(".bf-drawing-container  .bf-loading"),c=0;c<d.length;c++)d[c].remove()}})},setNavigationMode:function(i){t.send(e,"setNavigationMode"),this._drawingViewer.mouseEditorMgr.activeEditorByName(i)},zoomIn:function(){this._drawingViewer.zoomPan(1.1)},zoomOut:function(){this._drawingViewer.zoomPan(.9)},zoom:function(e){this._drawingViewer.zoomPan(e)},resize:function(){this._drawingViewer.onResize()},worldToClient:function(e){var t=this._drawingViewer.toScreenPoint([e.x,e.y]);return{x:t[0],y:t[1]}},clientToWorld:function(e){var t=this._drawingViewer.toWorldPoint([e.x,e.y]);return{x:t[0],y:t[1]}},update:function(e){this._drawingViewer.update(e)},setPrintMode:function(e){this._drawingViewer.setPrintMode(e),this._drawingViewer.update(!0)},setGlobalOpacity:function(e){this._drawingViewer.dc.setGlobalOpacity(e),this._drawingViewer.update(!0)},setDisplayMode:function(i){t.send(e,"setDisplayMode"),i=i||0,0==i?this.rootElement.style.background="rgb(50,50,55)":3!=i&&(this.rootElement.style.background="rgb(255,255,255)"),this._opt.displayMode=i;var n=["Normal","White","Black","Custom"];this.setPrintMode(n[i])},getGlobalOpacity:function(){return this._drawingViewer.dc.getGlobalOpacity()},setGlobalColor:function(e){e instanceof a.Color?(this._drawingViewer.setGlobalColor(e),this._drawingViewer.update(!0)):console.error("param use Glodon.Web.Graphics.Color ")},getGlobalColor:function(){if(3==this.getDisplayMode())return this._drawingViewer.getGlobalColor();console.error("Only available when using customized display mode.")},restoreGlobalOpacity:function(){this._drawingViewer.dc.restoreGlobalOpacity(),this._drawingViewer.update(!0)},getDisplayMode:function(){return this._opt.displayMode},getViewScale:function(){return this._drawingViewer.getViewScale()},setViewScale:function(e){this._drawingViewer.setViewScale(e)},setSnapDistance:function(e){"number"!=typeof e||e<0||e>25||this._drawingViewer.setSnapDistance(e)},showElementBox:function(e){this.showElementBoxByBBox(this.getObjectBoundingBox(parseInt(e)))},showElementBoxByBBox:function(e){this._drawingViewer.showElementBoxByBBox(e),this._drawingViewer.update()},hideElementBox:function(e){this._drawingViewer.hideElementBox(parseInt(e)),this._drawingViewer.update(!0)},clearElementBox:function(){this._drawingViewer.clearElementBox(),this._drawingViewer.update(!0)},getObjectBoundingBox:function(e){return this._drawingViewer.getObjectBoundingBox(e)},getVisibleBoxIds:function(){return this._drawingViewer.getVisibleBoxIds()},enableHighlightEvent:function(e){this._drawingViewer.enableHighlightEvent(e)},highlightById:function(e){if(Array.isArray(e))for(var t=0,i=e.length;t<i;t++)this._drawingViewer.highlightById(parseInt(e[t]));else this._drawingViewer.highlightById(parseInt(e));this._drawingViewer.update(!0)},clearHighlight:function(){this._drawingViewer.clearHighlight(),this._drawingViewer.update(!0)},ignoreImage:function(e){this._drawingViewer.dc.ignoreImage=e,this._drawingViewer.update(!0)},clientToModelWorld:function(e){var t=this._drawingViewer.viewer.ToModelWorldPoint([e.x,e.y]);return[t[0],t[1]]},getNearestGrid:function(e){e=this.clientToModelWorld(e);for(var t=this.grids,i=null,n=t.length-1;n>=0;n--){var o=t[n].gridInfo;o.distance=Glodon.Web.Lang.Utility.ClientHelper.PointToLineDistance(e[0],e[1],o.start.x,o.start.y,o.end.x,o.end.y),i?i.distance[0]>o.distance[0]&&(i=o):i=o}return i},scale:function(e,t){this._drawingViewer.scaleDrawing(e,t)},getScaleFactor:function(){return this._drawingViewer.getAlignScale()},getExternalReferencesList:function(e){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:this.url+"/externalBlocks.json",success:function(t){var i=JSON.parse(t);i&&e(i)}})},getAlignState:function(){return this._drawingViewer.getAlignState()},setAlignState:function(e){this._drawingViewer.setAlignState(e)}}),i.ViewerDrawing=c}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=function(){return{domElement:null,resourceHost:hostConfig.resourceHost,staticHost:hostConfig.staticHost+"/api/Glodon",APIHost:hostConfig.APIHost,sdkUrl:null,staticPath:"/api/Glodon",enableLineWidth:!1,displayMode:0}};e.ViewerDrawingSetConfig=t}(),function(){var e=Object.freeze({Loaded:"Loaded",MouseClicked:"MouseClicked",ActiveViewChanged:"ActiveViewChanged",Rendered:"Rendered",ViewChanged:"ViewChanged",ViewMoving:"ViewMoving",ViewMoved:"ViewMoved",ViewZooming:"ViewZooming",ViewZoomed:"ViewZoomed",AddDrawing:"AddDrawing",Hover:"Hover",DrawingMeasure:"DrawingMeasure",Error:"Error",ComponentsSelectionChanged:"ComponentsSelectionChanged"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer").ViewerDrawingSetEvent=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"GlobalData"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),o=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Bimface.Viewer.ViewerDrawingSetEvent);t.isInitialized=t.isInitialized||!1;var a=(Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),function(t){e.Viewer.call(this);var i=t;this._opt=t,this.isAlignment=!1,this.sets=[],this.activeState=null,this._displayMode=0,this._state={},this.hasInit=!1;var o,a=n.create("div","bf-drawingSet-container "),r=t.domElement;r.id?o=r.id:(o=Glodon.Web.Lang.Utility.UUID.createUUID(),r.id=o),a.id="DrawingSet"+o,a.setCss({width:"100%",height:"100%",position:"relative"}),r.appendChild(a),i.domElement=a,this._domElement=r,this._viewConfig=i,this.rootElement=a,this.haveActiveDrawing=!1,this.getRootElement=function(){return a}});i.Type.inheritPrototype(a,e.Viewer),a.prototype=Object.assign({},e.Viewer.prototype,{addDrawing:function(e,t,i){var n=this;this.getViewMetaData(t,function(o){var a=new Glodon.Bimface.Viewer.ViewerDrawingSetConfig,r=n.createWrap(e);a.domElement=r,a.drawingUrl=o.drawingUrl,a.viewToken=t;var s=Glodon.Bimface.Viewer.ViewerDrawingSetEvent,l=void 0;l=new Glodon.Bimface.Viewer.ViewerDrawing(a),l.load(a.viewToken);var c={id:e,wrap:r,viewerDrawing:l,active:!1,visible:!0,fileName:o.name};n.sets.push(c),n.haveActiveDrawing||(n.haveActiveDrawing=!0,n.setActiveDrawing(e,!0)),l.addEventListener(s.MouseClicked,function(t){n.onMouseClick(e,t)}),l.addEventListener(s.Rendered,function(e){n.activeState=e.getState(),n.sync(),n.getEventManager().fireEvent(s.Rendered,n)}),l.addEventListener(s.Loaded,function(e){n.setDisplayMode(n.getDisplayMode()),n.hasInit||(n.getEventManager().fireEvent(s.Loaded,n),n.hasInit=!0),n.getEventManager().fireEvent(s.AddDrawing,n),i&&i(e)}),l.addEventListener(s.ViewZoomed,function(){n.getEventManager().fireEvent(s.ViewZoomed,n)})})},addDrawings:function(e,t){var i=e.slice(),n=i.shift(),o=n.viewToken,a=n.id,r=t,s=this;void 0==a&&(a=Date.now()),this.addDrawing(a,o);var l=function e(){var t=i.shift();if(t){var n=t.id;void 0==n&&(n=Date.now()),s.addDrawing(n,t.viewToken)}else r&&r(s),s.removeEventListener("AddDrawing",e)};this.addEventListener("AddDrawing",l)},sync:function(){for(var e=this.sets,t=this.activeState,i=0;i<e.length;i++)e[i].active||e[i].viewerDrawing.setState(t)},setNavigationMode:function(e){this.getActiveDrawing().viewerDrawing.setNavigationMode(e)},removeDrawing:function(e){
if(null==e||void 0==e)return console.error("id is necessary!"),!1;var t=this.getDrawingById(e);t.active&&(1==this.sets.length?this.haveActiveDrawing=!1:this.setActiveDrawing(this.sets[this.sets[0].id==e?1:0].id)),t.wrap.remove(),this.sets.removeObjectByAttribute("id",e)},rectZoom:function(){this._state.rectZoom=!0,this.getActiveDrawing().viewerDrawing.rectZoom()},enableFullScreen:function(e){var t=this.getRootElement();e?Glodon.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon.Web.Lang.Utility.FullScreen.exitFullScreen();var i=this;setTimeout(function(){i.getActiveDrawing().viewerDrawing.resize()},500)},getCurrentState:function(){for(var e=[],t=this.sets,i=0;i<t.length;i++){var n=t[i],o=n.id,a=n.active,r=n.visible,s=n.viewerDrawing,l=this.getOffsetDistance(o),c=s.getAlignState(),u=s.getCurrentState(),d={id:o,active:a,visible:r,alignState:c,allState:u,translate:l};e.push(d)}return e},setCurrentState:function(e){for(var t=this.sets,i=0;i<t.length;i++){var n=t[i],o=n.id,a=n.active,r=n.visible,s=n.viewerDrawing,l=e.getObjectByAttribute("id",o);l&&(l.visible!=r&&(l.visible?this.showDrawing(o):this.hideDrawing(o)),l.active&&!a&&this.setActiveDrawing(o),l.alignState&&s.setAlignState(l.alignState),l.allState&&s.setState(l.allState))}},onMouseClick:function(e,t){if(t.id=e,this.getEventManager().fireEvent(o.MouseClicked,t),this.isAlignment){if(this.selectId){var i=this.getSelectDrawing().viewerDrawing.getViewer().toModelWorld([t.clientPosition.x,t.clientPosition.y]);this.alignmentPoints.push({x:i[0],y:i[1]})}else this.alignmentPoints.push(t.worldPosition);var n=this.alignmentPoints,a=void 0;if(1==n.length){a=this.getSelectDrawing();var r=a.viewerDrawing.getViewer(),s=r.snapToPoint(t.clientPosition.x,t.clientPosition.y),l=s.GetPoint();if(0!=s.GetID())n[0]={x:l[0],y:l[1]};else{var c=this.verify([t.clientPosition.x,t.clientPosition.y]);if(c){var u=r.toModelWorld(c),d=u.slice(0,2);n[0]={x:d[0],y:d[1]}}}}else if(2==n.length){var h=this.getSelectDrawing(),f=h.viewerDrawing.getViewer();"capture"!=f.mouseEditorMgr.editors[0].name&&h.viewerDrawing.setNavigationMode("capture");var g=this.verify([t.clientPosition.x,t.clientPosition.y]);if(g){var p=f.toModelWorld(g),v=p.slice(0,2);n[1]={x:v[0],y:v[1]}}this.moveDrawing(h.id,[n[1].x-n[0].x,n[1].y-n[0].y]),this.alignmentPoints=[]}}},convertCoordinates:function(e,t,i){var n=this.getDrawingById(e),o=this.getDrawingById(t),a=n.viewerDrawing.worldToClient({x:i[0],y:i[1]});return o.viewerDrawing.clientToWorld(a)},showDrawing:function(e){var t=this.getDrawingById(e);t.wrap.setCss({display:"block"}),t.visible=!0},hideDrawing:function(e){var t=this.getDrawingById(e);if(t.active)return void console.log("can't hide active drawing");t.wrap.setCss({display:"none"}),t.visible=!1},moveDrawing:function(e,t){var i=this.getDrawingById(e);i.viewerDrawing.getViewer().alignDrawing([0,0],[t[0],t[1]]),i.viewerDrawing.update(!0)},startMoving:function(){var e=this;this.isAlignment=!0,this.alignmentPoints=[];var t=this.getActiveDrawing(),i=t.viewerDrawing.getViewer();t.viewerDrawing.setNavigationMode("capture"),i.mouseEditorMgr.editors[0].captureFail=function(t,i,n){return e.verify(t,i,n,!0),!1},this.enterMode(!0)},enterMode:function(e){var t=void 0;t=e?this.getSelectDrawing():this.getActiveDrawing();for(var i=this.sets,n=0;n<i.length;n++)i[n].id!=t.id?(i[n].viewerDrawing.setPrintMode("Custom"),i[n].viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#7D888A"))):e?(i[n].viewerDrawing.setPrintMode("Custom"),i[n].viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#ffffff"))):i[n].viewerDrawing.setPrintMode("Normal")},selectDrawing:function(e){this.selectId=e,this.enterMode(!0)},verify:function(e,t,i,n){if(e){for(var o=this.sets,a=null,r=this.getActiveDrawing().id,s=n?r:this.selectId||r,l=0;l<o.length;l++)if(o[l].id!=s){var c=o[l].viewerDrawing.getViewer(),u=c.snapToPoint(e[0],e[1]),d=u.GetPoint(),h=u.GetID();if(0!=h){var f=u.GetSnapTypeName(),g=this.getActiveDrawing(),p=g.viewerDrawing.getViewer();return e=c.toScreenPoint(d),p.mouseEditorMgr.editors[0].drawTmpPoint(t,i,e,f),a=e}}return a}},getSelectDrawing:function(){return this.selectId?this.getDrawingById(this.selectId):this.getActiveDrawing()},endMoving:function(){this.isAlignment=!1,this.selectId=null,this.getActiveDrawing().viewerDrawing.setNavigationMode("pick"),this.enterMode(!1)},createWrap:function(e){var t=n.create("div",this.rootElement.id+e);return this.rootElement.appendChild(t),t},getOffsetDistance:function(e){return this.getDrawingById(e).viewerDrawing.getViewer().getAlignTranslate()},setActiveDrawing:function(e,t){if(null==e||void 0==e)return console.error("id is necessary!"),!1;var i=this.sets.getObjectByAttribute("active",!0);if(!i||i.id!=e){i&&(i.active=!1,i.wrap.setCss({"z-index":0}));var n=this.getDrawingById(e);n.active=!0,n.wrap.setCss({"z-index":5});var a=this.getRootElement().querySelector(".bf-drawable-context");a&&n.wrap.querySelector(".bf-drawing-container ").appendChild(a),t||this.setDisplayMode(this.getDisplayMode()),this.getEventManager().fireEvent(o.ActiveViewChanged,this)}},getActiveDrawing:function(){return this.sets.getObjectByAttribute("active",!0)},getDrawingById:function(e){return null==e||void 0==e?(console.error("id is necessary!"),!1):this.sets.getObjectByAttribute("id",e)},createSnapshotAsync:function(e,t){var i=void 0,n=document.createElement("canvas"),o=this.getRootElement();n.width=o.clientWidth,n.height=o.clientHeight,e&&(e="rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")");var a=n.getContext("2d");a.beginPath(),a.fillStyle=e||o.style.background,a.fillRect(0,0,n.width,n.height),this.sets.reverse().forEach(function(e){if(e.active)i=e.viewerDrawing.getViewer().snapshotPure();else{var t=e.viewerDrawing.getViewer().snapshotPure();a.drawImage(t,0,0)}}),a.drawImage(i,0,0),t(n.toDataURL())},showLineWidth:function(e){this.sets.forEach(function(t){t.viewerDrawing.showLineWidth(e)})},getBBox:function(e){var t=this.sets.getObjectByAttribute("id",e),i=t.viewerDrawing.getViewer().getModelBBox(),n=i.GetMinPt(),o=i.GetMaxPt();return{min:n.slice(0,2),max:o.slice(0,2)}},home:function(){for(var e=this.sets,t=void 0,i=void 0,n=void 0,a=0;a<e.length;a++){var r=e[a],s=r.id,l=r.active,c=r.viewerDrawing,u=this.getOffsetDistance(s),d=this.getBBox(s);l&&(n=c),t?(t=[Math.min(d.min[0]+u[0],t[0]),Math.min(d.min[1]+u[1],t[1])],i=[Math.max(d.max[0]+u[0],i[0]),Math.max(d.max[1]+u[1],i[1])]):(t=[d.min[0]+u[0],d.min[1]+u[1]],i=[d.max[0]+u[0],d.max[1]+u[1]])}n.getViewer().zoomToWorldBox([t[0],t[1],0],[i[0],i[1],0],1),n.update(),this.activeState=n.getCurrentState(),this.sync(),this.getEventManager().fireEvent(o.Rendered,self)},setDisplayMode:function(e){e=e||0;var t=["Normal","White","Black","Custom"];this.sets.forEach(function(i){i.active?i.viewerDrawing.setPrintMode(t[e]):0==e?(i.viewerDrawing.setPrintMode("Custom"),i.viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#7D888A"))):i.viewerDrawing.setPrintMode(t[e])}),this.getRootElement().setCss({background:0==e?"rgb(50,50,55)":"#fff"}),this._displayMode=e},getDisplayMode:function(){return this._displayMode},getViewMetaData:function(e,t){var i=this,n=Glodon.Bimface.Authentication.AuthenticationManager,o=new Glodon.Bimface.Authentication.AuthenticationConfig;o.viewToken=e,o.APIHost=this._viewConfig.APIHost,(this.authenticate=new n(o)).authenticate(function(e){e.drawingUrl=i._viewConfig.resourceHost+"/"+e.databagId+"/resource/drawing",t(e)})}}),e.ViewerDrawingSet=a}();var CLOUD=window.CLOUD||{};!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{name:"defaultMap",domElement:null,width:240,height:240,viewer:null,axis:!1,host:hostConfig.resourceHost,onCameraChanged:null,inMoveOnAxisGrid:null}};e.MiniMapConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest")),i=function(e){var t=this,i=e;if(t._opt=i,!i.domElement)return console.log("domElement must not be empty."),!1;if(!i.viewer)return console.log("viewer is not defined."),!1;var n=i.viewer.getViewer();t._helper=new CLOUD.Extensions.MiniMapHelper(i.viewer.getViewer());var o=function(){t._helper.renderMiniMap()};n.addCallbacks("render",o),t.init()};i.prototype={init:function(){var e=this,i=e._opt,n={},o=[];e._helper;t.ajax({url:i.host+"/"+i.viewer._data.databagId+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,i.push(r)}n.Grids=i}}),t.ajax({async:!1,url:i.host+"/"+i.viewer._data.databagId+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),t.ajax({async:!1,url:i.host+"/"+i.viewer._data.databagId+"/resource/model/maps/output.json",dataType:"text",success:function(e){var t=JSON.parse(e);for(var n in t){var a=t[n];void 0==a.id&&(a.id=n),a.path=i.host+"/"+i.viewer._data.databagId+"/resource/model/maps/"+a.id+".png",a.name=n,o.push(a)}}}),e._floors=o,e.createMap(n,o)},createMap:function(e,t){var i,n=this._helper,o=this._opt,a={left:0,bottom:0,outling:"none",position:"relative"};n.createMiniMap(o.name,o.domElement,o.width,o.height,a,o.onCameraChanged,o.inMoveOnAxisGrid),e.Grids&&e.Levels&&n.setAxisGridData(o.name,e),t.length>0&&(n.setAllFloorPlaneData(o.name,t),n.setFloorPlaneId(o.name,t[0].name)),n.generateAxisGrid(o.name),n.generateFloorPlane(o.name,!1),n.showAxisGrid(o.name,o.axis),i=n.getMiniMap(o.name),i.setMapClickCallback(function(){})},getFloors:function(){return this._floors},showAxisGrid:function(){this._helper.showAxisGrid(this._opt.name,!0)},hideAxisGrid:function(){this._helper.showAxisGrid(this._opt.name,!1)},showFloorById:function(e){var t=this,i=t._opt.name;t._helper.setFloorPlaneData(i,e),t._helper.generateFloorPlane(i,!0)},resize:function(e,t){this._helper.resize(this._opt.name,e,t)},onClick:function(e,t){var i=this,n=i._opt,e=e||"default",o=i._helper.getMiniMap(n.name);o.setMapClickMode(e),o.setMapClickCallback(function(e){t&&"function"==typeof t&&t(e)})},toLocation:function(e,t){var i=this,n=i._opt;i._helper.getMiniMap(n.name).toLocation(e,t)},imageCoord2WordCoord:function(e,t){var i=this,n=i._opt;return i._helper.getMiniMap(n.name).imageCoord2WordCoord(_defineProperty({x:e},"x",t))}},e.MiniMap=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map"),t=function(){return{id:"defaultMap",name:"defaultMap",domElement:null,viewer:null,width:240,height:240,isShowGrid:!1,navigationMode:"Default",resourceHost:hostConfig.resourceHost}};e.MapConfig=t}(),function(){var e=Object.freeze({ViewerCameraChanged:"ViewerCameraChanged",MouseClicked:"MouseClicked",MouseHoveredGrid:"MouseHoveredGrid",SelectionChanged:"SelectionChanged",SelectionEditor:"SelectionEditor",FloorPlaneChanged:"FloorPlaneChanged"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map").MapEvents=e}(),function(){var e=Object.freeze({Default:"Default",Static:"Static"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map").MapNavigationMode=e}(),function(){var e="Bimface.Plugins.Section.SectionPlane",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=e;if(this.defaultFloorPlane="F01",t._opt=i,t.id=e.id,!i.domElement)return console.log("domElement must not be empty."),!1;if(!i.viewer)return console.log("viewer is not defined."),!1;var n=new Glodon.Web.Lang.EventManager;this.getEventManager=function(){return n};var o=i.viewer.getViewer();t._helper=new CLOUD.Extensions.MiniMapHelper(i.viewer.getViewer()),t.renderCB=function(){t._helper.renderMiniMap()},o.addCallbacks("render",t.renderCB),t.init()});n.prototype={addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},init:function(){t.send(e,"init");var i=this;i._opt.viewer.getMapInfo(function(e){i._floors=e.floors,i.createMap(e.axisGrid,e.floors)})},createMap:function(i,n){t.send(e,"createMap");var o,a=this,r=a.getEventManager(),s=Glodon.Bimface.Plugins.Map.MapEvents,l=(Glodon.Bimface.Plugins.Map.MapNavigationMode,a._helper),c=a._opt,u={left:0,bottom:0,outling:"none",position:"relative"},d=function(e){r.fireEvent(s.ViewerCameraChanged,e)},h=function(e){r.fireEvent(s.MouseHoveredGrid,e)};if(l.createMiniMap(c.name,c.domElement,c.width,c.height,u,d,h),(i.Grids||i.Levels)&&l.setAxisGridData(c.name,i),n.length>0){l.setAllFloorPlaneData(c.name,n);var f=n.getObjectByAttribute("name",this.defaultFloorPlane);0==f?l.setFloorPlaneId(c.name,n[0].id):l.setFloorPlaneId(c.name,f.id)}l.generateAxisGrid(c.name),l.generateFloorPlane(c.name,!1),l.showAxisGrid(c.name,c.isShowGrid),o=l.getMiniMap(c.name),o.setMapClickMode(c.navigationMode.toLocaleLowerCase()),o.setMapClickCallback(function(e){r.fireEvent(s.MouseClicked,e)});var g=o.getMiniMapCallbackHandler();g.addCallbacks("MouseUp",function(e){r.fireEvent("SelectionChanged",e)}),g.addCallbacks("MouseMove",function(){r.fireEvent("SelectionEditor")}),g.addCallbacks("FloorPlaneChanged",function(e){r.fireEvent("FloorPlaneChanged",e)})},setDefaultFloorPlane:function(e){for(var t=this._floors,i=0;i<t.length;i++)if(t[i].name==e){var n=this._helper,o=this.getEventManager();return o.fireEvent("FloorPlaneChanged",e),n.setFloorPlaneId(this._opt.name,e),n.generateFloorPlane(this._opt.name,!1),!0}return!1},getFloorList:function(){return this._floors},getDefaultFloorPlane:function(){return this.defaultFloorPlane},getBoundingBox:function(){return this._helper.getMiniMap(this._opt.name).getBoundingBoxIsolate()},showGrid:function(){this._helper.showAxisGrid(this._opt.name,!0)},hideGrid:function(){this._helper.showAxisGrid(this._opt.name,!1)},showFloorById:function(e){var t=this,i=t._opt.name;t._helper.setFloorPlaneId(i,e),t._helper.generateFloorPlane(i,!0)},resize:function(e,t){this.clear(),this._helper.resize(this._opt.name,e,t)},setNavigationMode:function(e){var t=this._opt,i=this._helper,n=i.getMiniMap(t.name);t.navigationMode=e,n.setMapClickMode(t.navigationMode.toLocaleLowerCase())},clientCoord2WorldCoord:function(e,t){var i=this,n=i._opt;return i._helper.getMiniMap(n.name).imageCoord2WordCoord({x:e,y:t})},clear:function(){this._helper.getMiniMap(this._opt.name).destroyAll()},exit:function(){var e=this;e._opt.viewer.getViewer().removeCallbacks("render",e.renderCB),e.clear()}},i.Map=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){function e(t,i){_classCallCheck(this,e),this.viewer=t.getViewer(),this.enumEventTypes={ON_COMPONENT_HOVER:1e3,ON_COMPONENT_CLICK:1001},this.initialize();var n=this;this.bimcube=new BimCube(i,BimfaceLanguage.name,function(){n.hookEvents(),n.bimcube.update(n.viewer.getActiveCameraInfo())})}return _createClass(e,[{key:"initialize",value:function(){this.enumViewMode={Home:0,Top:1,Bottom:2,Front:3,Back:4,Right:5,Left:6,SouthEast:7,SouthWest:8,NorthEast:9,NorthWest:10,BottomFront:11,BottomBack:12,BottomRight:13,BottomLeft:14,BottomSouthEast:15,BottomSouthWest:16,BottomNorthEast:17,BottomNorthWest:18,RoofFront:19,RoofBack:20,RoofRight:21,RoofLeft:22,RoofSouthEast:23,RoofSouthWest:24,RoofNorthEast:25,RoofNorthWest:26,TopTurnRight:27,TopTurnBack:28,TopTurnLeft:29,BottomTurnRight:30,BottomTurnBack:31,BottomTurnLeft:32,FrontTurnRight:33,FrontTurnTop:34,FrontTurnLeft:35,RightTurnBack:36,RightTurnTop:37,RightTurnFront:38,BackTurnRight:39,BackTurnTop:40,BackTurnLeft:41,LeftTurnFront:42,LeftTurnTop:43,LeftTurnBack:44}}},{key:"hookEvents",value:function(){var e=this.bimcube,t=this.viewer,i=this.enumViewMode;e.addEventListener(this.enumEventTypes.ON_COMPONENT_CLICK,function(e){var n=i[e.viewType];n&&t.setStandardView(n,null,function(){t.render()})}),t.addRenderCallback(function(){e.update(t.getActiveCameraInfo())})}},{key:"setVisible",value:function(e){!0===e?this.bimcube.show():this.bimcube.hide()}}]),e}();e.ViewHouseNavi=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{width:140,height:140,domElement:null,viewer:null}};e.ViewHouseConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Application.UI.Menu"),t=function(e){var t=this,i=e.viewer;this.viewer=i;var n=e.domElement,o=Glodon.Bimface.UI.Control.ControlEvent,a=Glodon.Bimface.Viewer.Viewer3DEvent,r=i.getDomElement(),s=new Glodon.Bimface.UI.Menu.MenuConfig;s.element=n,this.menu=new Glodon.Bimface.UI.Menu.Menu(s),this.menu.element.style.backgroundColor="#EBEFF1",this.menu.element.style.border="1px solid #D0D6D6";var l=this.menu,c=new Glodon.Bimface.UI.Menu.MenuItemConfig;c.id="home";var u=new Glodon.Bimface.UI.Menu.MenuItem(c);u.setText(BimfaceLanguage.bf_viewHouse_home),u.element.addClass("bf-menu-item1"),i.getEventManager().addEvent(a.ToolbarHomeClick,function(){t.switchHomeView()}),u.addEventListener(o.Click,function(){t.switchHomeView(),t.setVisibility("hidden")}),this.switchHomeView=function(){var e=i.getCustomedHomeview(),t=i.getDefaultHomeview(),n=e||t,o=n.name;"orth"==o&&h.setText(BimfaceLanguage.bf_viewHouse_perspective),"persp"==o&&h.setText(BimfaceLanguage.bf_viewHouse_orthographic),i.setCameraStatus(n,function(){0==i.getCameraAnimation()&&i.render()})};var d=new Glodon.Bimface.UI.Menu.MenuItemConfig;d.id="orthographic";var h=new Glodon.Bimface.UI.Menu.MenuItem(d);h.setText(BimfaceLanguage.bf_viewHouse_orthographic),h.element.addClass("bf-menu-item1"),h.addEventListener(o.Click,function(){t.setVisibility("hidden"),h.element.textContent==BimfaceLanguage.bf_viewHouse_orthographic?(i.setCameraType("OrthographicCamera"),i.render(),h.setText(BimfaceLanguage.bf_viewHouse_perspective)):(i.setCameraType("PerspectiveCamera"),i.render(),h.setText(BimfaceLanguage.bf_viewHouse_orthographic))}),this.orthographic=h;var f=new Glodon.Bimface.UI.Menu.MenuItemConfig;f.id="setAsHome";var g=new Glodon.Bimface.UI.Menu.MenuItem(f);g.setText(BimfaceLanguage.bf_viewHouse_setAsHome),g.element.addClass("bf-menu-item1"),g.addEventListener(o.Click,function(){t.setVisibility("hidden");var e=i.getCameraStatus();i.recordCustomedHomeview(e)});var p=new Glodon.Bimface.UI.Menu.MenuItemConfig;p.id="resetHome";var v=new Glodon.Bimface.UI.Menu.MenuItem(p);v.setText(BimfaceLanguage.bf_viewHouse_resetHome),v.element.addClass("bf-menu-item1"),v.addEventListener(o.Click,function(){t.setVisibility("hidden"),i.recordCustomedHomeview(null)});var m=new Glodon.Bimface.UI.Menu.Spacer;m.element.style.backgroundColor="#D0D6D6";var y=new Glodon.Bimface.UI.Menu.Spacer;y.element.style.backgroundColor="#D0D6D6",this.menu.addControl(u),this.menu.addControl(m),this.menu.addControl(h),this.menu.addControl(y),this.menu.addControl(g),this.menu.addControl(v),this.setVisibility=function(e){this.menu.element.style.visibility=e},this.getVisibility=function(){return this.menu.element.style.visibility},this.update=function(){var e=this.viewer.getCameraStatus(),t=e.name;"orth"==t&&this.orthographic.setText(BimfaceLanguage.bf_viewHouse_perspective),"persp"==t&&this.orthographic.setText(BimfaceLanguage.bf_viewHouse_orthographic)},r.addEventListener("mousedown",function(e){l&&t.setVisibility("hidden")})};e.ViewHouseMenu=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var i=e,n=t.create("div","bf-house");n.style.width=i.width+"px",n.style.height=i.height+"px",i.domElement.appendChild(n),this._domElement=n,this._opt=i,this.viewer=i.viewer,this.init()});i.prototype={init:function(){var e=this;this.viewHouseNavi=new Glodon.Bimface.Plugins.ViewHouseNavi(this._opt.viewer,this._domElement);var i=t.createNS("svg","bf-home-svg");i.setAttribute("viewBox","0 0 20 20");var n=t.createNS("g","");n.setAttribute("fill","none"),n.setAttribute("fill-rule","evenodd");var o=t.createNS("polygon","");o.setAttribute("fill","#E3E9EC"),o.setAttribute("points","1.207 9.5 3.5 9.5 3.5 16.499 7.501 16.499 7.503 12.5 12.5 12.5 12.5 16.499 16.5 16.499 16.5 9.5 18.793 9.5 10 .707"),i.addEventListener("mouseover",function(){o.setAttribute("fill","#BAFFEC"),a.setAttribute("fill","#32D3A6")}),i.addEventListener("mouseout",function(){o.setAttribute("fill","#E3E9EC"),a.setAttribute("fill","#BCC0C2")}),i.addEventListener("mousedown",function(){e.viewHouseMenu.switchHomeView()});var a=t.createNS("path","");a.setAttribute("fill","#BCC0C2"),a.setAttribute("d","M10,0 L0,10 L3,10 L3,17 L8,17 L8.003,13.001 L12,13.001 L12,17 L17,17 L17,10 L20,10 L10,0 Z M10,1.414 L17.586,9 L17,9 L16,9 L16,10 L16,16 L13,16 L13,13.001 L13,12 L12,12 L8.003,12 L7.004,12 L7.003,12.999 L7.001,16 L4,16 L4,10 L4,9 L3,9 L2.414,9 L10,1.414 Z"),n.appendChild(o),n.appendChild(a),i.appendChild(n),e._domElement.appendChild(i),this.homeSvg=i;var r=t.createNS("svg","bf-menu-svg");r.setAttribute("viewBox","0 0 20 20"),r.style.position="absolute";var s=t.createNS("g","");s.setAttribute("fill","none"),s.setAttribute("fill-rule","evenodd"),s.setAttribute("transform","translate(3 6)");var l=t.createNS("polygon","");l.setAttribute("fill","#E3E9EC"),l.setAttribute("points","1.207 4.5 6.999 10.292 12.793 4.5");var c=t.createNS("path","");c.setAttribute("fill","#BCC0C2"),c.setAttribute("d","M0.0004,3.9998 L6.9994,10.9998 L13.9994,3.9998 L0.0004,3.9998 Z M2.4144,4.9998 L11.5864,4.9998 L6.9994,9.5858 L2.4144,4.9998 Z");var u=t.createNS("polygon","");u.setAttribute("fill","#E3E9EC"),u.setAttribute("points",".5 2.5 13.5 2.5 13.5 .5 .5 .5");var d=t.createNS("path","");d.setAttribute("fill","#BCC0C2"),d.setAttribute("d","M0,3 L14,3 L14,0 L0,0 L0,3 Z M1,2 L13,2 L13,1 L1,1 L1,2 Z"),r.addEventListener("mouseover",function(){l.setAttribute("fill","#BAFFEC"),c.setAttribute("fill","#32D3A6"),u.setAttribute("fill","#BAFFEC"),d.setAttribute("fill","#32D3A6")}),r.addEventListener("mouseout",function(){l.setAttribute("fill","#E3E9EC"),c.setAttribute("fill","#BCC0C2"),u.setAttribute("fill","#E3E9EC"),d.setAttribute("fill","#BCC0C2")}),s.appendChild(l),s.appendChild(c),s.appendChild(u),s.appendChild(d),r.appendChild(s),e._domElement.appendChild(r),this.menuSvg=r;var h=new Glodon.Bimface.Application.UI.Menu.ViewHouseMenu(this._opt);this.viewHouseMenu=h,h.setVisibility("hidden"),r.addEventListener("click",function(t){var i=e.viewer.getDomElement(),n=i.getBoundingClientRect();if("hidden"==h.getVisibility()){var o={x:r.getBoundingClientRect().right-h.menu.element.clientWidth,y:r.getBoundingClientRect().bottom};o.x-=n.left,o.y-=n.top,h.menu.setPosition(o),h.update(),h.setVisibility("visible")}else h.setVisibility("hidden")})},enableViewHouse:function(e){this.viewHouseNavi.setVisible(e),!0===e?(this.homeSvg.style.display="block",this.menuSvg.style.display="block"):(this.homeSvg.style.display="none",this.menuSvg.style.display="none")},getDomElement:function(){return this._domElement}},e.ViewHouse=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{background:null,domElement:null,viewer:null,style:{"stroke-width":3,"stroke-color":"#ff0000","stroke-opacity":1,"fill-color":"#ff0000","fill-opacity":0,"font-family":"Arial","font-size":16,"font-style":"italic","font-weight":"bold"}}};e.AnnotationConfig=t}(),function(){var e=Object.freeze({Arrow:"Arrow",Rectangle:"Rectangle",Circle:"Circle",Cross:"Cross",Cloud:"Cloud",Text:"Text"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins").AnnotationTypeOption=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){this._opt=e,this.init()});t.prototype={init:function(){var e,t=this,i=t._opt;if(i.viewer)e=new CLOUD.Extensions.AnnotationHelper3D(i.viewer.getViewer());else{if(!i.domElement)return alert("domElement must not be empty."),!1;e=new CLOUD.Extensions.AnnotationHelper2D,e.setDomContainer(i.domElement)}this._helper=e},begin:function(){var e=this._helper,t=this._opt;e.editAnnotationBegin(t.absBasePoint,t.screenBasePoint,t.zoomFactor)},end:function(){this._helper.editAnnotationEnd()},save:function(){return this._helper.getAnnotationInfoList()},load:function(e){var t=this._helper;this._opt;t.loadAnnotations(e)},createSnapshot:function(e,t){return this._helper.captureAnnotationsScreenSnapshot(e,t)},setType:function(e){var t={arrow:0,rectangle:1,circle:2,cross:3,cloud:4,text:5};this._helper.setAnnotationType(t[e.toLocaleLowerCase()])},setStyle:function(e){this._helper.setAnnotationStyle(e)},destroy:function(){this._helper.destroy()}},e.Annotation=t,e.Annotation.Annotation=e.Annotation,e.Annotation.AnnotationConfig=e.AnnotationConfig}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=function(){return{viewer:null,lineWidth:3,lineColor:new Glodon.Web.Graphics.Color(208,2,27,1),fillColor:new Glodon.Web.Graphics.Color(255,255,255,0),fontFamily:"Arial",fontSize:14}};e.AnnotationManagerConfig=t}(),function(){var e=Object.freeze({Arrow:"Arrow",Rectangle:"Rectangle",Circle:"Ellips",Ellips:"Ellips",Cross:"Cross",Cloud:"Cloud",CloudRect:"Cloud-rect",Text:"Text",Polyline:"Polyline"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation").AnnotationTypeOption=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){});t.prototype={init:function(){var e,t=this,i=t._opt;e=new CLOUD.Extensions.AnnotationHelper3D(i.viewer.getViewer(),i),this._helper=e},startDrawing:function(){var e=this._helper;this._opt;e.editAnnotationBegin(),this.isShowAnnotation=!0},getAnnotationList:function(){return this._helper.getAnnotationInfoList()},setAnnotationList:function(e){if(!e||0==e.length)return void this.clear();this._annotationList=e,this._helper.loadAnnotations(e),this.isShowAnnotation=!0},createSnapshot:function(e){var t=this;t._opt.viewer;t._helper.captureAnnotationsScreenSnapshot("",e)},setState:function(e){var t=this,i=t._opt.viewer;i.setState(e.state),i.render(),setTimeout(function(){t.setAnnotationList(e.annotationList)},1e3)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationViewer3dManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=Glodon.Bimface.Viewer.Viewer2DEvent,i=e.viewer,n=this;i.addEventListener(t.ViewMoving,function(e){n.updateSvg()}),i.addEventListener(t.ViewZooming,function(e){n.updateSvg()})});t.prototype={init:function(){var e,t=this,i=t._opt;e=new CLOUD.Extensions.AnnotationHelper2D(i),e.setDomContainer(i.viewer.getDomElement()),this._helper=e},startDrawing:function(){var e=this._helper,t=this._opt;e.editAnnotationBegin();t.viewer.getZoomScale();e.editor.svg.addEventListener("mousewheel",function(e){e.preventDefault(),e.stopPropagation()}),this.isShowAnnotation=!0},getAnnotationList:function(){var e=this,t=this._helper.getAnnotationInfoList();if(t&&t.length>0)for(var i=e._opt.viewer,n=i.getZoomScale(),o=0,a=t.length;o<a;o++)t[o].worldPosition=e.getWorldPosition(t[o]),t[o].defaultSize={width:t[o].size.width/n,height:t[o].size.height/n};return t},setAnnotationList:function(e){if(!e||0==e.length)return void this.clear();for(var t=this._opt.viewer.getZoomScale(),i=0,n=e.length;i<n;i++)e[i].position=this.getSVGPosition(e[i],t),e[i].size.width=e[i].defaultSize.width*t,e[i].size.height=e[i].defaultSize.height*t;this._annotationList=e,this._helper.loadAnnotations(e),this.isShowAnnotation=!0},createSnapshot:function(e){var t=this;t._opt.viewer.createSnapshotAsync("",function(i){t._helper.captureAnnotationsScreenSnapshot(i,e)})},setState:function(e){var t=this;t._opt.viewer.setState(e.state),t.setAnnotationList(e.annotationList)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationViewer2dManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){this._viewer=e,this.drawingViewer=e.getViewer()});t.prototype={init:function(){var e,t=this,i=t._opt;e=this.drawingViewer.mouseEditorMgr,this.type="arrow",this.setLineWidth(i.lineWidth),this.setLineColor(i.lineColor),this.setFillColor(i.fillColor),this.setFontFamily(i.fontFamily),this.setFontSize(i.fontSize),this._helper=e},startDrawing:function(){var e,t=this._helper;this._opt;t.activeEditorByName("markup"),e=t.getEditor(),e.setMarkupType(this.type),this.annotationToolbar&&(this.setLineColor({red:208,green:2,blue:27,alpha:1}),this.setLineWidth(2)),this.editor=e,this.isShowAnnotation=!0},endDrawing:function(){this.drawingViewer.markupManager.setFillColor("transparent"),this.clear(),this._helper.activeEditorByName("pick"),this.drawingViewer.update(),this.isShowAnnotation=!1},getAnnotationList:function(){return this.drawingViewer.markupManager.markups},setAnnotationList:function(e){this.drawingViewer.markupManager.markups=e,this.drawingViewer.update()},clear:function(){this.drawingViewer.markupManager.clear(),this.drawingViewer.update()},createSnapshot:function(e){var t=this._viewer.getRootElement();e(this.drawingViewer.snapshot(t.style.background))},resize:function(){this._viewer.resize()},setAnnotationType:function(e){var t={arrow:"arrow",rectangle:"rectangle","cloud-rect":"cloud-rect",circle:"ellips",cross:"cross",cloud:"cloud",text:"text"};this.type=t[e.toLocaleLowerCase()],this.editor&&this.editor.setMarkupType(this.type)},setLineWidth:function(e){this.drawingViewer.markupManager.setLineWidth(e)},setLineColor:function(e){this.drawingViewer.markupManager.setColor("rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")")},setFillColor:function(e){this.drawingViewer.markupManager.setFillColor("rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")")},setFontFamily:function(e){this.drawingViewer.markupManager.setFontFamily(e)},setFontSize:function(e){this.drawingViewer.markupManager.setFontSize(e)},getCurrentState:function(){
var e=this,t=e._opt.viewer,i=this.getAnnotationList();return{annotationList:this.stringifyAnnotationList(i),state:t.getCurrentState()}},stringifyAnnotationList:function(e){return this.drawingViewer.markupManager.toString(e)},jsonifyAnnotationList:function(e){return this.drawingViewer.markupManager.fromString(e)},setState:function(e){var t=this,i=t._opt.viewer;if("string"==typeof e.annotationList){var n=this.jsonifyAnnotationList(e.annotationList);this.setAnnotationList(n)}else this.setAnnotationList(e.annotationList);i.setState(e.state)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getWorldPosition:function(e){var t=this._opt.viewer,i={x:t.screenWidth/2,y:t.screenHeight/2},n={x:i.x+e.position.x,y:i.y-e.position.y};return t.clientToWorld(n)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationDrawingManager=t}(),function(){var e="Bimface.Plugins.Annotation.AnnotationManager",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=e.viewer;this._opt=e,this.isShowAnnotation=!1,this.historyQueue=[],Glodon.Bimface.Viewer.Viewer3D&&i instanceof Glodon.Bimface.Viewer.Viewer3D?this._helper=new MarkupViewer3D(i,i._opt.domElement):Glodon.Bimface.Viewer.Viewer2D&&i instanceof Glodon.Bimface.Viewer.Viewer2D?this._helper=new MarkupViewer2D(i,i._opt.domElement.querySelector(".bf-image")):this._helper=new MarkupDrawing(i,i._opt.domElement),this._helper.viewer.onSelectChange=function(e){t.onSelectChange(e)},this.init()});n.prototype={init:function(){var e=this,t=e._opt;t.lineWidth&&this.setLineWidth(t.lineWidth),t.lineColor&&this.setLineColor(t.lineColor),t.fillColor&&this.setFillColor(t.fillColor),t.fontFamily&&this.setFontFamily(t.fontFamily),t.fontSize&&this.setFontSize(t.fontSize)},exit:function(){this.endDrawing()},onSelectChange:function(e){},getAnnotationList:function(){return this._helper.getAnnotationList()},setAnnotationList:function(e){e.length>0&&e[0].id&&(e=this._helper.transform(e)),this._helper.setAnnotationList(e),this._helper.update()},setState:function(e){this._helper.setState(e)},createSnapshot:function(e){this._helper.createSnapshot(e)},startDrawing:function(){this._helper.startDrawing()},endDrawing:function(){t.send(e,"endDrawing"),this._helper.editAnnotationEnd(),this.isShowAnnotation=!1},clear:function(){t.send(e,"clear"),this._helper.clearAnnotations()},resize:function(){},setAnnotationType:function(i){t.send(e,"setAnnotationType"),this._helper.setAnnotationType(i.toLocaleLowerCase())},setLineWidth:function(i){t.send(e,"setLineWidth"),this._helper.setAnnotationStyle({"stroke-width":i})},setLineColor:function(i){t.send(e,"setLineColor"),this._helper.setAnnotationStyle({"stroke-color":""+i.getRGBA()})},setFillColor:function(i){t.send(e,"setFillColor"),this._helper.setAnnotationStyle({"fill-color":""+i.getRGBA()})},setFontFamily:function(i){t.send(e,"setFontFamily"),this._helper.setAnnotationStyle({"font-family":i})},setFontSize:function(i){t.send(e,"setFontSize"),this._helper.setAnnotationStyle({"font-size":i})},removeSelectedAnnotation:function(){this._helper.removeSelectedAnnotation()},showAnnotation:function(){this._helper.showAnnotation()},hideAnnotation:function(){this._helper.hideAnnotation()},setStyle:function(e){this._helper.setAnnotationStyle(e)},destroy:function(){this.endDrawing()},getCurrentState:function(){return this._helper.getCurrentState()},getWorldPosition:function(e){var t=this._opt.viewer,i={x:t.screenWidth/2,y:t.screenHeight/2},n={x:i.x+e.position.x,y:i.y-e.position.y};return t.clientToWorld(n)},inherit:function(e){for(var t in e)this[t]=e[t]},stringifyAnnotationList:function(e){return this._helper.markupManager.toString(e)},jsonifyAnnotationList:function(e){return this._helper.markupManager.fromString(e)}},i.AnnotationManager=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=function(){};e.AnnotationToolbarConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=Object.freeze({Saved:"Saved",Cancelled:"Cancelled"});e.AnnotationToolbarEvent=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Bimface.Plugins.Annotation.AnnotationToolbarEvent),n=function(e){var n=this._eventManager=new Glodon.Web.Lang.EventManager,o=[],a=e.viewer,r=Glodon.Bimface.Viewer.ViewerDrawing&&a instanceof Glodon.Bimface.Viewer.ViewerDrawing;this.isDrawing=r;var s=t.create("div","bf-annotation bf-hide");this.domElement=s;var l=Glodon.Bimface.Plugins.Annotation.AnnotationTypeOption,c=new Glodon.Bimface.Plugins.Annotation.AnnotationManagerConfig,u=c.lineColor;c.viewer=a,c.annotationCallback=e.annotationCallback;var d=new Glodon.Bimface.UI.Toolbar.ToolbarConfig;d.element=s,d.className="bf-toolbar bf-toolbar-annotation";var h=this.annotationToolbar=new Glodon.Bimface.UI.Toolbar.Toolbar(d);this.annotationToolbar=h,o.push(h),r&&(c.annotationToolbar=h);var f=this._annotationManager=new Glodon.Bimface.Plugins.Annotation.AnnotationManager(c);a.getDomElement().appendChild(s),s.addEventListener("mousedown",function(e){e.stopPropagation()}),s.addEventListener("touchstart",function(e){e.stopPropagation()}),s.addEventListener("touchmove",function(e){e.stopPropagation()});var g=new Glodon.Bimface.UI.Toolbar.ToolbarConfig;g.element=s,g.className="bf-toolbar bf-toolbar-control";var p=new Glodon.Bimface.UI.Toolbar.Toolbar(g);o.push(p);var v=new Glodon.Bimface.UI.Button.ButtonConfig;v.className="bf-button gld-bf-narrow ",v.title="箭头",r&&(v.id="arrow"),v.groupName="Annotation";var m=new Glodon.Bimface.UI.Button.SingleButton(v);m.addEventListener("Click",function(){f.setAnnotationType(l.Arrow),Y.show(),te.hide()}),h.addControl(m);var y=new Glodon.Bimface.UI.Button.ButtonConfig;y.className="bf-button gld-bf-n-cloud",y.title="云线框",y.groupName="Annotation";var w=new Glodon.Bimface.UI.Button.SingleButton(y);w.addEventListener("Click",function(){f.setAnnotationType(l.CloudRect),Y.show(),te.hide()}),h.addControl(w);var b=new Glodon.Bimface.UI.Button.ButtonConfig;b.className="bf-button gld-bf-ncloud",b.title="云线",b.groupName="Annotation";var C=new Glodon.Bimface.UI.Button.SingleButton(b);C.addEventListener("Click",function(){f.setAnnotationType(l.Cloud),Y.show(),te.hide()}),h.addControl(C);var x=new Glodon.Bimface.UI.Button.ButtonConfig;x.className="bf-button gld-bf-n-ployline",x.title="折线",x.groupName="Annotation";var P=new Glodon.Bimface.UI.Button.SingleButton(x);P.addEventListener("Click",function(){f.setAnnotationType(l.Polyline),Y.show(),te.hide()}),h.addControl(P);var k=new Glodon.Bimface.UI.Button.ButtonConfig;k.className="bf-button gld-bf-nrectangle",k.title="矩形",k.groupName="Annotation";var M=new Glodon.Bimface.UI.Button.SingleButton(k);M.addEventListener("Click",function(){f.setAnnotationType(l.Rectangle),Y.show(),te.hide()}),h.addControl(M);var I=new Glodon.Bimface.UI.Button.ButtonConfig;I.className="bf-button gld-bf-noval",I.title="椭圆",I.groupName="Annotation";var E=new Glodon.Bimface.UI.Button.SingleButton(I);E.addEventListener("Click",function(){f.setAnnotationType(l.Ellips),Y.show(),te.hide()}),h.addControl(E);var A=new Glodon.Bimface.UI.Button.ButtonConfig;A.className="bf-button gld-bf-mark",A.title="X",A.groupName="Annotation";var S=new Glodon.Bimface.UI.Button.SingleButton(A);S.addEventListener("Click",function(){f.setAnnotationType(l.Cross),Y.show(),te.hide()}),h.addControl(S);var B=new Glodon.Bimface.UI.Button.ButtonConfig;B.className="bf-button gld-bf-ntext",B.title="文字",B.groupName="Annotation";var _=new Glodon.Bimface.UI.Button.SingleButton(B);_.addEventListener("Click",function(){f.setAnnotationType(l.Text),Y.hide(),te.show()}),h.addControl(_);var D=new Glodon.Bimface.UI.Button.ButtonConfig;D.className="bf-combobox bf-color",D.title="颜色",r&&(D.id="color");var L=new Glodon.Bimface.UI.Button.ComboBox(D),G=new Glodon.Bimface.UI.Button.ButtonConfig;G.className="bf-button bf-color",G.title="红",r&&(G.id="red");var T=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(G);T.color=new Glodon.Web.Graphics.Color(208,2,27,1);var N=t.create("div","bf-color-button");N.setCss({backgroundColor:"#"+T.color.getHEX()}),T.setHtml(N.outerHTML),L.addControl(T);var O=new Glodon.Bimface.UI.Button.ButtonConfig;O.className="bf-button bf-color",O.title="黄";var W=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(O);W.color=new Glodon.Web.Graphics.Color(245,166,35,1);var U=t.create("div","bf-color-button");U.setCss({backgroundColor:"#"+W.color.getHEX()}),W.setHtml(U.outerHTML),L.addControl(W);var V=new Glodon.Bimface.UI.Button.ButtonConfig;V.className="bf-button bf-color",V.title="蓝";var H=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(V);H.color=new Glodon.Web.Graphics.Color(74,144,226,1);var R=t.create("div","bf-color-button");R.setCss({backgroundColor:"#"+H.color.getHEX()}),H.setHtml(R.outerHTML),L.addControl(H);var z=new Glodon.Bimface.UI.Button.ButtonConfig;z.className="bf-button bf-color",z.title="绿";var F=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(z);F.color=new Glodon.Web.Graphics.Color(126,211,33,1);var j=t.create("div","bf-color-button");j.setCss({backgroundColor:"#"+F.color.getHEX()}),F.setHtml(j.outerHTML),L.addControl(F),h.addControl(L);var X=new Glodon.Bimface.UI.Button.ButtonConfig;X.className="bf-combobox",X.title="粗细",r&&(X.id="line");var Y=new Glodon.Bimface.UI.Button.ComboBox(X),X=new Glodon.Bimface.UI.Button.ButtonConfig;X.className="bf-button bf-line",X.title="细",r&&(X.id="fine");var Z=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(X);Z.lineWidth=3;var q=t.create("div","bf-line-button");q.setCss({height:Z.lineWidth+"px",backgroundColor:"#"+u.getHEX(),margin:(32-Z.lineWidth)/2+"px 4px"}),Z.element.appendChild(q),Y.addControl(Z),X.title="中";var J=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(X);J.lineWidth=6;var K=t.create("div","bf-line-button");K.setCss({height:J.lineWidth+"px",backgroundColor:"#"+u.getHEX(),margin:(32-J.lineWidth)/2+"px 4px"}),J.element.appendChild(K),Y.addControl(J),X.title="粗";var Q=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(X);Q.lineWidth=10;var $=t.create("div","bf-line-button");$.setCss({height:Q.lineWidth+"px",backgroundColor:"#"+u.getHEX(),margin:(32-Q.lineWidth)/2+"px 4px"}),Q.element.appendChild($),Y.addControl(Q),L.addEventListener("Change",function(e){f.setLineColor(e.color),u=e.color;u.getHEX();q.setCss({height:Z.lineWidth+"px",backgroundColor:"#"+u.getHEX(),margin:(32-Z.lineWidth)/2+"px 4px"}),K.setCss({height:J.lineWidth+"px",backgroundColor:"#"+u.getHEX(),margin:(32-J.lineWidth)/2+"px 4px"}),$.setCss({height:Q.lineWidth+"px",backgroundColor:"#"+u.getHEX(),margin:(32-Q.lineWidth)/2+"px 4px"});var t=Y.getCurrentControl();Y.setSelectedControlById(t.getId())}),Y.addEventListener("Change",function(e){f.setLineWidth(e.lineWidth)}),h.addControl(Y);var ee=new Glodon.Bimface.UI.Button.ButtonConfig;ee.className="bf-combobox bf-font-button",ee.title="字号";var te=new Glodon.Bimface.UI.Button.ComboBox(ee),ie=new Glodon.Bimface.UI.Button.ButtonConfig;ie.className="bf-button bf-size",ie.title="14";var ne=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(ie);ne.fontSize=14,ne.setHtml("14"),te.addControl(ne),ie.title="18";var oe=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(ie);oe.fontSize=18,oe.setHtml("18"),te.addControl(oe),ie.title="24";var ae=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(ie);ae.fontSize=24,ae.setHtml("24"),te.addControl(ae),te.addEventListener("Change",function(e){f.setFontSize(e.fontSize)}),te.hide(),h.addControl(te);var re=new Glodon.Bimface.UI.Button.ButtonConfig;re.className="bf-save",re.title="保存";var se=new Glodon.Bimface.UI.Button.SingleButton(re);se.setHtml("保存"),se.addEventListener("Click",function(){r?n.fireEvent(i.Saved,{annotationList:f.getAnnotationList()}):n.fireEvent(i.Saved,{annotationList:f.getAnnotationList(),state:f.getCurrentState()}),f.endDrawing(),s.addClass("bf-hide")}),p.addControl(se);var le=new Glodon.Bimface.UI.Button.ButtonConfig;le.className="bf-cancel",le.title="取消";var ce=new Glodon.Bimface.UI.Button.SingleButton(le);ce.setHtml("取消"),ce.addEventListener("Click",function(){f.endDrawing(),n.fireEvent(i.Cancelled),s.addClass("bf-hide")}),p.addControl(ce),this.getEventManager=function(){return n}};n.prototype={getEventManager:function(){return this._eventManager},addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},show:function(e,t){this.isDrawing||this._annotationManager.clear(),this._annotationManager.startDrawing(),this.domElement.removeClass("bf-hide")},getAnnotationManager:function(){return this._annotationManager},exit:function(){this.annotationToolbar.hide(),this.getAnnotationManager().exit()}},e.AnnotationToolbar=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{viewer:null}};e.TagConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=this._viewer=e.viewer.getViewer();if(this._opt=e,this._renderCallback=function(){t.resize()},e.minimap){this.mapHelper=e.minimap;var n=new CLOUD.View2dAdapter(this.mapHelper,i);this.mapHelper.setMinimapResizeCallback(function(e){t._tagHelper.updateGroupName(),t._tagHelper.updateDomContainer(),t._tagHelper.resize(e),t._tagHelper.updateByGroup()}),this.mapHelper.setPlaneChangedCallback(function(){t._tagHelper.updateGroupName(),t._tagHelper.updateByGroup()})}else{var n=new CLOUD.View3dAdapter(i);i.addCallbacks("render",this._renderCallback)}this._tagHelper=new CLOUD.Extensions.MarkerEditor(n),this._tagHelper.disableInteractions(!0),this.init()});t.prototype={init:function(){this._tagHelper.isInitialized()||this._tagHelper.init()},addTag:function(e,t){if(!e)return!1;var i=!1,n=this.getTags();e.userId=e.objectId,e.worldBoundingBox=e.boundingBox,e.worldPosition||(e.worldPosition={x:(e.worldBoundingBox.min.x+e.worldBoundingBox.max.x)/2,y:(e.worldBoundingBox.min.y+e.worldBoundingBox.max.y)/2,z:(e.worldBoundingBox.min.z+e.worldBoundingBox.max.z)/2});for(var o=0,a=n.length;o<a;o++){if(n[o].userId==e.userId)return i=!0,!1}e.floorList?this._tagHelper.setMarkerGroups(e.floorList):this._tagHelper.setMarkerGroups([]),this._tagHelper.updateGroupName(),i||this._tagHelper.createMarkerByIntersect(e,t.shape,t.image,t.size)},deleteTag:function(e,t){var i=this;if(t)return this._tagHelper.removeMarkerInGroup(e,t),!1;for(var n=this.getTags(),o=0,a=n.length;o<a;o++){var r=n[o];if(r.userId==e)return i._tagHelper.deleteMarker(r),!1}},destroy:function(){this._viewer.removeCallbacks("render",this._renderCallback),this._tagHelper.markerClickCallback=null,this.unLoadTags(),this._tagHelper.clearMarkers(),this._tagHelper=null},loadTags:function(e){this._tagHelper.loadMarkers(e)},unLoadTags:function(){this._tagHelper.unloadMarkers()},getTags:function(){return this._tagHelper.getMarkerInfoList()},getTagById:function(e){return this._tagHelper.getMarker(e)},zoomToSelectedTag:function(){this._tagHelper.zoomToSelectedMarkers()},resize:function(){this._tagHelper.onResize()},onSelected:function(e){this._tagHelper.setMarkerClickCallback(e)}},e.Tag=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=function(){return{viewer:null,maxNum:20,affectedBySection:!0}};e.DrawableContainerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=function(){return{id:null,tooltip:"",tooltipStyle:{},draggable:!1,worldPosition:new Glodon.Web.Geometry.Point3d(0,0,0),angle:0}};e.DrawableItemConfig=t}(),function(){var e="Bimface.Plugins.Drawable.DrawableItem",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Common.MouseButton,function(e){this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID(),e.worldPosition?this.worldPosition=e.worldPosition:console.log("worldPosition must not be empty."),void 0!=e.viewerDrawingId&&(this.viewerDrawingId=e.viewerDrawingId),this.angle=e.angle});n.prototype={draw:function(e){},onClick:function(i){t.send(e,"onClick"),this._onclick=i},onRightClick:function(i){t.send(e,"onRightClick"),this._onrightclick=i},onEndDrag:function(i){t.send(e,"onEndDrag"),this._onenddrag=i},setTooltip:function(i){t.send(e,"setTooltip"),this.tipElement.querySelector("span").innerText=i},setTooltipStyle:function(i){t.send(e,"setTooltipStyle");for(var n in i)this.tipElement.style[n]=i[n]},getTooltip:function(){return this.tipElement.querySelector("span").innerText},getTooltipStyle:function(){return this.tipElement.style},getWorldPosition:function(){return this.worldPosition},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.worldPosition=i},hide:function(){t.send(e,"hide"),this._domElement.style.display="none"},show:function(){t.send(e,"show"),this._domElement.style.display=""}},i.DrawableItem=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(){this.rootDomElement=t.create("div","bf-drawable-context"),this.clientPosition=null};i.prototype.destroy=function(){this.rootDomElement.parentElement&&this.rootDomElement.parentElement.removeChild(this.rootDomElement)},e.DrawableContext=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:32,height:32,opacity:.75,src:null,offsetX:0,offsetY:0};return Object.assign({},t,e)};e.ImageConfig=i}(),function(){var e="Bimface.Plugins.Drawable.Image",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Bimface.Plugins.Drawable.DrawableItem,o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),r=function(e){n.call(this,e);var t=this,i=!1,a=o.create("img","bf-drawable-image");a.draggable=!1,a.src=e.src,a.style.width=e.width+"px",a.style.height=e.height+"px",a.style.opacity=""+e.opacity,a.style.transform="rotate("+e.angle+"deg)",this._config=e,this._domElement=a,this.clientPosition={};var r,s=function(e){var n,o=t.viewer,a=o instanceof Glodon.Bimface.Viewer.Viewer3D,s={x:e.x-r.x+t.clientPosition.x,y:e.y-r.y+t.clientPosition.y};if(a){n=o.pickByPoint(s).worldPosition}else n=o.clientToWorld(s);n?(t.worldPosition=n,t.update(),t._onenddrag&&t._onenddrag(t),i=!1):t.update()},l=function(e){r=e,i=!0};e.draggable&&o.drag({element:a,cursor:"pointer",end:s,start:l}),a.addEventListener("mouseup",function(e){var n=e||window.event;"0"==n.button&&t._onclick&&(!i||r.x==n.clientX&&r.y==n.clientY)&&t._onclick(t)}),a.addEventListener("mousedown",function(e){var i=e||window.event;i.stopPropagation(),"2"==i.button&&t._onrightclick?t._onrightclick(t):"1"==i.button&&t._onmiddleclick&&t._onmiddleclick(t)})};a.Type.inheritPrototype(r,n);var s={draw:function(e){var t=this._domElement,i=this._config;this.clientPosition=e.clientPosition,t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",e.rootDomElement.appendChild(t)},getWidth:function(){return this._config.width},setWidth:function(i){t.send(e,"setWidth");var n=this._config.width,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.left);this._config.width=i,o.style.width=i+"px",o.style.left=r+a+"px"},getHeight:function(){return this._config.height},setHeight:function(i){t.send(e,"setHeight");var n=this._config.height,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.top);this._config.height=i,o.style.height=i+"px",o.style.top=r+a+"px"},getOpacity:function(){return this._config.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._config.opacity=i,this._domElement.style.opacity=i},getSrc:function(){return this._config.src},setSrc:function(i){t.send(e,"setSrc"),this._config.src=i,this._domElement.src=i},getOffsetX:function(){return this._config.offsetX},setOffsetX:function(i){t.send(e,"setOffsetX");var n=this._config.offsetX,o=this._domElement,a=i-n,r=parseInt(o.style.left);this._config.offsetX=i,o.style.left=r+a+"px"},getOffsetY:function(){return this._config.offsetY},setOffsetY:function(i){t.send(e,"setOffsetY");var n=this._config.offsetY,o=this._domElement,a=i-n,r=parseInt(o.style.top);this._config.offsetY=i,o.style.top=r+a+"px"},getAngle:function(){return this.angle},setAngle:function(i){t.send(e,"setAngle"),this.angle=i,this._domElement.style.transform="rotate("+i+"deg)"}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(s,r),i.Image=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:0,height:0,opacity:.75,content:"",offsetX:0,offsetY:0,viewer:null};return Object.assign({},t,e)};e.CustomItemConfig=i}(),function(){var e="Bimface.Plugins.Drawable.CustomItem",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),o=Glodon.Bimface.Plugins.Drawable.DrawableItem,a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),r=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility");n.IE11Store={};var s=function(e){o.call(this,e);var t=!1,i=this,n=Glodon.Bimface.Viewer.ViewerDrawing&&e.viewer instanceof Glodon.Bimface.Viewer.ViewerDrawing,r=a.create("div","bf-drawable-text");r.style.width=e.width+"px",r.style.height=e.height+"px";var s=a.create("div","bf-drawable-contentwrap");r.appendChild(s),this._domElement=r,this.name="customItem",this._contentElement=s,this._config=e;var l;this.clientPosition={},this.setContent(e.content);var c=a.create("div","bf-tooltip");c.style.display="none",c.innerHTML='<div class="bf-tooltip-content"><div class="bf-tooltip-arrow"></div><div class="bf-tooltip-inner"><span>'+e.tooltip+"</span></div></div>",c.style.left=e.width+"px",c.style.top="-"+e.height+"px";var u=e.tipCSS;for(var d in u)c.style[d]=u[d];this.tipElement=c,r.appendChild(c);var h=function(e){var o,a=i.viewer,r=Glodon.Bimface.Viewer.Viewer3D&&a instanceof Glodon.Bimface.Viewer.Viewer3D,s=a.getDomElement().getBoundingClientRect(),c={x:e.x-l.x+i.clientPosition.x+s.left,y:e.y-l.y+i.clientPosition.y+s.top};if(r){var u=a.pickByPoint(c);o=u.worldPosition}else if(n){var u=a.getViewer().toWorldPoint([c.x,c.y]);o={x:u[0],y:u[1]}}else o=a.clientToWorld(c);o?(i.worldPosition=o,i.update(),i._onenddrag&&i._onenddrag(i),t=!1):i.update()},f=function(e){l=e,t=!0};e.draggable&&a.drag({element:r,cursor:"pointer",end:h,start:f}),r.style.width=e.width+"px",r.style.height=e.height+"px",r.style.opacity=""+e.opacity,r.addEventListener("mouseover",function(e){i.tipElement&&i.tipElement.querySelector("span").innerText.length>0&&(i.tipElement.style.display="block")}),r.addEventListener("mouseout",function(e){i.tipElement&&(i.tipElement.style.display="none")}),r.addEventListener("keydown",function(e){e.stopPropagation()}),r.addEventListener("mouseup",function(e){var n=e||window.event;"0"==n.button&&i._onclick&&(!t||l.x==n.clientX&&l.y==n.clientY)&&i._onclick(i)}),r.addEventListener("mousedown",function(e){var t=e||window.event;t.stopPropagation(),"2"==t.button&&i._onrightclick?i._onrightclick(i):"1"==t.button&&i._onmiddleclick&&i._onmiddleclick(i)}),r.addEventListener("touchstart",function(e){(e||window.event).stopPropagation()}),r.addEventListener("touchmove",function(e){(e||window.event).stopPropagation()}),r.addEventListener("touchend",function(e){var n=e||window.event;n.stopPropagation(),i._onclick&&(!t||l.x==n.clientX&&l.y==n.clientY)&&i._onclick(i)})};r.Type.inheritPrototype(s,o);var l={draw:function(e){var t=this._domElement,i=this._config;this.clientPosition=e.clientPosition,t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",""==t.innerHTML&&(this.dom&&this.domId?t.appendChild(n.IE11Store[this.domId].cloneNode(!0)):this.text&&(t.innerText=this.text)),e.rootDomElement.contains?e.rootDomElement.contains(t)||e.rootDomElement.appendChild(t):e.rootDomElement.appendChild(t)},getWidth:function(){return this._config.width},setWidth:function(i){t.send(e,"setWidth");var n=this._config.width,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.left);this._config.width=i,o.style.width=i+"px",o.style.left=r+a+"px"},getHeight:function(){return this._config.height},setHeight:function(i){t.send(e,"setHeight");var n=this._config.height,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.top);this._config.height=i,o.style.height=i+"px",o.style.top=r+a+"px"},getOpacity:function(){return this._config.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._config.opacity=i,this._domElement.style.opacity=i},getContent:function(){return this._config.content||this.text},setContent:function(i){t.send(e,"setContent"),this._contentElement.innerHTML="",i instanceof HTMLElement?(i.draggable=!1,this._config.content=i,this._domElement.content=i,this.dom=i,this.domId||(this.domId=Glodon.Web.Lang.Utility.UUID.createUUID()),n.IE11Store[this.domId]=i.cloneNode(!0),this._contentElement.appendChild(i)):(this._contentElement.innerHTML=i,this.text=i,this._config.content="")},getOffsetX:function(){return this._config.offsetX},setOffsetX:function(i){t.send(e,"setOffsetX");var n=this._config.offsetX,o=this._domElement,a=i-n,r=parseInt(o.style.left);this._config.offsetX=i,o.style.left=r+a+"px"},getOffsetY:function(){return this._config.offsetY},setOffsetY:function(i){t.send(e,"setOffsetY");var n=this._config.offsetY,o=this._domElement,a=i-n,r=parseInt(o.style.top);this._config.offsetY=i,o.style.top=r+a+"px"}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(l,s),i.CustomItem=s}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e,i={text:null,viewer:null,objectId:null,containerCss:(e={boxSizing:"border-box",fontSize:"12px",lineHeight:1.5,borderWidth:"2px",borderStyle:"solid",padding:"5px",borderColor:"#1f93ff",backgroundColor:"#eeeeee"},_defineProperty(e,"padding","2px 8px"),_defineProperty(e,"opacity",.9),e),lineCss:{width:"1px",color:"#1f93ff"},pointCss:{radius:4,backgroundColor:"#1f93ff",borderColor:"#ffffff",borderStyle:"solid",borderWidth:"1px"},offset:{x:27,y:-47},height:26,width:140};return Object.assign({},t,i)};e.LeadLabelConfig=i}(),function(){var e="Bimface.Plugins.Drawable.LeadLabel",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Bimface.Plugins.Drawable.DrawableItem,o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),r=function(e){n.call(this,e);var t=this,i=o.create("div","bf-drawable-lead-label"),a=o.create("div","bf-drawable-lead-label-textarea");i.appendChild(a);var r=o.createNS("line","bf-drawable-lead-line"),s=o.createNS("line","bf-drawable-lead-line"),l=o.createNS("circle","bf-drawable-lead-point"),c=o.createNS("g","bf-drawable-group"),u=e.viewer;t._text=e.text,i.setCss(e.containerCss),a.innerText=t._text.replace(/\n/g," "),i.style.width=parseFloat(e.width)+"px",i.style.height=parseFloat(e.height)+"px";var d=Math.trunc((e.height-8)/18);a.style.webkitLineClamp=d||1,s.setAttribute("stroke-width",e.lineCss.width),s.style.stroke=e.lineCss.color,r.setAttribute("stroke-width",e.lineCss.width),r.style.stroke=e.lineCss.color,l.setAttribute("r",e.pointCss.radius),l.style.fill=e.pointCss.backgroundColor,l.setAttribute("stroke-width",e.pointCss.borderWidth),l.style.stroke=e.pointCss.borderColor,s.setAttribute("x1",0),s.setAttribute("y1",0-e.offset.y+18),s.setAttribute("x2",e.offset.x),s.setAttribute("y2",18),r.setAttribute("x1",e.offset.x),r.setAttribute("y1",18),r.setAttribute("x2",e.offset.x+23),r.setAttribute("y2",18),l.setAttribute("cx",0),l.setAttribute("cy",18-e.offset.y);var h,f=function(e){h=e},g=function(i){var n={x:i.x-h.x+t.clientPosition.x,y:i.y-h.y+t.clientPosition.y};c.setAttribute("transform","translate("+n.x+","+(n.y+e.offset.y-18)+")")},p=function(e){var i=u instanceof Glodon.Bimface.Viewer.Viewer3D,n=u.getDomElement().getBoundingClientRect(),o={x:e.x-h.x+t.clientPosition.x+n.left,y:e.y-h.y+t.clientPosition.y+n.top};if(i){var a=u.pickByPoint(o);a&&(t.setWorldPosition(a.worldPosition),t.associateComponentById(a.objectId)),u.render()}else{var r=u.clientToWorld(o);r&&t.setWorldPosition(r),u.update()}t._dragEnd&&t._dragEnd()};e.draggable&&o.drag({element:i,cursor:"pointer",start:f,move:g,end:p}),i.addEventListener("mousedown",function(e){var e=e||event;e.stopPropagation()}),i.addEventListener("click",function(e){t._click&&t._click(t)}),i.addEventListener("contextmenu",function(e){t._rightClick&&t._rightClick(t)}),i.addEventListener("dblclick",function(e){t._doubleClick&&t._doubleClick(t)}),i.addEventListener("mouseenter",function(e){a.innerText=t._text;var n=i.offsetHeight;i.addClass("bf-drawable-show"),a.addClass("bf-drawable-show"),n>i.offsetHeight&&(i.removeClass("bf-drawable-show"),a.removeClass("bf-drawable-show"))}),i.addEventListener("mouseleave",function(e){a.innerText=t._text.replace(/\n/g," "),i.removeClass("bf-drawable-show"),a.removeClass("bf-drawable-show")}),c.appendChild(s),c.appendChild(r),c.appendChild(l),t._objectId=e.objectId,t._container=i,t._domTextArea=a,t._svgGroup=c,t._config=e,t._offset=e.offset};a.Type.inheritPrototype(r,n),r.prototype=Object.assign({},n.prototype,{draw:function(e,t){var i=this._container,n=this._svgGroup,a=this._offset,r=this._config.viewer,s=this._objectId;if(r&&s){var l=r.getComponentStatus(s);if("hidden"==l||"translucent"==l)return}this.clientPosition=e.clientPosition,i.style.left=e.clientPosition.x+a.x+23+"px",i.style.top=e.clientPosition.y+a.y-18+"px",n.setAttribute("transform","translate("+e.clientPosition.x+","+(e.clientPosition.y+a.y-18)+")"),e.domContainer||(e.domContainer=o.create("div","bf-drawable-container"),e.rootDomElement.appendChild(e.domContainer)),e.svgContainer||(e.svgContainer=o.createNS("svg","bf-drawable-svg"),e.rootDomElement.appendChild(e.svgContainer)),this.isShow("default"==t),e.domContainer.appendChild(i),e.svgContainer.appendChild(n)},hide:function(){t.send(e,"hide"),this._container.style.display="none",this._svgGroup.style.display="none"},show:function(){t.send(e,"show"),this._container.style.display="",this._svgGroup.style.display=""},onClick:function(i){t.send(e,"onClick"),
i&&(this._click=i)},onRightClick:function(i){t.send(e,"onRightClick"),i&&(this._rightClick=i)},onDoubleClick:function(e){e&&(this._doubleClick=e)},onEndDrag:function(i){t.send(e,"onEndDrag"),i&&(this._dragEnd=i)},getText:function(){return this._text},setText:function(i){t.send(e,"setText"),this._domTextArea.innerText=i,this._text=i},getOpacity:function(){return this._container.style.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._container.style.opacity=i},getHeight:function(){return parseFloat(this._container.style.height)},setHeight:function(i){t.send(e,"setHeight"),this._container.style.height=parseFloat(i)+"px";var n=Math.trunc((i-8)/18);this._domTextArea.style.webkitLineClamp=n||1},getWidth:function(){return parseFloat(this._container.style.width)},setWidth:function(i){t.send(e,"setWidth"),this._container.style.width=parseFloat(i)+"px"},getObjectId:function(e){return this._objectId},associateComponentById:function(e){this._objectId=e},clearAssociation:function(){this._objectId=null},isShow:function(e){var t=this._container,i=this._svgGroup;e?(t.removeClass("bf-drawable-mini"),i.removeClass("bf-drawable-mini-svg")):(t.addClass("bf-drawable-mini"),i.addClass("bf-drawable-mini-svg"))}}),i.LeadLabel=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={minimap:null,floorList:[],height:20,width:20,objectId:"",src:"",worldPosition:null,viewer:null};return Object.assign({},t,e)};e.MiniTagConfig=i}(),function(){var e="Bimface.Plugins.Drawable.MiniTag",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Bimface.Plugins.Drawable.DrawableItem,o=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility")),a=function e(t){n.call(this,t);var i=this,o=this._viewer=t.viewer.getViewer();if(this.miniTagConfig=t,this._config=t,i.worldPosition=t.worldPosition.clone(),this._renderCallback=function(){i.resize()},t.minimap){this.mapHelper=t.minimap;var a=new CLOUD.View2dAdapter(this.mapHelper,o);this.mapHelper.setMinimapResizeCallback(function(t){e._tagHelper.updateGroupName(),e._tagHelper.updateDomContainer(),e._tagHelper.resize(t),e._tagHelper.updateByGroup()}),this.mapHelper.setPlaneChangedCallback(function(){e._tagHelper.updateGroupName(),e._tagHelper.updateByGroup()})}else{var a=new CLOUD.View3dAdapter(o);o.addCallbacks("render",this._renderCallback)}void 0==e._tagHelper&&(e._tagHelper=new CLOUD.Extensions.MarkerEditor(a),e._tagHelper.disableInteractions(!0)),r()},r=function(){a._tagHelper.isInitialized()||a._tagHelper.init()},s=function(e,t){if(!e)return!1;var i=!1,n=a._tagHelper.getMarkerInfoList();e.userId=e.objectId;for(var o=0,r=n.length;o<r;o++){if(n[o].id==e.id)return i=!0,!1}e.floorList?a._tagHelper.setMarkerGroups(e.floorList):a._tagHelper.setMarkerGroups([]),a._tagHelper.updateGroupName(),i||a._tagHelper.createMarkerByIntersect(e,t.shape,t.image,t.size)},l=function(e){for(var t=a._tagHelper.getMarkerInfoList(),i=0,n=t.length;i<n;i++){var o=t[i];o.id==e&&a._tagHelper.deleteMarker(o)}};a.clear=function(){a._tagHelper&&a._tagHelper.clearMarkers()},o.Type.inheritPrototype(a,n),a.prototype=Object.assign({},n.prototype,{draw:function(){var e=this.miniTagConfig,t={id:this.id,objectId:e.objectId,worldPosition:e.worldPosition,floorList:e.floorList},i={shape:2,image:e.src,size:{width:e.width,height:e.height}};s(t,i)},show:function(){t.send(e,"show"),a._tagHelper.setVisible(this.id,!0)},hide:function(){t.send(e,"hide"),a._tagHelper.setVisible(this.id,!1)},getFloorList:function(){return this.miniTagConfig.floorList},setFloorList:function(i){t.send(e,"setFloorList"),this.miniTagConfig.floorList=i,l(this.id),this.draw()},getHeight:function(){return this.miniTagConfig.height},setHeight:function(i){t.send(e,"setHeight"),this.miniTagConfig.height=i,l(this.id),this.draw()},getId:function(){return this.id},getObjectId:function(){return this.miniTagConfig.objectId},setObjectId:function(i){t.send(e,"setObjectId");var n=this.miniTagConfig;l(this.id),n.objectId=i,this.draw()},getSrc:function(){return this.miniTagConfig.src},setSrc:function(i){t.send(e,"setSrc"),this.miniTagConfig.src=i,l(this.id),this.draw()},getWidth:function(){return this.miniTagConfig.width},setWidth:function(i){t.send(e,"setWidth"),this.miniTagConfig.width=i,l(this.id),this.draw()},getWorldPosition:function(){return this.miniTagConfig.worldPosition},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.miniTagConfig.worldPosition=i,l(this.id),this.draw()},onClick:function(i){t.send(e,"onClick"),a._tagHelper.setMarkerClickCallback(i)},onRightClick:function(i){t.send(e,"onRightClick")},onEndDrag:function(i){t.send(e,"onEndDrag")}}),i.MiniTag=a}(),function(){var e="Bimface.Plugins.Drawable.DrawableContainer",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),function(e){var t=this,i=this,n=e.viewer,o=Glodon.Bimface.Viewer.ViewerDrawing&&n instanceof Glodon.Bimface.Viewer.ViewerDrawing,a=Glodon.Bimface.Viewer.ViewerDrawingSet&&n instanceof Glodon.Bimface.Viewer.ViewerDrawingSet,r=new Glodon.Web.Lang.EventManager,s=new Glodon.Bimface.Plugins.Drawable.DrawableContext;if(n.addEventListener("Rendered",function(e){i.update(e)}),o){n.getRootElement().appendChild(s.rootDomElement)}else if(a){var l=n.getActiveDrawing();l.viewerDrawing.getRootElement().appendChild(s.rootDomElement)}else if(i.isViewer3D=!0,n.getDomElement().appendChild(s.rootDomElement),e.affectedBySection){if(n.addEventListener(Glodon.Bimface.Plugins.Section.SectionBoxEvent.SectionBoxUpdate,function(e){i.section=e,i.update()}),n.addEventListener(Glodon.Bimface.Plugins.Section.SectionPlaneEvent.SectionPlaneUpdate,function(e){i.section=e,i.update()}),n.floorData){var c;!function(){t.floorInfos=n.floorData;var e=t.floorInfos,o=e.floorInfos.length,a=[];for(c=0;c<o;c++)!function(){var t=e.floorInfos[c];n.getFloorBoundingBoxById(t.id,function(e){a.push({box:e,floorName:t.name,explodedOffset:t.explodedHeight-t.elevation}),a.length==o&&(i.boxs=a)})}()}()}n.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(e){var t=e.floorInfos.length,o=[];i.floorInfos=e;var a=function(){for(var e=i._items,t=0,n=e.length;t<n;t++){var a=e[t].worldPosition;if(a)if(e[t].levelName){var r=o.getObjectByAttribute("floorName",e[t].levelName);r&&(e[t].explosionOffset={x:0,y:0,z:r.explodedOffset})}else for(var s=0;s<o.length;s++){var l=o[s];if(l.box.containsPoint(a)){e[t].explosionOffset={x:0,y:0,z:l.explodedOffset},e[t].levelName=l.floorName;break}}}};if(t)for(var r=0;r<t;r++)!function(){var s=e.floorInfos[r];n.getFloorBoundingBoxById(s.id,function(e){o.push({box:e,floorName:s.name,explodedOffset:s.explodedHeight-s.elevation}),o.length==t&&(a(),i.boxs=o)})}()})}i._items=[],i._viewer=n,i._context=s,i._isDrawingView=o,i._isDrawingViewSet=a,i._maxNum=e.maxNum,i.getEventManager=function(){return r}});n.prototype={addItem:function(i){t.send(e,"addItem");var n=this._items,o=this._viewer;if(i.viewer=o,i.update=this.update.bind(this),i._config.objectId){var a=this._viewer.getViewer().getComponentInfoByUserId(i._config.objectId);i.levelName=a.userData.levelName}if(this.floorInfos){var r=i.worldPosition;if(i.levelName){var s=this.boxs.getObjectByAttribute("floorName",i.levelName);if(s){var l={x:r.x,y:r.y,z:r.z-s.explodedOffset};i.explosionOffset={x:0,y:0,z:s.explodedOffset},i.worldPosition=l}}else for(var c=this.boxs,u=0;u<c.length;u++){var d=c[u];if(0!=d.explodedOffset){var h={x:r.x,y:r.y,z:r.z-d.explodedOffset};if(d.box.containsPoint(h)){i.explosionOffset={x:0,y:0,z:d.explodedOffset},i.worldPosition=h;break}}}}n.push(i),this.update()},removeItemById:function(i){t.send(e,"removeItemById");var n=this._items,o=n.removeObjectByAttribute("id",i);o&&this._context.rootDomElement.contains(o[0]._domElement)&&this._context.rootDomElement.removeChild(o[0]._domElement),this.update()},getItemById:function(e){return this._items.getObjectByAttribute("id",e)},getAllItems:function(){return this._items},addItems:function(i){if(t.send(e,"addItems"),i.length)for(var n=0;n<i.length;n++)i[n].update=this.update.bind(this);this._items=i,this.update()},clear:function(){t.send(e,"clear"),this._items=[],this._context.rootDomElement.innerHTML="",this.update()},update:function(){var e=this._items,t=this._viewer,i=this._context,n=this._maxNum,o=e.length&&"customItem"==e[0].name,a=[];o||(i.rootDomElement.innerHTML=""),i.domContainer=null,i.svgContainer=null;var r=document.body.getBoundingClientRect();if(Glodon.Bimface.Plugins.Drawable.MiniTag.clear(),this._isDrawingView&&(t=t.getViewer()),this._isDrawingView)for(var s=0,l=e.length;s<l;s++){var c=e[s].worldPosition;if(c){var u=t.toScreenPoint([c.x,c.y]),d=e[s]._domElement.offsetWidth/2,h=e[s]._domElement.offsetHeight/2;u[0]<-d||u[0]>r.width+d||u[1]<-h||u[1]>r.height+h?e[s]._domElement.style.display="none":(e[s]._domElement.style.display="block",i.clientPosition={x:u[0],y:u[1]},e[s].draw(i))}}else if(this._isDrawingViewSet)for(var f=0,g=e.length;f<g;f++){var p=e[f].worldPosition,v=t.getDrawingById(e[f].viewerDrawingId),u=v.viewerDrawing.worldToClient(p);i.clientPosition=u,e[f].draw(i)}else{for(var m=0,y=e.length;m<y;m++){var w=e[m].worldPosition;if(w){var b=e[m].explosionOffset;b&&(w={x:w.x+b.x,y:w.y+b.y,z:w.z+b.z});var C={clientPosition:t.worldToClient(w),worldPosition:w,item:e[m]};e[m]instanceof Glodon.Bimface.Plugins.Drawable.MiniTag?a.push(C):t.isInViewFrustum(w)&&a.push(C)}}a.sort(function(e,t){return e.clientPosition.z>t.clientPosition.z?1:-1});for(var x=0;x<a.length;x++)if(!this.section||this.section.isIncluded(a[x].worldPosition)){a[x].item._domElement&&(a[x].item._domElement.style.display="block");var P="default";x>=n&&(P="mini"),i.clientPosition=a[x].clientPosition,a[x].item.draw(i,P)}else a[x].item._domElement&&(a[x].item._domElement.style.display="none")}o&&(i.rootDomElement.style.display="block")},exit:function(){t.send(e,"exit"),this.clear(),this._context.destroy()},hideItemsById:function(i){t.send(e,"hideItemsById");var n=this;if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=n.getItemById(i[o]);a&&a.hide()}},hideAllItems:function(){t.send(e,"hideAllItems");var i=this,n=i._items;if(n&&n.length>0)for(var o=0;o<n.length;o++)n[o].hide()},showItemsById:function(i){t.send(e,"showItemsById");var n=this;if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=n.getItemById(i[o]);a&&a.show()}},showAllItems:function(){t.send(e,"showAllItems");var i=this,n=i._items;if(n&&n.length>0)for(var o=0;o<n.length;o++)n[o].show()}},i.DrawableContainer=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{viewer:null,measureType:Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance,color:new Glodon.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon.Web.Graphics.Color(17,218,183,.2),width:3,radius:25,snapDistance:5}};e.MeasureConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Object.freeze({Measuring:"Measuring",Measured:"Measured",Reset:"Reset"});e.MeasureEvent=t}(),function(){var e=Object.freeze({Distance:"Distance",Area:"Area",Angle:"Angle",MinimumDistance:"MinimumDistance",Elevation:"Elevation"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure").MeasureTypeOption=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{id:null,color:new Glodon.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon.Web.Graphics.Color(17,218,183,.2),objectColor:new Glodon.Web.Graphics.Color(17,218,183,.9),width:3,radius:25,viewer:null}};e.MeasureItemConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),new Glodon.Web.Graphics.Color(17,218,183,.2),function(e){this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID(),this.measurePoints=[],this.maxPointsNum=2});t.prototype={draw:function(e){},reset:function(){if(this.measurePoints=[],this._svg){for(var e=this._svg.childNodes,t=e.length,i=t-1;i>-1;i--)this._svg.removeChild(e[i]);this._svg.innerHTML=""}},addPoint:function(e){this.measurePoints.length==this.maxPointsNum&&this.reset(),this.measurePoints.push(e)},redo:function(){this.measurePoints.length>0&&this.measurePoints.length<this.maxPointsNum?this.measurePoints.pop():this.measurePoints=[]},getPoints:function(e){return this.measurePoints}},e.MeasureItem=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=new Glodon.Web.Graphics.Color(17,218,183,.2),o=function(e){t.MeasureItem.call(this,e),this.maxPointsNum=2,this.measurePoints=[];var o=e.color.getRGBA(),a=i.createNS("circle","bf-measure-handle");a.setAttribute("stroke-width",0);var r=a.cloneNode();a.setAttribute("r",2*e.width),a.setAttribute("fill",o),a.style.fill=o;var s=a.cloneNode();r.setAttribute("r",e.width),r.setAttribute("fill",n.getRGB()),r.style.fill=n.getRGB();var l=i.createNS("line","bf-measure-line"),c=l.cloneNode();c.style.strokeWidth=2;var u=c.cloneNode();c.setAttribute("stroke-dasharray","6,4");var d=c.cloneNode(),h=c.cloneNode();l.style.strokeWidth=e.width,l.style.stroke=e.color.getRGBA(),u.style.stroke=n.getRGB(),c.style.stroke="#CC021B",d.style.stroke="#7CCF21",h.style.stroke="#4A90E2",l.setAttribute("stroke-width",e.width);var f=i.createNS("polygon","bf-measure-rect");f.setAttribute("fill",n.getRGBA()),f.setAttribute("stroke",n.getRGB()),f.setAttribute("stroke-width",1),this.line=l,this.lineX=c,this.lineY=d,this.lineZ=h,this.hoverLine=u,this.startPoint=a,this.endPoint=s,this.hoverPoint=r,this.hoverPanel=f,this.hoverPanelSize={width:20,height:20}};e.Type.inheritPrototype(o,t.MeasureItem);var a={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.line,i=this.lineX,n=this.lineY,o=this.lineZ,a=this.hoverLine,r=this.startPoint,s=this.endPoint,l=this.hoverPoint,c=this.hoverPanel,u=this.hoverPanelSize;switch(this._svg=e.svg,e.hoverObjectType){case"Point":l.setAttribute("cx",e.hoverPosition.x),l.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(l);break;case"Line":a.setAttribute("x1",e.lineStartPoint.x),a.setAttribute("y1",e.lineStartPoint.y),a.setAttribute("x2",e.lineEndPoint.x),a.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(a);break;case"Panel":var d=e.clientPts,h=d[0].distanceTo(d[1]),f=d[0].distanceTo(d[3]),g=h/u.width,p=f/u.height;if(1!=g){var v=this.stretchOnDirection(d[0],d[1],u.width),m=this.stretchOnDirection(d[2],d[3],u.width);d=v.concat(m)}if(1!=p){var v=this.stretchOnDirection(d[0],d[3],u.height),m=this.stretchOnDirection(d[1],d[2],u.height);d=[v[0],m[0],m[1],v[1]]}for(var y="",w=0;w<d.length;w++)y+=d[w].x+",",y+=d[w].y+" ";c.setAttribute("points",y),e.svg.appendChild(c)}switch(e.clientPoints.length){case 2:var b=e.auxLines[0],C=e.auxLines[1],x=e.auxLines[2];b&&(i.setAttribute("x1",b.start.x),i.setAttribute("y1",b.start.y),i.setAttribute("x2",b.end.x),i.setAttribute("y2",b.end.y),e.svg.appendChild(i)),C&&(n.setAttribute("x1",C.start.x),n.setAttribute("y1",C.start.y),n.setAttribute("x2",C.end.x),n.setAttribute("y2",C.end.y),e.svg.appendChild(n)),x&&(o.setAttribute("x1",x.start.x),o.setAttribute("y1",x.start.y),o.setAttribute("x2",x.end.x),o.setAttribute("y2",x.end.y),e.svg.appendChild(o)),r.setAttribute("cx",e.clientPoints[1].x),r.setAttribute("cy",e.clientPoints[1].y),s.setAttribute("cx",e.clientPoints[0].x),s.setAttribute("cy",e.clientPoints[0].y),t.setAttribute("x1",e.clientPoints[0].x),t.setAttribute("y1",e.clientPoints[0].y),t.setAttribute("x2",e.clientPoints[1].x),t.setAttribute("y2",e.clientPoints[1].y),e.svg.appendChild(r),e.svg.appendChild(s),e.svg.appendChild(t);break;case 1:r.setAttribute("cx",e.clientPoints[0].x),r.setAttribute("cy",e.clientPoints[0].y);this.getPoints().length!=this.maxPointsNum&&e.hoverPosition&&(t.setAttribute("x1",e.clientPoints[0].x),t.setAttribute("y1",e.clientPoints[0].y),t.setAttribute("x2",e.hoverPosition.x),t.setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(t)),e.svg.appendChild(r)}}};o.prototype=Object.assign(o.prototype,a),t.MeasureDistanceItem=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=new Glodon.Web.Graphics.Color(17,218,183,.2),o=function(e){t.MeasureItem.call(this,e),this.maxPointsNum=3,this.radius=e.radius,this.measurePoints=[];var o=e.color.getRGBA(),a=i.createNS("circle","bf-measure-handle");a.setAttribute("stroke-width",0);var r=a.cloneNode();a.setAttribute("r",2*e.width),a.setAttribute("fill",o),a.style.fill=o;var s=a.cloneNode(),l=a.cloneNode();r.setAttribute("r",e.width),r.setAttribute("fill",n.getRGB()),r.style.fill=n.getRGB();var c=i.createNS("path","bf-measure-angle");c.setAttribute("fill","rgba(0,0,0,0)"),c.setAttribute("stroke",o),c.setAttribute("stroke-width",e.width);var u=i.createNS("line","bf-measure-line"),d=u.cloneNode();u.style.strokeWidth=e.width,u.style.stroke=o,u.setAttribute("stroke-width",e.width);var h=u.cloneNode();d.setAttribute("fill","rgba(0,0,0,0)"),d.setAttribute("stroke",n.getRGB()),d.setAttribute("stroke-width",2);var f=i.createNS("polygon","bf-measure-rect");f.setAttribute("fill",n.getRGBA()),f.setAttribute("stroke",n.getRGB()),f.setAttribute("stroke-width",1);var g=i.create("span","bf-measure-number");g.style.backgroundColor=e.color.getRGBA(),this.points=[a,s,l],this.lines=[u,h],this.hoverLine=d,this.angleLine=c,this.hoverPoint=r,this.hoverPanel=f,this.hoverPanelSize={width:20,height:20},this.text=g};e.Type.inheritPrototype(o,t.MeasureItem);var a={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.points,i=this.lines,n=this.hoverLine,o=this.angleLine,a=this.hoverPoint,r=this.hoverPanel;this._svg=e.svg;for(var s=this.hoverPanelSize,l=0,c=e.clientPoints.length;l<c;l++)e.clientPoints[l]&&(t[l].setAttribute("cx",e.clientPoints[l].x),t[l].setAttribute("cy",e.clientPoints[l].y),e.svg.appendChild(t[l]));switch(e.clientPoints.length){case 3:i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.clientPoints[1].x),i[0].setAttribute("y2",e.clientPoints[1].y),i[1].setAttribute("x1",e.clientPoints[1].x),i[1].setAttribute("y1",e.clientPoints[1].y),i[1].setAttribute("x2",e.clientPoints[2].x),i[1].setAttribute("y2",e.clientPoints[2].y);var u=this.radius,d=function(e,t,i,n){var e=new THREE.Vector2(e.x,e.y),t=new THREE.Vector2(t.x,t.y),i=new THREE.Vector2(i.x,i.y),o=1,a=e.sub(t),r=i.sub(t);if(a.length()<n||r.length()<n)return!1;a.setLength(n),r.setLength(n);var s=a.angle(),l=r.angle(),c=180*(l-s)/Math.PI;return c<0&&(c+=360),o=c<180?1:0,{pointA:t.clone().add(a),pointB:t.clone().add(r),flag:1,direction:o}}(e.clientPoints[0],e.clientPoints[1],e.clientPoints[2],u);d&&(o.setAttribute("d","M "+d.pointA.x+" "+d.pointA.y+" A "+u+" "+u+" 0 0 "+d.direction+" "+d.pointB.x+" "+d.pointB.y),e.svg.appendChild(o)),e.svg.appendChild(i[1]),e.svg.appendChild(i[0]);break;case 2:i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.clientPoints[1].x),i[0].setAttribute("y2",e.clientPoints[1].y),e.svg.appendChild(i[0]);var h=this.getPoints().length!=this.maxPointsNum;h&&e.hoverPosition&&(i[1].setAttribute("x1",e.clientPoints[1].x),i[1].setAttribute("y1",e.clientPoints[1].y),i[1].setAttribute("x2",e.hoverPosition.x),i[1].setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(i[1]));break;case 1:var h=this.getPoints().length!=this.maxPointsNum;h&&e.hoverPosition&&(i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.hoverPosition.x),i[0].setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(i[0]))}switch(e.hoverObjectType){case"Point":a.setAttribute("cx",e.hoverPosition.x),a.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(a);break;case"Line":n.setAttribute("x1",e.lineStartPoint.x),n.setAttribute("y1",e.lineStartPoint.y),n.setAttribute("x2",e.lineEndPoint.x),n.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(n);break;case"Panel":var f=e.clientPts,g=f[0].distanceTo(f[1]),p=f[0].distanceTo(f[3]),v=g/s.width,m=p/s.height;if(1!=v){var y=this.stretchOnDirection(f[0],f[1],s.width),w=this.stretchOnDirection(f[2],f[3],s.width);f=y.concat(w)}if(1!=m){var y=this.stretchOnDirection(f[0],f[3],s.height),w=this.stretchOnDirection(f[1],f[2],s.height);f=[y[0],w[0],w[1],y[1]]}for(var t="",l=0;l<f.length;l++)t+=f[l].x+",",t+=f[l].y+" ";r.setAttribute("points",t),e.svg.appendChild(r)}}};o.prototype=Object.assign(o.prototype,a),t.MeasureAngleItem=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=(new Glodon.Web.Graphics.Color(17,218,183,.2),function(e){t.MeasureItem.call(this,e),this.maxPointsNum=2,this.measurePoints=[],this.opt=e,this.minDistanceLine=null,this.svgContainer=i.createNS("svg","bf-minDistanceMeasure-svg"),this.startPoint=i.createNS("circle","bf-minDistanceMeasure-handle"),this.endPoint=i.createNS("circle","bf-minDistanceMeasure-handle"),this.line=i.createNS("line","bf-minDistanceMeasure-line")});e.Type.inheritPrototype(n,t.MeasureItem);var o={draw:function(e){if(null!=this.minDistanceLine){if(0==this.minDistanceLine.distance)return void this.clearMinDistanceLine();var t=this.opt.cloudViewer,i=this.minDistanceLine,n=t.worldToCanvas(i.start.clone()),o=t.worldToCanvas(i.end.clone());this.drawMinDistanceLine(n,o)}},drawMinDistanceLine:function(e,t){var i=document.getElementsByClassName("bf-measure-conext")[0];null==this.svgContainer.parentNode&&(this.svgContainer.setAttribute("width",i.offsetWidth),this.svgContainer.setAttribute("height",i.offsetHeight),i.appendChild(this.svgContainer));var n=this.opt.color.getRGBA(),o=this.startPoint;o.setAttribute("r",2*this.opt.width),o.setAttribute("fill",n),o.setAttribute("cx",e.x),o.setAttribute("cy",e.y),null==o.parentNode&&this.svgContainer.appendChild(o);var a=this.endPoint;a.setAttribute("r",2*this.opt.width),a.setAttribute("fill",n),a.setAttribute("cx",t.x),a.setAttribute("cy",t.y),null==a.parentNode&&this.svgContainer.appendChild(a);var r=this.line;r.setAttribute("stroke",n),r.setAttribute("stroke-width",this.opt.width),r.setAttribute("x1",e.x),r.setAttribute("y1",e.y),r.setAttribute("x2",t.x),r.setAttribute("y2",t.y),null==r.parentNode&&this.svgContainer.appendChild(r)},setMinDistanceLine:function(e){this.minDistanceLine=e},clearMinDistanceLine:function(){var e=this.startPoint;e.parentNode&&this.svgContainer.removeChild(e);var t=this.endPoint;t.parentNode&&this.svgContainer.removeChild(t);var i=this.line;i.parentNode&&this.svgContainer.removeChild(i)},addPoint:function(e){var t=this.opt.viewer;this.opt.objectColor;this.measurePoints.length==this.maxPointsNum&&this.reset(),-1==this.measurePoints.indexOf(e)&&(this.measurePoints.push(e),t.addSelectedComponentsById([e]),t.render())},reset:function(){var e=this.opt.viewer;e.removeSelectedId(this.measurePoints),this.measurePoints=[],this.clearMinDistanceLine(),this.minDistanceLine=null,e.render()},redo:function(){var e=this.opt.viewer;if(this.measurePoints.length>0&&this.measurePoints.length<this.maxPointsNum){var t=this.measurePoints.pop();e.removeSelectedId([t]),e.render()}else this.reset()}};n.prototype=Object.assign(n.prototype,o),t.MeasureMinimumDistanceItem=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=function(e){t.MeasureItem.call(this,e),this.viewer=e.viewer,this.maxPointsNum=1;var n=e.color.getRGBA(),o=new Glodon.Web.Graphics.Color(17,218,183,.2),a=i.createNS("circle","bf-measure-handle");a.setAttribute("r",e.width),a.setAttribute("fill",o.getRGB()),a.style.fill=o.getRGB();var r=i.createNS("line","bf-measure-line");r.style.strokeWidth=2,r.style.stroke=o.getRGB();var s=i.createNS("polygon","bf-measure-rect");s.setAttribute("fill",o.getRGBA()),s.setAttribute("stroke",o.getRGB()),s.setAttribute("stroke-width",1);var l=i.createNS("polyline","bf-measure-elevation-marker");l.setAttribute("stroke",n),l.setAttribute("stroke-width",2),l.style.fill="none",this.hoverLine=r,this.hoverPoint=a,this.hoverPanel=s,this.elevationMarker=l,this.hoverPanelSize={width:20,height:20}};e.Type.inheritPrototype(n,t.MeasureItem);var o={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.hoverLine,i=this.hoverPoint,n=this.hoverPanel,o=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":i.setAttribute("cx",e.hoverPosition.x),i.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(i);break;case"Line":t.setAttribute("x1",e.lineStartPoint.x),t.setAttribute("y1",e.lineStartPoint.y),t.setAttribute("x2",e.lineEndPoint.x),t.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(t);break;case"Panel":var a=e.clientPts,r=a[0].distanceTo(a[1]),s=a[0].distanceTo(a[3]),l=r/o.width,c=s/o.height;if(1!=l){var u=this.stretchOnDirection(a[0],a[1],o.width),d=this.stretchOnDirection(a[2],a[3],o.width);a=u.concat(d)}if(1!=c){var u=this.stretchOnDirection(a[0],a[3],o.height),d=this.stretchOnDirection(a[1],a[2],o.height);a=[u[0],d[0],d[1],u[1]]}for(var h="",f=0;f<a.length;f++)h+=a[f].x+",",h+=a[f].y+" ";n.setAttribute("points",h),e.svg.appendChild(n)}if(this.measurePoints.length>0){var g=this.measurePoints[0].clone();g=this.viewer.worldToClient(g);var p=this.makeElevationMarker(g);this.elevationMarker.setAttribute("points",p),e.svg.appendChild(this.elevationMarker)}},makeElevationMarker:function(e){for(var t=[18,-10,-8,-10,0,0,8,-10],i="",n=0;n<t.length;n+=2)t[n]+=e.x,t[n+1]+=e.y,i+=t[n]+","+t[n+1]+" ";return i}};n.prototype=Object.assign(n.prototype,o),t.MeasureElevationItem=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=null,n=[],o=null,a=null,r=function(e){var i=e.viewer,n=this,o=new Glodon.Web.Lang.EventManager,a=t.create("div","bf-measure-conext");n.isOpen=!1,i.addEventListener("Rendered",function(){n.isOpen&&n.update()}),this.context={rootDomElement:a},this._opt=e,this.type=e.measureType,this.getEventManager=function(){return o},i.getViewer().registerEventListener(CLOUD.EVENTS.ON_MEASURE_PICK,function(e){n.isOpen&&n.measureByPoint(e)})};r.prototype={init:function(){var e=this,i=e.context,n=e._opt.viewer,o=n.getViewer();n.getDomElement().appendChild(i.rootDomElement),n.setSelectedComponentsById(),n.getDomElement().style.cursor="url("+Cursor.measure+"),auto";var a=t.createNS("svg","bf-measure-svg"),r=t.create("div","bf-measure-text");i.rootDomElement.innerHTML="",i.rootDomElement.appendChild(a),i.svg=a,i.text=r,o.editorManager.enableTool(o,CLOUD.EditToolMode.PICK_BY_MEASURE);var s,l=new Glodon.Bimface.Plugins.Measure.MeasureItemConfig;switch(l=Object.assign(l,e._opt),e.type){case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance:s=new Glodon.Bimface.Plugins.Measure.MeasureDistanceItem(l);break;case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Angle:s=new Glodon.Bimface.Plugins.Measure.MeasureAngleItem(l);break;case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance:l.cloudViewer=o,s=new Glodon.Bimface.Plugins.Measure.MeasureMinimumDistanceItem(l);break;case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Elevation:s=new Glodon.Bimface.Plugins.Measure.MeasureElevationItem(l)}e.measureItem=s,n.render()},switchOn:function(){this.isOpen||(this.type=Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance,this.setMeasureType(Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance),this.isOpen=!0)},switchOff:function(){if(this.isOpen){var e=this.context.rootDomElement,t=this,i=t._opt.viewer,n=i.getViewer();i.getDomElement().style.cursor="",n.editorManager.disableTool(CLOUD.EditToolMode.PICK_BY_MEASURE),t.reset(),e.remove(),t.measureItem=null,this.isOpen=!1}},measureByPoint:function(e){var t=this,r=t.measureItem;t.context.rootDomElement.getBoundingClientRect();if(e)if(i=e.pickPoint?e.pickPoint:null,e.pickPlane?(o="Panel",a=e.normal):e.pickLine?(o="Line",n=e.pickLine):o=e.pickPoint?"Point":null,e.pick&&e.pickPoint){var s=this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Elevation,l=this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance;s?(r.redo(),r.addPoint(e.pickPoint),r.draw(this.context)):l&&e.userId?r.addPoint(e.userId):(r.addPoint(e.pickPoint),t.update());var c=r.getPoints();c.length==r.maxPointsNum?t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measured,t.getInfo()):t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measuring,t.getInfo())}else t.update()},measureMinimum:function(){},reset:function(){this.isOpen&&(this.measureItem.reset(),this.context.svg.innerHTML="",this.context.points=[],this.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Reset))},update:function(){var e=this.measureItem,t=this.context,r=this._opt.viewer,s=r.getDomElement(),l=s.getBoundingClientRect(),c=r.getViewer(),u=e.getPoints(),d=[],h=[];if(this.context.svg.innerHTML="",i?(t.hoverPosition=r.worldToClient(i),t.hoverPositionDS=c.getScene().worldToDrawing(i),0!=u.length&&(d=u.concat([i]))):(t.hoverPosition=null,0!=u.length&&(d=u.concat(u[u.length-1]))),t.hoverObjectType=o,"Line"==o&&2==n.length){t.lineStartPoint=r.worldToClient(n[0]),t.lineEndPoint=r.worldToClient(n[1]);var f=new THREE.Vector2(t.lineStartPoint.x,t.lineStartPoint.y),g=new THREE.Vector2(t.lineEndPoint.x,t.lineEndPoint.y),p=new THREE.Box2;p.min.set(s.clientLeft,s.clientTop),p.max.set(p.min.x+s.clientWidth,p.min.y+s.clientHeight);var v=!p.containsPoint(f),m=!p.containsPoint(g),y={start:f,end:g},w=CLOUD.CameraUtil.lineIntersectWithRect(y,p);if(v&&m)2==w.length&&(t.lineStartPoint=w[0],t.lineEndPoint=w[1]);else if(v||m)for(var b=new THREE.Vector2(t.hoverPosition.x,t.hoverPosition.y),C=v?g.clone():f.clone(),x=C.clone().sub(b).normalize(),P=0;P<w.length;P++){var k=C.clone().sub(w[P]).normalize();if(k.dot(x)>0){t.lineStartPoint=C,t.lineEndPoint=w[P];break}}}if("Panel"==t.hoverObjectType){t.normal=c.getScene().worldToDrawing(a),t.normal.normalize();var M=c.cameraControl,I=new THREE.Plane;I.setFromNormalAndCoplanarPoint(t.normal,t.hoverPositionDS)
;var E=new THREE.Vector2(t.hoverPosition.x-10,t.hoverPosition.y-10),A=new THREE.Vector2(t.hoverPosition.x+10,t.hoverPosition.y-10),S=t.hoverPositionDS,B=M.getRaycaster(E.x,E.y),f=B.ray.intersectPlane(I);B=M.getRaycaster(A.x,A.y);var g=B.ray.intersectPlane(I);if(null==f||null==g)return;var _=new THREE.Vector3(1,0,0),D=new THREE.Vector3(0,1,0),L=new THREE.Vector3(0,0,1),G=Math.abs(t.normal.clone().dot(_))<=.0025,T=Math.abs(t.normal.clone().dot(L))<=.0025;if(G&&T)var N=_.clone(),O=L.clone();else var W=D.clone(),N=W.cross(t.normal).normalize(),O=t.normal.clone().cross(N).normalize();var U=f.distanceTo(g)/2,V=N.clone().multiplyScalar(U),H=O.clone().multiplyScalar(U),R=S.clone().sub(V).add(H),z=S.clone().add(V).add(H),F=S.clone().sub(V).sub(H),j=S.clone().add(V).sub(H),X=[];X.push(R,z,j,F);for(var Y=[],Z=M.getContainerDimensions(),q=0;q<X.length;q++){var J=CLOUD.CameraUtil.drawingToCanvas(M.camera,X[q],Z.width,Z.height);Y.push(new THREE.Vector3(J.x,J.y,0))}t.clientPts=Y}for(var P=0;P<d.length-1;P++){var K=c.worldPointsToClient(d[P],d[P+1]);if(K){var Q={x:K.start.x-l.left,y:K.start.y-l.top};h.push(Q)}}if(this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance&&u.length==e.maxPointsNum){for(var $={x:u[1].x,y:u[0].y,z:u[0].z},ee={x:u[1].x,y:u[1].y,z:u[0].z},te=[],ie=[u[0],$,ee,u[1]],q=0;q<ie.length-1;q++){var K=c.worldPointsToClient(ie[q],ie[q+1]);K&&(K.start.x-=l.left,K.start.y-=l.top,K.end.x-=l.left,K.end.y-=l.top),te.push(K)}t.auxLines=te}t.clientPoints=h,e.draw(t)},getInfo:function(){var e={},t=this.measureItem,i=this._opt.viewer,n=t.getPoints();if(this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance){if(2==n.length){var o=i.getMinimumComponentDistanceById(n[0],n[1]);e.distance=Math.round(o.minDistance),e.start=o.start,e.end=o.end}e.points=n}else if(e.points=n,e.type=this.type,this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance)n&&2==n.length&&(e.distanceX=Math.round(Math.abs(n[1].x-n[0].x)),e.distanceY=Math.round(Math.abs(n[1].y-n[0].y)),e.distanceZ=Math.round(Math.abs(n[1].z-n[0].z)),e.distance=Math.round(Math.sqrt(Math.pow(e.distanceX,2)+Math.pow(e.distanceY,2)+Math.pow(e.distanceZ,2))));else if(3==n.length){var a=new THREE.Vector3(n[0].x-n[1].x,n[0].y-n[1].y,n[0].z-n[1].z),r=new THREE.Vector3(n[2].x-n[1].x,n[2].y-n[1].y,n[2].z-n[1].z),s=a.angleTo(r);e.angle=(180*s/Math.PI).toFixed(2)}return e},redo:function(){this.measureItem.redo(),this.update(),this.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measuring,this.getInfo())},exit:function(){this.switchOff()}},e.MeasureViewer3D=r}(),function(){var e="Bimface.Plugins.Measure.MeasureDrawing",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),function(e){this.isOpen=!1;var t=e.viewer,i=t.getViewer();this.viewer=t,this.viewerDrawing=i,this.domElement=t.getDomElement();new Glodon.Web.Lang.EventManager;t.setSnapDistance(e.snapDistance)});n.prototype={init:function(i){t.send(e,"init");var n=this;i&&(n._callback=i),this.viewerDrawing.mouseEditorMgr.activeEditorByName("Distance"==this.type?"measure":"area-measure")},switchOn:function(i){if(t.send(e,"switchOn"),!this.isOpen){this.isOpen=!0;this.domElement.firstElementChild.style.cursor="url("+Cursor.measure+"),auto",this.type=Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance,this.init(i)}},switchOff:function(){if(t.send(e,"switchOff"),this.isOpen){this.isOpen=!1;this.domElement.firstElementChild.style.cursor="",this.measureItem=null,this.viewerDrawing.mouseEditorMgr.activeEditorByName("pick")}},reset:function(){t.send(e,"reset");var i=this.viewerDrawing.mouseEditorMgr.getEditor();i.reset&&i.reset(),this.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Reset),this.viewerDrawing.update()},update:function(){t.send(e,"update")},exit:function(){t.send(e,"exit"),this.switchOff()}},i.MeasureDrawing=n}(),function(){var e=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=function(e){var n=e.viewer;if(n){var o=new Glodon.Web.Lang.EventManager,a=i.create("div","bf-measure-conext");this.context={rootDomElement:a},this._opt=e,this.type=e.measureType,this.getEventManager=function(){return o},Glodon.Bimface.Viewer.Viewer3D&&n instanceof Glodon.Bimface.Viewer.Viewer3D?(t.MeasureViewer3D.call(this,e),this.inherit(Glodon.Bimface.Plugins.Measure.MeasureViewer3D.prototype)):(t.MeasureDrawing.call(this,e),this.inherit(Glodon.Bimface.Plugins.Measure.MeasureDrawing.prototype))}};n.prototype={inherit:function(e){for(var t in e)this[t]=e[t]},addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},getMeasureType:function(){return this.type},setMeasureType:function(t){e.send("Bimface.Plugins.Measure.Measure","setMeasureType"),this.type=t,this.reset(),this.init(),this.getEventManager().fireEvent("typeChange",t)}},t.Measure=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{viewer:null,targetsHintColor:new Glodon.Web.Graphics.Color(245,127,35,.6)}};e.MeasureRayConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{id:null,color:new Glodon.Web.Graphics.Color(245,127,35,1),width:2,startPoint:new Glodon.Web.Geometry.Point3d(0,0,0),endPoint:new Glodon.Web.Geometry.Point3d(0,0,0),startObjectId:null,endObjectId:null}};e.MeasureRayItemConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(e){this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID();this.startPoint=e.startPoint,this.endPoint=e.endPoint;this.startComponentId=e.startComponentId,this.endComponentId=e.endComponentId;var i=t.createNS("defs","bf-defs");i.innerHTML='\n      <marker id="end" markerWidth="6" markerHeight="6" refx="5" refy="3" orient="auto" markerUnits="strokeWidth">\n        <path d="M0,0 L0,6 L6,3 z" fill="'+e.color.getRGBA()+'" />\n      </marker>';var n=t.create("i","bf-measure-handle");n.style.width=12*e.width+"px",n.style.height=12*e.width+"px",n.style.backgroundColor=e.color.getRGBA(),n.style.lineHeight=12*e.width+"px";var o=t.createNS("line","bf-measure-line");o.style.stroke=e.color.getRGBA(),o.setAttribute("stroke-width",e.width);var a=t.create("span","bf-measure-number");a.style.backgroundColor=e.color.getRGBA(),this.domElement=i,this.line=o,this.circle=n,this.text=a};i.prototype={draw:function(e){var t=this.domElement,i=this.line,n=this.circle,o=this.text,a=Math.abs(e.endPoint.x-e.startPoint.x),r=Math.abs(e.endPoint.y-e.startPoint.y),s=Math.abs(e.endPoint.z-e.startPoint.z),l=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)+Math.pow(s,2));i.setAttribute("x1",e.startPoint.x),i.setAttribute("y1",e.startPoint.y),i.setAttribute("x2",e.endPoint.x),i.setAttribute("y2",e.endPoint.y),n.style.left=e.startPoint.x+"px",n.style.top=e.startPoint.y+"px",e.isMove&&(n.style.border="2px solid #fff"),l<15?i.removeAttribute("marker-end"):i.setAttribute("marker-end","url(#end)"),o.innerText=e.distance,e.svg.appendChild(t),e.svg.appendChild(i),e.text.appendChild(n),0==e.distance?n.innerText="0":(o.style.left=(e.startPoint.x+e.endPoint.x)/2+"px",o.style.top=(e.startPoint.y+e.endPoint.y)/2+"px",o.style.transform="translate(-50%, 0)",o.style.marginTop="2px",e.text.appendChild(o))}},e.MeasureRayItem=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Object.freeze({Measured:"Measured",Clear:"Clear"});e.MeasureRayEvent=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(e){var i=e.viewer;if(i){if(!(i instanceof Glodon.Bimface.Viewer.Viewer3D))return void console.log("Viewer2D is not supported.");var n=this,o=new Glodon.Web.Lang.EventManager,a=t.create("div","bf-measure-conext");i.addEventListener("Rendered",function(){n.measureItem&&n.update()}),this.context={rootDomElement:a},this._opt=e,this._enableMove=!1,this._events={mousedown:function(){this._startTime=(new Date).getTime()},mouseup:function(e){if(0==e.button||1==e.button)if(n._enableMove)n._enableMove=!1,n.measureByPoint(e);else{var t=this._startTime,i=(new Date).getTime();i-t<300&&n.measureByPoint(e)}},mousemove:function(e){n._enableMove&&(e.stopPropagation(),n.measureByPoint(e))}},this.getEventManager=function(){return o}}};i.prototype={addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},switchOn:function(e){var i=this.context,n=this;n._opt.viewer.getDomElement().appendChild(i.rootDomElement),e&&(n._callback=e),n._opt.viewer.setSelectedComponentsById();var o=t.createNS("svg","bf-measure-svg"),a=t.create("div","bf-measure-text");i.rootDomElement.appendChild(o),i.rootDomElement.appendChild(a),i.svg=o,i.text=a,i.rootDomElement.addEventListener("mousedown",n._events.mousedown),i.rootDomElement.addEventListener("mouseup",n._events.mouseup),i.rootDomElement.addEventListener("mousemove",n._events.mousemove)},switchOff:function(){var e=this.context.rootDomElement,t=this,i=t._opt.viewer;t.measureItem&&(i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]),i.render()),e.removeEventListener("mousedown",t._events.mousedown),e.removeEventListener("mouseup",t._events.mouseup),e.removeEventListener("mousemove",t._events.mousemove),e.innerHTML="",e.remove(),t.measureItem=null},reset:function(){this.clear()},clear:function(){var e=this.context,t=this,i=t._opt.viewer;t.measureItem&&(i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]),i.render()),e.svg.innerHTML="",e.text.innerHTML="",t.measureItem=null,t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureRayEvent.Clear,data)},measureByPoint:function(e){var t=this,i=t._opt.viewer,n=i.getViewer(),o=n.pickByPointWithNormal(e);if(o){t.measureItem&&i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]);var a=(Glodon.Bimface.Viewer.Viewer3DEvent,t._getContextData(o)),r=new Glodon.Bimface.Plugins.Measure.MeasureRayItemConfig;r.startComponentId=a.startComponentId,r.endComponentId=a.endComponentId,r.startPoint=a.startPoint,r.endPoint=a.endPoint;var s=new Glodon.Bimface.Plugins.Measure.MeasureRayItem(r);s.circle.addEventListener("mousedown",function(e){2!=e.button&&(t._enableMove=!0)}),t.context.distance=a.distance,i.overrideComponentsColorById([a.startComponentId,a.endComponentId],t._opt.targetsHintColor),setTimeout(function(){t.update(),i.render()},100),t.measureItem=s,t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureRayEvent.Measured,a)}},update:function(){var e=this.measureItem,t=this.context,i=this._opt.viewer;t.svg.innerHTML="",t.text.innerHTML="",t.isMove=this._enableMove;var n=i.worldToClient(e.startPoint),o=i.worldToClient(e.endPoint);n&&o&&(t.startPoint=new Glodon.Web.Geometry.Point3d(n.x,n.y,n.z),t.endPoint=new Glodon.Web.Geometry.Point3d(o.x,o.y,o.z),e.draw(t))},exit:function(){this.switchOff()},_getContextData:function(e){var t,i,n={};return t=i=e[0],e.length>1&&(i=e[1]),n.startComponentId=t.userId,n.startPoint=t.worldPosition,n.endComponentId=i.userId,n.endPoint=i.worldPosition,n.distanceX=Math.round(Math.abs(n.endPoint.x-n.startPoint.x)),n.distanceY=Math.round(Math.abs(n.endPoint.y-n.startPoint.y)),n.distanceZ=Math.round(Math.abs(n.endPoint.z-n.startPoint.z)),n.distance=Math.round(Math.sqrt(Math.pow(n.distanceX,2)+Math.pow(n.distanceY,2)+Math.pow(n.distanceZ,2))),n}},e.MeasureRay=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),t=function(){return{viewer:null}};e.Marker3DContainerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),t=function(){return{id:null,size:30,tooltip:"",tooltipStyle:{color:"#333",fontSize:"14px",borderWidth:"1px",borderColor:"#666",borderStyle:"solid",backgroundColor:"#fff"},src:null,worldPosition:new Glodon.Web.Geometry.Point3d(0,0,0)}};e.Marker3DConfig=t}(),function(){var e="Bimface.Plugins.Marker3D.Marker3D",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),o=function(e){var t=this;this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID(),this.size=e.size,this.iconUrl=e.src,this.position=e.worldPosition,this.tooltip=e.tooltip,this.tooltipElement=n.create("div","bf-tooltip"),this.tooltipElement.innerHTML=e.tooltip,this.tooltipElement.setCss(e.tooltipStyle),this._tooltipCallback=function(e,i,n){var o=t.tooltipElement;n.appendChild(o);var a=o.offsetWidth,r=o.offsetHeight;o.style.left=i.x-a/2+"px",o.style.top=i.y-r-t.size+"px",t._hoverCallback&&t._hoverCallback(e)},this._config=e};o.prototype={getId:function(){return this.id},getWorldPosition:function(){return this.position},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.position=i,this.update()},getSize:function(){return this.size},setSize:function(i){t.send(e,"setSize"),this.size=i,this.update()},getSrc:function(){return this.iconUrl},setSrc:function(i){t.send(e,"setSrc"),this.iconUrl=i,this.update()},getTooltip:function(){return this.tooltip},setTooltip:function(i){t.send(e,"setTooltip"),this.tooltip=i,this.tooltipElement.innerHTML=i},onClick:function(i){t.send(e,"onClick"),i&&(this._clickCallback=i)},onHover:function(i){t.send(e,"onHover"),i&&(this._hoverCallback=i)},update:function(){t.send(e,"update"),this.container&&this.container.update()}},i.Marker3D=o}(),function(){var e="Bimface.Plugins.Marker3D.Marker3DContainer",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop()),o=function(e){var t=this;if(!e.viewer)return void console.log("viewer must not be empty.");var i=e.viewer instanceof Glodon.Bimface.Viewer.Viewer3D,o=e.viewer.getDomElement(),a=e.viewer.getViewer();if(!i)return void console.log("Viewer2D is not supported.");var r=new CLOUD.Marker3D(a,!0),s=this;if(this._helper=r,this._viewer=e.viewer,this._items=[],this._pick=function(e){var t=e.intersectInfo;if(t&&t.objectType===CLOUD.PICKABLETYPE.Marker3d){var i=s.getItemById(t.selectedObjectId);i._clickCallback&&i._clickCallback(i)}},this._hover=function(e){s.tooltipElement&&o.contains(s.tooltipElement)&&(o.removeChild(s.tooltipElement),s.tooltipElement=null);var t=e.intersectInfo;if(t&&t.objectType===CLOUD.PICKABLETYPE.Marker3d){var i=s.getItemById(t.selectedObjectId);s.tooltipElement=i.tooltipElement,i._tooltipCallback&&""!=s.tooltipElement.innerHTML&&i._tooltipCallback(i,e.canvasPos,o)}},a.registerEventListener(CLOUD.EVENTS.ON_CLICK_PICK,s._pick),n&&a.registerEventListener(CLOUD.EVENTS.ON_HOVER_PICK,s._hover),e.viewer.floorData){var l;!function(){t.floorInfos=e.viewer.floorData;var i=t.floorInfos,n=i.floorInfos.length,o=[];for(l=0;l<n;l++)!function(){var t=i.floorInfos[l];e.viewer.getFloorBoundingBoxById(t.id,function(e){o.push({box:e,floorName:t.name,explodedOffset:t.explodedHeight-t.elevation}),o.length==n&&(s.boxs=o)})}()}()}e.viewer.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(t){var i=t.floorInfos.length,n=[];s.floorInfos=t;var o=function(){for(var e=s._items,t=0,i=e.length;t<i;t++){var o=e[t].position;if(o)if(e[t].levelName){var a=n.getObjectByAttribute("floorName",e[t].levelName);a&&(e[t].explosionOffset={x:0,y:0,z:a.explodedOffset})}else for(var r=0;r<n.length;r++){var l=n[r];if(l.box.containsPoint(o)){e[t].explosionOffset={x:0,y:0,z:l.explodedOffset},e[t].levelName=l.floorName;break}}}};if(i)for(var a=0;a<i;a++)!function(){var r=t.floorInfos[a];e.viewer.getFloorBoundingBoxById(r.id,function(e){n.push({box:e,floorName:r.name,explodedOffset:r.explodedHeight-r.elevation}),n.length==i&&(o(),s.boxs=n)})}();s.update()})};o.prototype={addItem:function(i){if(t.send(e,"addItem"),i.container=this,i._config.objectId){var n=this._viewer.getViewer().getComponentInfoByUserId(i._config.objectId);i.levelName=n.userData.levelName}if(this.floorInfos){var o=i.position;if(i.levelName){var a=this.boxs.getObjectByAttribute("floorName",i.levelName);if(a){var r={x:o.x,y:o.y,z:o.z-a.explodedOffset};i.explosionOffset={x:0,y:0,z:a.explodedOffset},i.worldPosition=r,i.origin=r.z}}else for(var s=this.boxs,l=0;l<s.length;l++){var c=s[l];if(0!=c.explodedOffset){var u={x:o.x,y:o.y,z:o.z-c.explodedOffset};if(c.box.containsPoint(u)){i.explosionOffset={x:0,y:0,z:c.explodedOffset},i.position=u;break}}}}this._items.push(i),this.update()},addItems:function(i){t.send(e,"addItems"),this._items=this._items.concat(i),this.update()},removeItemById:function(i){t.send(e,"removeItemById"),this._items.removeObjectByAttribute("id",i),this.update()},getItemById:function(e){return this._items.getObjectByAttribute("id",e)},getAllItems:function(){return[].concat(_toConsumableArray(this._items))},clear:function(){t.send(e,"clear"),this._items=[],this.update()},update:function(){this._helper.clear();for(var e=this._items.slice(),t=0,i=e.length;t<i;t++){var n=e[t].position;if(n){var o=e[t].explosionOffset;o&&(e[t].origin||(e[t].origin=n.z),n.z=e[t].origin+o.z)}}this._helper.add(e),this._helper.update(),this._viewer.render()},exit:function(){t.send(e,"exit");var i=this._viewer.getViewer();i.unregisterEventListener(CLOUD.EVENTS.ON_CLICK_PICK,self._pick),n&&i.unregisterEventListener(CLOUD.EVENTS.ON_HOVER_PICK,self._hover),this.clear()},hideItemsById:function(i){t.send(e,"hideItemsById"),this._helper.hideByIds(i),this._viewer.render()},hideAllItems:function(){t.send(e,"hideAllItems"),this._helper.hide(),this._viewer.render()},showItemsById:function(i){t.send(e,"showItemsById"),this._helper.showByIds(i),this._viewer.render()},showAllItems:function(){t.send(e,"showAllItems"),this._helper.show(),this._viewer.render()}},i.Marker3DContainer=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=function(){return{viewer:null}};e.SectionBoxConfig=t}(),function(){var e=Object.freeze({SectionBoxUpdate:"SectionBoxUpdate"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionBoxEvent=e}(),function(){var e,t,i="Bimface.Plugins.Section.SectionBox",n=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),a=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),function(i){var n=this,o=i.viewer;return o?o instanceof Glodon.Bimface.Viewer.Viewer3D?(o._sectionPlane&&(o._sectionPlane.hidePlane(),o._sectionPlane.exit()),e&&o==t?(e.id=i.id,e.reset(),e):(e=this,t=o,o._sectionBox?(o._sectionBox.showBox(),o._sectionBox):(o._sectionBox=this,n.id=i.id,n._opt=i,n._viewer=o,n.boxState=!0,void n.init()))):void console.log("Viewer2D is not supported."):void console.log("domElement must not be empty.")});a.prototype={hookEvens:function(){var e=this._viewer.getViewer(),t=this._viewer.getDomElement();e.registerEventListener(CLOUD.EVENTS.ON_CLIP_HOVER,function(e){e.onClipBox?t.style.cursor="url("+Cursor.section+"),auto":t.removeAttribute("style")})},init:function(){n.send(i,"init");var e=this._opt.viewer.getViewer(),t=this;e.editorManager.enableTool(e,CLOUD.EditToolMode.CLIP_BY_BOX),this._sectionBox=new CLOUD.ClipPlaneService(e);var o=e.getScene().getClipPlanes(),a=this._opt.viewer;o.observer=function(){var e=Glodon.Bimface.Plugins.Section.SectionBoxEvent;a.getEventManager().fireEvent(e.SectionBoxUpdate,t)},this._sectionBox.toggle(!0,!0),this._sectionBox.setVisible(!0),this.hookEvens()},setBox:function(e){n.send(i,"setBox"),this._sectionBox.getEditor().calculateOffsetByBox(e.min,e.max)},getBox:function(){},hideBox:function(){n.send(i,"hideBox"),this._sectionBox&&this._sectionBox.setVisible(!1),this._viewer.render()},showBox:function(){n.send(i,"showBox"),this._sectionBox&&this._sectionBox.setVisible(!0),this._viewer.render()},setProgress:function(e,t){var i=this,n={x:["left","right"],y:["back","front"],z:["bottom","top"]};t&&(i._sectionBox.setProcess(n[e][0],t[0]/100),2==t.length&&i._sectionBox.setProcess(n[e][1],1-t[1]/100))},getProgress:function(e){var t=this,i=[],n={x:["left","right"],y:["back","front"],z:["bottom","top"]};return i.push(100*t._sectionBox.getProcess(n[e][0])),i.push(100-100*t._sectionBox.getProcess(n[e][1])),i},reset:function(){n.send(i,"reset"),this._sectionBox.toggle(!0,!0),this._sectionBox.reset("Rotate"),this.showBox()},fitToModel:function(){n.send(i,"fitToModel");var e=this._sectionBox.recalculate().clone();e.isEmpty()&&e.expandByPoint(new THREE.Vector3),this.setBox(e),this._sectionBox.getEditor()._isVisible()&&this.showBox()},isIncluded:function(e){var t=this._opt.viewer,i=t.getViewer().getScene(),n=i.getClipPlanes(),o=n.getClipBoundingBox(),a=t.worldToScene(e);return o.containsPoint(a)},exit:function(){n.send(i,"exit");var t=this._opt.viewer.getViewer(),o=this._viewer.getDomElement();this.reset(),t.editorManager.disableTool(CLOUD.EditToolMode.CLIP_BY_BOX),o.removeAttribute("style"),this._sectionBox=null,this._opt.viewer._sectionBox=null,e=null,t.unregisterEventListener(CLOUD.EVENTS.ON_CLIP_HOVER,function(e){e.onClipBox?o.style.cursor="url("+Cursor.section+"),auto":o.removeAttribute("style")})},getState:function(){return this._sectionBox.saveState()},setState:function(e){this._sectionBox.loadState(e)},restore:function(){var e=this._sectionBox.getEditor()._isVisible();this._sectionBox.toggle(!0,e),this._sectionBox.reset("Rotate")}},o.SectionBox=a}(),function(){var e=Object.freeze({Forward:"Forward",Reverse:"Reverse"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionPlaneDirection=e}(),function(){var e=Object.freeze({X:"X",Y:"Y",Z:"Z"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionPlanePlane=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=function(){return{viewer:null,progress:50,plane:Glodon.Bimface.Plugins.Section.SectionPlanePlane.X,direction:Glodon.Bimface.Plugins.Section.SectionPlaneDirection.Forward}};e.SectionPlaneConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function e(t,i){_classCallCheck(this,e),this.coordinateSystem=t,this.viewer=i,this.container=this.viewer.domElement,this.mapDrawables={},this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.xmlns="http://www.w3.org/2000/svg";var e=document.createElement("div");e.style.left="0px",e.style.top="0px",e.style.width=this.container.offsetWidth+"px",e.style.height=this.container.offsetHeight+"px",e.style.position="absolute",e.style.zIndex=8,this.group=document.createElementNS(this.xmlns,"svg"),this.group.setAttribute("width",this.container.offsetWidth+""),this.group.setAttribute("height",this.container.offsetHeight+""),e.appendChild(this.group),this.container.appendChild(e)}},{key:"makeCircle",value:function(e,t){var i=this.mapDrawables;void 0==i[e]&&(i[e]=document.createElementNS(this.xmlns,"circle"),this.group.appendChild(i[e]));var n=i[e];n.style.fill=t.color||"#FF0000",n.setAttribute("r",t.radius+""),n.setAttribute("transform","translate("+t.center.x+","+t.center.y+")")}},{key:"show",value:function(e,t){var i=this.getDrawable(e);i&&(i.style.display=t?"block":"none")}},{key:"fill",value:function(e,t){this.getDrawable(e).style.fill=t?"block":"none"}},{key:"makeLine",value:function(e,t){var i=this.mapDrawables;void 0==i[e]&&(i[e]=document.createElementNS(this.xmlns,"line"),this.group.appendChild(i[e]));var n=i[e];n.setAttribute("stroke",t.color||"#000000"),n.setAttribute("stroke-width",t.width||3),n.setAttribute("x1",t.start.x+""),n.setAttribute("y1",t.start.y+""),n.setAttribute("x2",t.end.x+""),n.setAttribute("y2",t.end.y+"")}},{key:"makeDashLine",value:function(e,t){this.makeLine(e,t),this.mapDrawables[e].setAttribute("stroke-dasharray",t.dashArray)}},{key:"makePolyline",value:function(e,t){var i=null,n=this.mapDrawables;void 0==n[e]&&(n[e]=document.createElementNS(this.xmlns,"polyline"),this.group.appendChild(n[e])),i=n[e],i.setAttribute("stroke",t.color||"#A9A9A9"),i.setAttribute("stroke-width",t.width||3),i.style.fill="none",i.setAttribute("points",t.points)}},{key:"makeDefs",value:function(e){var t=this.mapDrawables;void 0==t[e]&&(t[e]=document.createElementNS(this.xmlns,"defs"),void 0==t.marker&&(t.marker=this.makeMarker(),t[e].appendChild(t.marker)),this.group.appendChild(t[e]))}},{key:"makeMarker",value:function(){var e=document.createElementNS(this.xmlns,"marker");e.setAttribute("id","arrow"),e.setAttribute("viewBox","0 0 10 10"),e.setAttribute("refX","5"),e.setAttribute("refY","5"),e.setAttribute("markerWidth","6"),e.setAttribute("markerHeight","6"),e.setAttribute("orient","auto-start-reverse");var t=document.createElementNS(this.xmlns,"path");return t.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t.style.fill="#11DAB7",this.mapDrawables.arrow=t,e.appendChild(t),e}},{key:"getDrawable",value:function(e){return this.mapDrawables[e]}},{key:"attach",value:function(){this.getDrawable("axisZ").setAttribute("marker-end","url(#arrow)")}},{key:"setColor",value:function(e,t){this.getDrawable(e).setAttribute("stroke",t)}},{key:"fill",value:function(e,t){this.getDrawable(e).style.fill=t}},{key:"hideAll",value:function(e){this.group.style.display=1==e?"none":"block"}},{key:"destroy",value:function(){for(var e=this.group.children,t=0;t<e.length;t++)this.group.removeChild(e[t]);this.group.parentNode.removeChild(this.group)}}]),e}());e.CoordinateDrawer=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function e(t,i){_classCallCheck(this,e),this.coordinateSystem=t,this.viewer=t.viewer,this.drawingImpl=i,this.viewportOffset=this.viewer.domElement.getBoundingClientRect(),this.cameraControl=this.viewer.cameraControl,this.fillClipPlane=this.viewer.getScene().getFillClipPlane(),this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.arrowMouseDown=!1,this.circleXMouseDown=!1,this.circleYMouseDown=!1,this.firstClickDown=!0,this.firstRotate=!0,this.lineOut=!0,this.arrowOut=!0,this.translateStartPt=new THREE.Vector2,this.translateEndPt=new THREE.Vector2,this.rotateAngleA=0,this.rotateAngleB=0,this.config=this.coordinateSystem.config}},{key:"registerArrowEvents",value:function(){var e=this.drawingImpl.getDrawable("axisZ"),t=this,i=this.config.colors;e.onmouseover=function(){1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&(t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.drawingImpl.setColor("tipArcX",i.default),t.drawingImpl.fill("cubeX",i.default),t.drawingImpl.setColor("tipArcY",i.default),t.drawingImpl.fill("cubeY",i.default),t.lineOut=!1)},e.onmouseout=function(){1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&0==t.arrowMouseDown&&1==t.arrowOut&&(t.drawingImpl.setColor("axisZ",i.arrow),t.drawingImpl.fill("arrow",i.arrow),t.drawingImpl.setColor("tipArcX",i.tipArcX),t.drawingImpl.fill("cubeX",i.cubeX),t.drawingImpl.setColor("tipArcY",i.tipArcY),t.drawingImpl.fill("cubeY",i.cubeY),t.lineOut=!0)},e.onmousedown=function(e){t.arrowMouseDown=!0,t.lineOut=!1;var i=t.config.colors;t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.coordinateSystem.colorUpdate=!1,t.translateStartPt.set(e.clientX,e.clientY)};var n=this.drawingImpl.getDrawable("arrow");n.onmouseover=function(){if(1!=t.circleXMouseDown&&1!=t.circleYMouseDown){t.arrowOut=!1;var e=t.config.colors;t.drawingImpl.fill("arrow",e.highLight),t.drawingImpl.setColor("axisZ",e.highLight),t.drawingImpl.setColor("tipArcX",e.default),t.drawingImpl.fill("cubeX",e.default),t.drawingImpl.setColor("tipArcY",e.default),t.drawingImpl.fill("cubeY",e.default)}},n.onmouseout=function(){if(1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&0==t.arrowMouseDown&&1==t.lineOut){t.arrowOut=!0;var e=t.config.colors;t.drawingImpl.setColor("axisZ",e.arrow),t.drawingImpl.fill("arrow",e.arrow),t.drawingImpl.setColor("tipArcX",e.tipArcX),t.drawingImpl.fill("cubeX",e.cubeX),t.drawingImpl.setColor("tipArcY",e.tipArcY),t.drawingImpl.fill("cubeY",e.cubeY)}},n.onmousedown=function(e){t.arrowMouseDown=!0,t.arrowOut=!1;var i=t.config.colors;t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.translateStartPt.set(e.clientX,e.clientY)},document.onmousemove=function(e){if(1==t.arrowMouseDown){CLOUD.GlobalData.ClippingCaps=!1;if(!(e.clientX==t.translateStartPt.x&&e.clientY==t.translateStartPt.y)){var i=t.fillClipPlane.renderClipPlane,n=i.normal.clone();n.w=i.constant;var o=t.cameraControl.movePlane(n,e,t.translateStartPt,!1,t.fillClipPlane.position.clone());null!=o&&t.fillClipPlane.offset(o),t.translateStartPt.set(e.clientX,e.clientY),t.cameraControl.update(!0)}t.coordinateSystem.update();var a=t.config.colors;t.drawingImpl.setColor("axisZ",a.highLight),t.drawingImpl.fill("arrow",a.highLight),t.drawingImpl.setColor("tipArcX",a.default),t.drawingImpl.fill("cubeX",a.default),t.drawingImpl.setColor("tipArcY",a.default),t.drawingImpl.fill("cubeY",a.default),e.preventDefault(),e.stopPropagation()}},document.onmouseup=function(){if(0!=t.arrowMouseDown){t.arrowMouseDown=!1,t.coordinateSystem.colorUpdate=!0;var e=t.config.colors;t.drawingImpl.setColor("axisZ",e.arrow),t.drawingImpl.fill("arrow",e.arrow),t.drawingImpl.setColor("tipArcX",e.tipArcX),t.drawingImpl.fill("cubeX",e.cubeX),t.drawingImpl.setColor("tipArcY",e.tipArcY),t.drawingImpl.fill("cubeY",e.cubeY),CLOUD.GlobalData.ClippingCaps=!0,t.viewer.render()}}}},{key:"registerCircleXEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcX");i.onmousedown=function(){e.circleXMouseDown=!0,e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.enableCircleXMovement()},i.onmouseout=function(){0==e.circleXMouseDown&&(e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow),e.drawingImpl.setColor("tipArcY",t.tipArcY),e.drawingImpl.fill("cubeY",t.cubeY),e.coordinateSystem.circleToArc("tipArcX"))},document.addEventListener("mouseup",function(){1==e.circleXMouseDown&&(CLOUD.GlobalData.ClippingCaps=!0,e.viewer.render()),e.circleXMouseDown=!1,e.circleXMouseDown=!1,e.firstClickDown=!0,e.firstRotate=!1,e.lastRotateX=0,e.lastRotateY=0,e.drawingImpl.show("tipArcY",!0),e.drawingImpl.show("axisY",!0),e.drawingImpl.show("axisZ",!0),e.drawingImpl.show("cubeY",!0),e.coordinateSystem.update(),e.drawingImpl.show("dashLineX",!1),e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow)})}},{key:"registerCircleYEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcY");i.onmousedown=function(){e.circleYMouseDown=!0,e.drawingImpl.setColor("axisZ",t.default),
e.drawingImpl.fill("arrow",t.default),e.enableCircleYMovement()},i.onmouseout=function(){0==e.circleYMouseDown&&(e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow),e.coordinateSystem.circleToArc("tipArcY"),e.drawingImpl.setColor("tipArcX",t.tipArcX),e.drawingImpl.fill("cubeX",t.cubeX))},document.addEventListener("mouseup",function(){1==e.circleYMouseDown&&(CLOUD.GlobalData.ClippingCaps=!0,e.viewer.render()),e.circleYMouseDown=!1,e.drawingImpl.show("tipArcX",!0),e.drawingImpl.show("cubeX",!0),e.coordinateSystem.update(),e.drawingImpl.show("dashLineY",!1),e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow)})}},{key:"enableCircleXMovement",value:function(){var e=this,t=this.config.colors;document.addEventListener("mousemove",function(i){if(1==e.circleXMouseDown){e.drawingImpl.show("dashLineX",!0),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),CLOUD.GlobalData.ClippingCaps=!1;var n=e.fillClipPlane.normalIndex,o=e.viewportOffset,a=new THREE.Vector2(i.clientX-o.left,i.clientY-o.top),r=e.calcRotateAngleIndex(a,e.coordinateSystem.discretePointsX);1==e.firstClickDown&&(e.lastIndex=r);var s=2*(r-e.lastIndex);n>3&&(s=-s),e.drawingImpl.show("tipArcY",!1),e.coordinateSystem.updateAxisZ();var l=e.fillClipPlane.renderClipPlane.normal.clone(),c=e.coordinateSystem.getCoordinateAxis(),u=e.config.styles;e.coordinateSystem.drawClipPlaneCircle("tipArcZ",c.start.clone(),u.auxCircleRadius,e.coordinateSystem.dirX,l);var d=e.coordinateSystem.drawingToCanvas(c.start.clone()),h=e.coordinateSystem.drawingToCanvas(c.endY.clone());e.coordinateSystem.drawAxisY(d,h,t.highLight),e.coordinateSystem.drawCubeX("cubeX",h,u.cubeRadius),e.drawingImpl.show("cubeY",!1);var f="x";n<2&&(f="y"),e.fillClipPlane.rotateAngleOffset(s,f),e.coordinateSystem.backwardCoordinate(),1==e.firstClickDown?e.firstClickDown=!1:e.lastIndex=r,e.translateStartPt.set(i.clientX,i.clientY),e.viewer.render(),i.preventDefault(),i.stopPropagation()}})}},{key:"enableCircleYMovement",value:function(){var e=this,t=this.config.colors;document.addEventListener("mousemove",function(i){if(1==e.circleYMouseDown){e.drawingImpl.show("dashLineY",!0),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),CLOUD.GlobalData.ClippingCaps=!1;var n=e.fillClipPlane.normalIndex,o=e.viewportOffset,a=new THREE.Vector2(i.clientX-o.left,i.clientY-o.top),r=e.calcRotateAngleIndex(a,e.coordinateSystem.discretePointsY);1==e.firstClickDown&&(e.lastIndex=r);var s=2*(r-e.lastIndex);n>3&&(s=-s),e.drawingImpl.show("tipArcX",!1),e.coordinateSystem.updateAxisZ();var l=e.fillClipPlane.renderClipPlane.normal.clone(),c=e.coordinateSystem.getCoordinateAxis(),u=e.config.styles;e.coordinateSystem.drawClipPlaneCircle("tipArcZ",c.start.clone(),u.auxCircleRadius,e.coordinateSystem.dirX.clone(),l.clone());var d=e.coordinateSystem.drawingToCanvas(c.start.clone()),h=e.coordinateSystem.drawingToCanvas(c.endX.clone());e.coordinateSystem.drawAxisX(d,h,t.highLight),e.coordinateSystem.drawCubeY("cubeY",h,u.cubeRadius),e.drawingImpl.show("cubeX",!1);var f="z";n>=3&&(f="y"),e.fillClipPlane.rotateAngleOffset(s,f),e.coordinateSystem.backwardCoordinate(),1==e.firstClickDown?e.firstClickDown=!1:e.lastIndex=r,e.translateStartPt.set(i.clientX,i.clientY),e.viewer.render(),i.preventDefault(),i.stopPropagation()}})}},{key:"registerTipArcXEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcX");i.onmouseover=function(){0==e.circleYMouseDown&&(e.coordinateSystem.arcToCircle("tipArcX"),e.drawingImpl.setColor("tipArcY",t.default),e.drawingImpl.fill("cubeY",t.default),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.registerCircleXEvents())},i.onmouseout=function(){0==e.circleXMouseDown&&e.coordinateSystem.circleToArc("tipArcX")}}},{key:"registerTipArcYEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcY");i.onmouseover=function(){0==e.circleXMouseDown&&(e.coordinateSystem.arcToCircle("tipArcY"),e.drawingImpl.setColor("tipArcX",t.default),e.drawingImpl.fill("cubeX",t.default),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.registerCircleYEvents())},i.onmouseout=function(){0==e.circleYMouseDown&&e.coordinateSystem.circleToArc("tipArcY")}}},{key:"calcRotateAngleIndex",value:function(e,t){for(var i=this.coordinateSystem.cOrigin,n=this.createLine(e,i),o=-1,a=Number.POSITIVE_INFINITY,r=0;r<90;r++){var s=t[r].clone(),l=this.disPointToLine(s,n);l<a&&(a=l,o=r)}var c=90+o;return t[o].clone().distanceTo(e)<t[c].clone().distanceTo(e)?o:c}},{key:"createLine",value:function(e,t){var i={};if(e.x==t.x)i.A=1,i.B=0,i.C=-e.x;else{var n=(t.y-e.y)/(t.x-e.x),o=t.y-n*t.x;i.A=n,i.B=-1,i.C=o}return i}},{key:"disPointToLine",value:function(e,t){return Math.abs(t.A*e.x+t.B*e.y+t.C)/Math.sqrt(t.A*t.A+t.B*t.B)}}]),e}());e.CoordinateAction=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=function(){return{colors:{tipArcX:"#0000FF",cubeX:"#0000FF",tipArcY:"#FF0000",cubeY:"#FF0000",highLight:"#FFFF00",tipLine:"#11DAB7",arrow:"#11DAB7",default:"#A9A9A9"},styles:{dashArray:"10 8",originRadius:5,auxCircleRadius:100,tipLineLength:500,cubeRadius:5,axisXWidth:2,axisYWidth:2,axisZWidth:3,axisXLength:100,axisYLength:100,axisZLength:165,segments:180,tipArcLeftCounts:15,tipArcRightCounts:60}}};e.CoordinateSystemConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function e(t){_classCallCheck(this,e),this.viewer=t,this.cameraControl=t.cameraControl,this.fillClipPlane=t.getScene().getFillClipPlane(),this.container=t.domElement,this.config=new Glodon.Bimface.Plugins.Section.CoordinateSystemConfig,this.drawingImpl=new Glodon.Bimface.Plugins.Section.CoordinateDrawer(this,t),this.coordinateAction=new Glodon.Bimface.Plugins.Section.CoordinateAction(this,this.drawingImpl),this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.enable=!0,this.boundingBox=new THREE.Box2,this.bRegisterArrowEvent=!1,this.bRegisterAuxCircleEvent=!1,this.mapDrawableName={ORIGIN:"origin",AXISX:"axisX",AXISY:"axisY",CUBEX:"cubeX",CUBEY:"cubeY",AXISZ:"axisZ",ARROW:"arrow",DASHLINE:"dashLine",TIPARC_X:"tipArcX",TIPARC_Y:"tipArcY",TIPARC_Z:"tipArcZ",DASHLINE_X:"dashLineX",DASHLINE_Y:"dashLineY"}}},{key:"saveTransform",value:function(e){this.savedCamera=e.clone()}},{key:"drawingToCanvas",value:function(e,t){var i=this.getCoordinateAxis(),n=i.start.clone(),o=this.cameraControl.camera,a=new THREE.Vector3;if(void 0==this.cameraToCenter){var r=this.viewer.getCamera(),s=this.viewer.getScene().getBoundingBox();o.setStandardView(CLOUD.EnumStandardView.ISO,s),o.zoomToBBox(s),n=this.getCoordinateAxis().start.clone(),this.cameraToCenter=n.clone().sub(o.position.clone()).length();var l=this.viewer.getScene().getMatrixGlobal(),c=CLOUD.CameraUtil.parseCameraInfo(r),u=CLOUD.Camera.worldToDrawing(c,l),d=new THREE.Vector3;d.subVectors(u.target,u.position),o.LookAt(u.target,d,u.up),this.cameraControl.update(!0,!0)}else{var d=n.clone().sub(o.position.clone()).normalize(),h=o.position.clone().sub(n.clone()).length();a=d.multiplyScalar(this.cameraToCenter-h)}var f=this.container.offsetWidth,g=this.container.offsetHeight;!1!==t&&e.add(a);var p=CLOUD.CameraUtil.drawingToCanvas(o,e,f,g);return new THREE.Vector2(p.x,p.y)}},{key:"getCoordinateAxis",value:function(){var e=this.fillClipPlane.renderClipPlane,t=e.normal.clone(),i=this.fillClipPlane.getCoordinate(),n=i.axisY.clone(),o=t.clone().cross(n.clone());this.fillClipPlane.normalIndex>3&&(o=i.axisX.clone(),n=o.clone().cross(t.clone()));var a=this.config.styles,r=this.fillClipPlane.position.clone(),s=r.clone().add(o.clone().multiplyScalar(a.axisXLength)),l=r.clone().add(n.clone().multiplyScalar(a.axisYLength)),c=r.clone().add(t.clone().multiplyScalar(a.axisZLength));return this.dirX=o,this.dirY=n,{start:r,endX:s,endY:l,endZ:c}}},{key:"drawOrigin",value:function(e,t){var i=this.mapDrawableName,n={center:e,radius:t,color:this.config.colors.default};this.drawingImpl.makeCircle(i.ORIGIN,n)}},{key:"drawAxisX",value:function(e,t,i){var n=this.mapDrawableName,o=this.config,a={start:e,end:t,width:o.styles.axisXWidth,color:i||this.config.colors.default};this.drawingImpl.makeLine(n.AXISX,a)}},{key:"drawAxisY",value:function(e,t,i){var n=this.mapDrawableName,o=this.config,a={start:e,end:t,width:o.styles.axisYWidth,color:i||o.colors.default};this.drawingImpl.makeLine(n.AXISY,a)}},{key:"drawAxisZ",value:function(e,t){var i=this.mapDrawableName,n=this.config,o={start:e,end:t,width:n.styles.axisZWidth,color:n.colors.arrow};this.drawingImpl.makeLine(i.AXISZ,o),this.drawingImpl.attach(),0==this.bRegisterArrowEvent&&(this.coordinateAction.registerArrowEvents(),this.bRegisterArrowEvent)}},{key:"updateAxisZ",value:function(){var e=this.getCoordinateAxis(),t=this.drawingToCanvas(e.start.clone()),i=this.drawingToCanvas(e.endZ.clone()),n=this.mapDrawableName,o={start:t,end:i,color:this.config.colors.default};this.drawingImpl.makeLine(n.AXISZ,o)}},{key:"drawArrow",value:function(e,t){var i=this.mapDrawableName,n={start:e,end:t};this.drawingImpl.makeLine(i.AXISZ,n),this.drawingImpl.attach(),this.drawingImpl.setColor(i.AXISZ,this.config.colors.default),0==this.bRegisterArrowEvent&&(this.coordinateAction.registerArrowEvents(),this.bRegisterArrowEvent)}},{key:"drawClipPlaneCircle",value:function(e,t,i,n,o){for(var a={center:t.clone(),radius:i,normal:n.clone(),rotateAxis:o.clone()},r=this.config.styles,s=r.segments,l=this.discreteCircle(a,s),c="",u=0;u<s;u++)c+=l[u].x+","+l[u].y,c+=" ";c+=l[0].x+","+l[0].y,c+=" ";var d={points:c,color:this.config.colors.default,width:2};this.drawingImpl.makePolyline(e,d)}},{key:"drawTipArc",value:function(e,t,i,n,o){var a={center:t.clone(),radius:i,normal:n.clone(),rotateAxis:o.clone()},r=this.config.styles,s=r.tipArcRightCounts,l=r.tipArcLeftCounts,c=r.segments,u=this.discreteCircle(a,c);e==this.mapDrawableName.TIPARC_X?(this.discretePointsX=u,s=r.tipArcLeftCounts,l=r.tipArcRightCounts):this.discretePointsY=u;for(var d="",h=c-s-1;h<c;h++)d+=u[h].x+","+u[h].y,d+=" ";for(var f=0;f<=l;f++)d+=u[f].x+","+u[f].y,d+=" ";var g={points:d,color:this.config.colors.tipArcX};e==this.mapDrawableName.TIPARC_X?(this.drawingImpl.makePolyline(e,g),this.coordinateAction.registerTipArcXEvents()):e==this.mapDrawableName.TIPARC_Y&&(g.color=this.config.colors.tipArcY,this.drawingImpl.makePolyline(e,g),this.coordinateAction.registerTipArcYEvents())}},{key:"drawTipLine",value:function(e,t,i){var n=this.drawingToCanvas(t.clone(),!1),o=this.drawingToCanvas(i.clone(),!1),a=this.config,r={start:n,end:o,color:a.colors.tipLine,dashArray:a.styles.dashArray};this.drawingImpl.makeDashLine(e,r),this.drawingImpl.show(e,!1)}},{key:"drawCubeX",value:function(e,t,i){var n={center:t,radius:i,color:this.config.colors.cubeX};this.drawingImpl.makeCircle(e,n)}},{key:"drawCubeY",value:function(e,t,i,n){var o={center:t,radius:i,color:n||this.config.colors.cubeY};this.drawingImpl.makeCircle(e,o)}},{key:"discreteCircle",value:function(e,t){for(var i=e.center.clone(),n=e.radius,o=e.rotateAxis.clone(),a=e.normal.clone(),r=[],s=0;s<t;s++){a.applyAxisAngle(o,2*Math.PI/t);var l=i.clone().add(a.clone().multiplyScalar(n)),c=this.drawingToCanvas(l.clone());r.push(c)}return r}},{key:"arcToCircle",value:function(e){var t="",i=this.discretePointsX;e==this.mapDrawableName.TIPARC_Y&&(i=this.discretePointsY);for(var n=0,o=i.length;n<o;n++)t+=i[n].x+","+i[n].y,t+=" ";t+=i[0].x+","+i[0].y,t+=" ";var a={points:t,color:this.config.colors.highLight};this.drawingImpl.makePolyline(e,a)}},{key:"circleToArc",value:function(e){var t=this.config.styles,i=t.tipArcLeftCounts,n=t.tipArcRightCounts,o=t.segments,a=this.discretePointsX,r={color:this.config.colors.tipArcX};e==this.mapDrawableName.TIPARC_Y&&(a=this.discretePointsY,r.color=this.config.colors.tipArcY,i=t.tipArcRightCounts,n=t.tipArcLeftCounts);for(var s="",l=o-i-1;l<o;l++)s+=a[l].x+","+a[l].y,s+=" ";for(var c=0;c<=n;c++)s+=a[c].x+","+a[c].y,s+=" ";r.points=s,this.drawingImpl.makePolyline(e,r)}},{key:"update",value:function(){var e=this.getCoordinateAxis(),t=this.drawingToCanvas(e.start.clone()),i=this.drawingToCanvas(e.endX.clone()),n=this.drawingToCanvas(e.endY.clone()),o=this.drawingToCanvas(e.endZ.clone());void 0==this.createRefs&&(this.drawingImpl.makeDefs("refs"),this.createRefs=!0),this.cOrigin=t.clone(),this.drawAxisZ(t,o),this.drawAxisX(t,i),this.drawAxisY(t,n);var a=this.config.styles,r=this.mapDrawableName,s=this.fillClipPlane.renderClipPlane.normal.clone();this.drawClipPlaneCircle(r.TIPARC_Z,e.start.clone(),a.auxCircleRadius,this.dirX,s),this.drawTipArc(r.TIPARC_X,e.start.clone(),a.auxCircleRadius,s,this.dirX),this.drawTipArc(r.TIPARC_Y,e.start.clone(),a.auxCircleRadius,s,this.dirY);var l=e.start.clone().add(this.dirX.clone().multiplyScalar(a.tipLineLength)),c=e.start.clone().sub(this.dirX.clone().multiplyScalar(a.tipLineLength));this.drawTipLine(r.DASHLINE_X,l,c);var u=e.start.clone().add(this.dirY.clone().multiplyScalar(a.tipLineLength)),d=e.start.clone().sub(this.dirY.clone().multiplyScalar(a.tipLineLength));this.drawTipLine(r.DASHLINE_Y,u,d),this.drawOrigin(t,a.originRadius);var h=this.discretePointsX[44].clone();this.drawCubeX(r.CUBEX,h,a.cubeRadius);var f=this.discretePointsY[134].clone();this.drawCubeY(r.CUBEY,f,a.cubeRadius),this.updateBbox()}},{key:"hide",value:function(e){this.drawingImpl.hideAll(e)}},{key:"destroy",value:function(){this.drawingImpl.destroy()}},{key:"updateBbox",value:function(){this.boundingBox.makeEmpty();for(var e=0;e<this.discretePointsX.length;e++){var t=this.discretePointsX[e].clone();this.boundingBox.expandByPoint(t)}for(e=0;e<this.discretePointsY.length;e++){var t=this.discretePointsY[e].clone();this.boundingBox.expandByPoint(t)}var i=this.getCoordinateAxis(),n=this.drawingToCanvas(i.start.clone()),o=this.drawingToCanvas(i.endZ.clone());this.boundingBox.expandByPoint(n),this.boundingBox.expandByPoint(o),this.boundingBox.expandByScalar(5)}},{key:"insideBoundingBox",value:function(e){return this.boundingBox.containsPoint(e.clone())}},{key:"backwardCoordinate",value:function(){var e=this.cameraControl.camera.position,t=this.cameraControl.camera.target,i=t.clone().sub(e.clone()).normalize(),n=this.fillClipPlane.renderClipPlane.normal.clone();i.angleTo(n);Math.PI}}]),e}());e.CoordinateSystem=t}(),function(){var e=Object.freeze({SectionPlaneUpdate:"SectionPlaneUpdate"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionPlaneEvent=e}(),function(){var e="Bimface.Plugins.Section.SectionPlane",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),{Forward:0,Reverse:1}),o={X:0,Y:2,Z:4},a=function(e){var t=this,i=e.viewer;return i?i instanceof Glodon.Bimface.Viewer.Viewer3D?(i._sectionBox&&(i._sectionBox.hideBox(),i._sectionBox.exit()),i._sectionPlane?(i._sectionPlane.showPlane(),i._sectionPlane):(i._sectionPlane=this,t.id=e.id,t._opt=e,t.mode=e.mode,t._plane=e.plane,t._direction=e.direction,t._progress=e.progress,t.init(),void t.setPlane(e.plane))):void console.log("Viewer2D is not supported."):void console.log("domElement must not be empty.")};a.prototype={init:function(){t.send(e,"init"),this.enableCoordinate=!0;var i=this._opt.viewer.getViewer(),n=this;this.coordinateSystem=new Glodon.Bimface.Plugins.Section.CoordinateSystem(i),CLOUD.GlobalData.ClippingCaps=!0,i.editorManager.enableTool(i,CLOUD.EditToolMode.CLIP_FILL),this._sectionTool=i.getScene().getFillClipPlane();var o=this._opt.viewer;this._sectionTool.observer=function(){var e=Glodon.Bimface.Plugins.Section.SectionPlaneEvent;o.getEventManager().fireEvent(e.SectionPlaneUpdate,n)},this._sectionTool.enable(!0,!0),this.hookEvens()},hookEvens:function(){var e=this,t=this.coordinateSystem,i=this._opt.viewer.getViewer(),n=this._opt.viewer.getDomElement();i.registerEventListener(CLOUD.EVENTS.ON_CLIP_HOVER,function(i){if(0!=e.enableCoordinate)if(i.onClipPlane)t.update(),t.hide(!1),n.style.cursor="default";else{n.style.cursor="";var o=new THREE.Vector2(i.event.clientX,i.event.clientY);t.insideBoundingBox(o)?t.hide(!1):t.hide(!0)}}),i.registerEventListener(CLOUD.EVENTS.ON_CLIP_MOUSE_DOWN,function(e){}),i.registerEventListener(CLOUD.EVENTS.ON_CLIP_MOUSE_MOVE,function(e){t.update()}),i.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,function(e){t.update()}),i.registerEventListener(CLOUD.EVENTS.ON_CAMERA_ANIMATION_UPDATE,function(e){t.update()})},exit:function(){var e=this._opt.viewer.getViewer(),t=e.getScene().getFillClipPlane();e.editorManager.disableTool(CLOUD.EditToolMode.CLIP_FILL),CLOUD.GlobalData.ClippingCaps=!1,t.enable(!1,!1),this.coordinateSystem.destroy(),this._sectionTool=null,this._opt.viewer._sectionPlane=null},setProgress:function(i){t.send(e,"setProgress");var n=1-i/50;this._progress=i,this._sectionTool.setProcess(n)},getProgress:function(){return 50*(1-this._sectionTool.getProcess())},setPlane:function(i){t.send(e,"setPlane");var a=n[this._direction]+o[i];this._plane=i,this._sectionTool.changeNormal(a),this.setProgress(this._opt.progress)},getPlane:function(){return this._plane},setDirection:function(i){t.send(e,"setDirection");var a=n[i]+o[this._plane];this._direction=i,this._sectionTool.changeNormal(a),this.setProgress(this._opt.progress)},getDirection:function(){return this._direction},setRotateAngle:function(e,t){this._sectionTool.setRotateAngle(e,t)},getRotateAngle:function(){return this._sectionTool.getRotateAngle()},hidePlane:function(){t.send(e,"hidePlane"),this._sectionTool&&(this._sectionTool.visible=!1),this.enableCoordinate=!1,this.coordinateSystem.hide(!0)},showPlane:function(){t.send(e,"showPlane"),this._sectionTool&&(this._sectionTool.visible=!0),this.enableCoordinate=!0},rotateByAxis:function(i,a){if(t.send(e,"rotateByAxis"),"YAxis"!==i&&"ZAxis"!==i)return void console.log("Rotate axis must be YAxis or ZAxis.");var r="",s=0,l=n[this.getDirection()]+o[this._plane];0==l||1==l?(s="YAxis"===i?-a:a,r="YAxis"===i?"y":"z"):2==l||3==l?(s="YAxis"===i?-a:a,r="YAxis"===i?"x":"z"):4!=l&&5!=l||(s="YAxis"===i?a:-a,r="YAxis"===i?"x":"y"),this._sectionTool&&this._sectionTool.rotateAngleOffset(s,r)},reset:function(){t.send(e,"reset");var i=this;i.setPlane(i._opt.plane),i.setDirection(i._opt.direction),i.setProgress(i._opt.progress)},getState:function(){return this._sectionTool.store()},isIncluded:function(e){var t=this._opt.viewer,i=t.getViewer().getScene(),n=i.getFillClipPlane(),o=n.getFillClipBoundingBox(),a=t.worldToScene(e);return o.containsPoint(a)},setState:function(i){t.send(e,"setState"),this._sectionTool.restore(i)},restoreRotation:function(){this._sectionTool.restoreRotation()}},i.SectionPlane=a}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Walkthrough"),t=function(){return{viewer:null,time:10,stopCallback:null}};e.WalkthroughConfig=t}(),function(){var e="Bimface.Plugins.Walkthrough",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Walkthrough"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function i(e){_classCallCheck(this,i);var t=e.viewer,n=t.getViewer();return t?t instanceof Glodon.Bimface.Viewer.Viewer3D?(this._viewer=t,this.bPause=!0,this.cameraStatus=null,this._walkthrough=new CLOUD.Walkthrough,this._player=new CLOUD.WalkthroughPlayer(n),this._player.setWalkthrough(this._walkthrough),e.stopCallback&&this._player.addStopPlayCallback(e.stopCallback),void this.setWalkthroughTime(e.time)):void console.log("Viewer2D is not supported."):void console.log("viewer must be empty.")}return _createClass(i,[{key:"addKeyFrame",value:function(){t.send(e,"addKeyFrame");var i=this._viewer,n=i.getViewer().camera,o={id:Glodon.Web.Lang.Utility.UUID.createUUID(),position:n.position.clone(),target:n.target.clone()};return this._walkthrough.addKeyFrame(o),o}},{key:"setKeyFrameCallback",value:function(i){t.send(e,"setKeyFrameCallback"),this._player.setKeyFrameCallback(i)}},{key:"removeKeyFrame",value:function(i){t.send(e,"removeKeyFrame"),this._walkthrough.removeKeyFrame(i)}},{key:"clearKeyFrames",value:function(){t.send(e,"clearKeyFrames"),this._walkthrough.clearFrames()}},{key:"setKeyFrames",value:function(i){t.send(e,"setKeyFrames"),"string"==typeof i&&(i=JSON.parse(i)),this._walkthrough.setKeyFrameList(i)}},{key:"getKeyFrames",value:function(){return this._walkthrough.getKeyFrames()}},{key:"setWalkthroughTime",value:function(i){t.send(e,"setWalkthroughTime"),this._walkthrough.setWalkthroughTime(i)}},{key:"play",value:function(i){t.send(e,"play");var n=this._player,o=this.cameraStatus;if(i&&n.startFrom(i),n.stop(!1),!0===this.bPause){var a=this._viewer.getViewer().getCamera();o&&function(e){var e=JSON.parse(e),t=e.position,i=e.target,n={position:new THREE.Vector3(t.x,t.y,t.z),target:new THREE.Vector3(i.x,i.y,i.z)},a=o,r=n.position.clone().sub(a.position),s=n.target.clone().sub(a.target);return r.length()>0||s.length()>0}(a)?this._viewer.setCameraStatus(o,function(){n.play(),o=null}):n.play()}else n.play();this.bPause=!1}},{key:"pause",value:function(){t.send(e,"pause"),this.bPause=!0,this.cameraStatus=this._viewer.getCameraStatus(),this._player.pause()}},{key:"stop",value:function(){t.send(e,"stop"),this._player.stop(!0),this._stopCallback&&this._stopCallback()}},{key:"stopCallback",value:function(i){t.send(e,"stopCallback"),i&&(this._stopCallback=i,this._player.addStopPlayCallback(i))}}]),i}());i.Walkthrough=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Segment"),t=function(){return{viewer:null}};e.SegmentConfig=t}(),function(){Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Segment").IsolateOption=Object.freeze({Hidden:"Hidden",Translucent:"Translucent",PartlyTranslucent:"PartlyTranslucent"})}(),function(){var e="Bimface.Plugins.Segment",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Segment"),n=function(){function i(e){_classCallCheck(this,i),this._viewer=e.viewer,this._segmentInfoMap=null,this._segmentInfoArray=null,this._segmentIdArray=null,this._elementIdMap={},this._loading=!1,this._segmentInfoAcquired=!1,this._segmentIdMapFromComponentId=null}return _createClass(i,[{key:"destroy",value:function(){this._viewer=null,this._segmentInfoMap=null,this._segmentInfoArray=null,this._segmentIdArray=null,this._elementIdMap=null,this._segmentIdMapFromComponentId=null}},{key:"_hasSegmentInfo",value:function(e){return!(!this._segmentInfoMap||!this._segmentInfoMap[e])}},{key:"_getSegmentInfoById",value:function(e){return this._segmentInfoMap?this._segmentInfoMap[e]:null}},{key:"_removeDuplication",value:function(e){for(var t={},i=0,n=e.length;i<n;i++)this._hasSegmentInfo(e[i])&&!t[e[i]]&&(t[e[i]]=!0);return Object.keys(t)}},{key:"_getSegmentElementIdsByIdx",value:function(e,t,i){var n=this,o=this._viewer,a=e[t];o.getSegmentElementIds(a,function(e){e.data&&(n._elementIdMap[a]=e.data),i&&i()},function(){i&&i()})}},{key:"_getSegmentElementIds",value:function(e){function t(i,a){var r=a;return function(){o._getSegmentElementIdsByIdx(i,r,function(){r<n-1?requestAnimationFrame(t(i,r+1)):e&&e()})}}var i=this._segmentIdArray,n=i.length,o=this;this._elementIdMap={},n>0?requestAnimationFrame(t(i,0)):e&&e()}},{key:"_getSegmentMetadataByIdx",value:function(e,t,i){var n=this._viewer,o=e[t],a=this.segmentFilePathMap[o].metadata,r=this.segmentFilePathMap[o].databag;n.getSegmentManager().getSegmentMetadata(r,a,function(){i&&i()},function(){i&&i()})}},{key:"_getSegmentMetadata",value:function(e){function t(i,a){var r=a;return function(){o._getSegmentMetadataByIdx(i,r,function(){r<n-1?requestAnimationFrame(t(i,r+1)):e&&e()})}}var i=Object.keys(this.segmentFilePathMap),n=i.length,o=this;n>0?requestAnimationFrame(t(i,0)):e&&e()}},{key:"_loadMetadata",value:function(e){for(var t=this._viewer,i=this._segmentIdArray,n=this.segmentFilePathMap={},o=this.segmentFileInfoMap={},a=0,r=i.length;a<r;a++){var s=i[a],l=this._getSegmentInfoById(s),c=l.partialElementFiles,u=[];if(c)for(var d=0,h=c.length;d<h;d++){var f=c[d].databagId;if(f){var g=null;n[f]?g=n[f]:(g={databag:t.getDatabagResource(f),metadata:t.getPartialElementsMetadataFile(f),fileId:c[d].fileId},n[f]=g),u.push(g)}}o[s]={id:s,paths:u,elementIds:this._elementIdMap[s]}}this._getSegmentMetadata(e)}},{key:"_loadSegments",value:function(e,t){if(!(e=e||this._segmentIdArray))return void(t&&t());for(var i=this._viewer,n=this._removeDuplication(e),o=[],a=0,r=n.length;a<r;a++){var s=this.segmentFileInfoMap[n[a]];s&&o.push(s)}if(0===o.length)return void(t&&t());i.getSegmentManager().loadSegments(o,function(){t&&t()})}},{key:"getSegmentInfo",value:function(i){function n(e,t){if(e.subGroups)for(var i=e.subGroups,o=0,a=i.length;o<a;o++)n(i[o],t);else if(e.segments)for(var r=0,s=e.segments.length;r<s;r++){var l=e.segments[r];t[l.id]=l}}if(t.send(e,"getSegmentInfo"),this._loading)return null;if(this._segmentInfoAcquired)return i&&i(this._segmentInfoArray),this._segmentInfoArray;var o=this;return this._loading=!0,this._viewer.getSegmentTree(function(e){for(var t=e.data,a=o._segmentInfoMap={},r=0,s=t.length;r<s;r++)n(t[r],a);o._segmentIdArray=Object.keys(o._segmentInfoMap),o._segmentInfoArray=[];for(var l=o._segmentInfoArray.length=o._segmentIdArray.length,c=0;c<l;c++)o._segmentInfoArray[c]=o._segmentInfoMap[o._segmentIdArray[c]];o._getSegmentElementIds(function(){o._loadMetadata(function(){o._loading=!1,o._segmentInfoAcquired=!0,i&&i(o._segmentInfoArray)})})},function(e){console.error("request segment data error!")}),null}},{key:"loadSegments",value:function(i,n){if(t.send(e,"loadSegments"),this._segmentInfoAcquired)this._loadSegments(i,n);else{var o=this;this.getSegmentInfo(function(e){o._loadSegments(i,n)})}}},{key:"unloadSegments",value:function(i){t.send(e,"unloadSegments"),(i=i||this._segmentIdArray)&&(this._viewer.getSegmentManager().unloadSegments(this._removeDuplication(i)),this._viewer.render())}},{key:"hideComponentsBySegment",value:function(i){t.send(e,"hideComponentsBySegment"),this._viewer.getSegmentManager().hideComponentsBySegment(this._removeDuplication(i)),this._viewer.render()}},{key:"showComponentsBySegment",value:function(i){t.send(e,"showComponentsBySegment"),this._viewer.getSegmentManager().showComponentsBySegment(this._removeDuplication(i)),this._viewer.render()}},{key:"isolateComponentsBySegment",value:function(i,n){t.send(e,"isolateComponentsBySegment");var o=void 0,a=Glodon.Bimface.Plugins.Segment.IsolateOption;switch(n){case a.Hidden:o=this._viewer.getSegmentManager().getSegmentIsolateOption().HIDDEN;break;case a.Translucent:o=this._viewer.getSegmentManager().getSegmentIsolateOption().TRANSLUCENT;break;case a.PartlyTranslucent:o=this._viewer.getSegmentManager().getSegmentIsolateOption().PARTLYTRANSLUCENT}void 0!==o&&(this._viewer.getSegmentManager().isolateComponentsBySegment(this._removeDuplication(i),o),this._viewer.render())}},{key:"disable",value:function(){this._viewer.getSegmentManager().disable(),this._viewer.render()}},{key:"enable",value:function(){this._viewer.getSegmentManager().enable(),this._viewer.render()}},{key:"getSegementIds",value:function(e){if(!this._segmentInfoAcquired)return console.error("Call the function getSegmentInfo() first!"),null;if(this._segmentIdMapFromComponentId)return this._segmentIdMapFromComponentId[e];for(var t=this._segmentIdMapFromComponentId={},i=Object.keys(this._elementIdMap),n=0,o=i.length;n<o;n++)for(var a=i[n],r=this._elementIdMap[a],s=0,l=r.length;s<l;s++){var c=r[s];t[c]||(t[c]=[]),t[c].push(a)}var u=this._viewer.getSegmentManager().getSegmentIdsByPartialElementId(e);return u&&(t[e]=u),t[e]}}]),i}();i.Segment=n}(),function(){var e="Bimface.Plugins.Material.Material",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Material"),n=function(){function i(n){return _classCallCheck(this,i),t.send(e,"bf_c_mat_newMat"),n?(this.id=n.id,this.offset=n.offset,this.rotation=n.rotation,this.scale=n.scale,this.src=n.src,this.viewer=n.viewer,!this.viewer||!this.viewer instanceof Glodon.Bimface.Viewer.Viewer3D?void console.log("ERROR::viewer must not be empty or viewer2d."):(this.material=new THREE.MeshStandardMaterial,this.material.name=this.id,this._loadTexture(),void(this.objectList=[]))):void console.log("ERROR::materialConfig must not be empty.")}return _createClass(i,[{key:"_loadTexture",value:function(e,t){var i=new THREE.Texture,n=this,o=new THREE.ImageLoader;o.setCrossOrigin("anonymous"),o.load(this.src,function(t){i.image=CLOUD.MaterialUtil.ensurePowerOfTwo(t),i.needsUpdate=!0,i.offset.fromArray(n.offset),i.setRotateAngle(n.rotation),i.repeat.fromArray(n.scale),i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,n.material.map=i,n.material.needsUpdate=!0,e&&onLoad(i)},null,function(e){console.log(e),t&&t(e)})}},{key:"overrideComponentsMaterialById",value:function(i){if(t.send(e,"bf_c_mat_override"),i instanceof Array){var n=this.viewer.getViewer().getFilter();this.objectList=i,n.addToOverrideListByMaterialAndId(i,this.material)}else console.log("ERROR::ids should be Array")}},{key:"clearOverrideComponentsMaterial",value:function(){this.viewer.getViewer().getFilter().addToOverrideListByMaterialAndId(this.objectList,null)}},{key:"getId",value:function(){return t.send(e,"bf_c_mat_getId"),this.id}},{key:"getOffset",value:function(){return this.offset}},{key:"getRotation",value:function(){return this.rotation}},{key:"getScale",value:function(){return this.scale}},{key:"getSrc",value:function(){return this.src}},{key:"setOffset",value:function(e){e instanceof Array&&2==e.length?(this.offset=e,this.material&&this.material.map&&(this.material.map.offset.fromArray(e),this.material.needsUpdate=!0)):console.log("ERROR::offset should be array of 2 elements")}},{key:"setRotation",value:function(i){t.send(e,"bf_c_mat_setRotation"),this.rotation=i,this.material&&this.material.map&&(this.material.map.setRotateAngle(i),this.material.needsUpdate=!0)}},{key:"setScale",value:function(i){t.send(e,"bf_c_mat_setScale"),i instanceof Array&&2==i.length?(this.scale=i,this.material&&this.material.map&&(this.material.map.repeat.fromArray(i),this.material.needsUpdate=!0)):console.log("ERROR::scale should be array of 2 elements")}},{key:"setSrc",value:function(e){this.src=e,this._loadTexture()}}]),i}();i.Material=n}(),function(){var e=(Glodon.Bimface.Data.StatisticsDataManager.getInstance(),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Material")),t=function e(){_classCallCheck(this,e),this.id=Glodon.Web.Lang.Utility.UUID.createUUID(),this.offset=[0,0],this.rotation=0,this.scale=[1,1],this.src=null,this.viewer=null};e.MaterialConfig=t}(),function(){var e="Bimface.Plugins.Material.MaterialContainer",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Material"),n=function(){function i(){_classCallCheck(this,i),t.send(e,"bf_c_mat_newMatContainer"),this.materials={}}return _createClass(i,[{key:"addMaterial",value:function(e){this.materials[e.id]=e}},{key:"clear",value:function(){for(var e in this.materials)this.materials[e].clearOverrideComponentsMaterial();this.materials={}}},{key:"removeMaterialById",value:function(e){this.materials[e]&&(this.materials[e].clearOverrideComponentsMaterial(),delete this.materials[e])}},{
key:"getAllMaterials",value:function(){return Object.values(this.materials)}},{key:"getMaterialById",value:function(e){return this.materials[e]}}]),i}();i.MaterialContainer=n}(),function(){var e="Bimface.Plugins.Animation.AnimationContainer",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Animation"),n=function(){function i(){_classCallCheck(this,i),t.send(e,"bf_c_animation_newContainer"),this.animations={}}return _createClass(i,[{key:"addAnimation",value:function(e){this.animations[e.id]=e}},{key:"clear",value:function(){for(var e in this.animations)this.animations[e].stop();this.animations={}}},{key:"getAllAnimations",value:function(){return Object.values(this.animations)}},{key:"getAnimationById",value:function(e){return this.animations[e]}},{key:"removeAnimationById",value:function(e){this.animations[e]&&(this.animations[e].stop(),delete this.animations[e])}}]),i}();i.AnimationContainer=n}(),function(){var e="Bimface.Plugins.Animation.FlowEffect",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Animation"),n=function(){function i(n){return _classCallCheck(this,i),t.send(e,"bf_c_flow_newFlow"),n?(this.material=n.material,this.speed=n.speed,this.viewer=n.viewer,this.id=n.id,!this.viewer||!this.viewer instanceof Glodon.Bimface.Viewer.Viewer3D?void console.log("ERROR::viewer must not be empty or viewer2d."):void(this.animationId=0)):void console.log("ERROR::flowEffectConfig must not be empty.")}return _createClass(i,[{key:"getSpeed",value:function(){return this.speed}},{key:"setSpeed",value:function(i){t.send(e,"bf_c_flow_setSpeed"),i instanceof Array&&2==i.length?this.speed=i:console.log("ERROR::speed should be array of 2 elements")}},{key:"play",value:function(){function e(){t.animationId=requestAnimationFrame(e);var i=t.material.getOffset();t.material.setOffset([i[0]+t.speed[0],i[1]+t.speed[1]]),t.viewer.render()}var t=this;e()}},{key:"stop",value:function(){cancelAnimationFrame(this.animationId)}},{key:"getId",value:function(){return t.send(e,"bf_c_flow_id"),this.id}}]),i}();i.FlowEffect=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Animation"),t=function e(){_classCallCheck(this,e),this.id=Glodon.Web.Lang.Utility.UUID.createUUID(),this.material=null,this.speed=[0,0],this.viewer=null};e.FlowEffectConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),i=function(){function t(e){_classCallCheck(this,t),this.svgContainer=e,this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line"),i=t.cloneNode();i.style.strokeWidth=1,i.style.stroke="#ffffff",i.style.opacity=.5,this.svgContainer.appendChild(i),this.lineLeft=i;var n=t.cloneNode();n.style.strokeWidth=1,n.style.stroke="#ffffff",n.style.opacity=.5,this.svgContainer.appendChild(n),this.lineRight=n}},{key:"updateBorderLeft",value:function(e,t){var i=new THREE.Vector2(e.x,e.y),n=new THREE.Vector2(t.x,t.y);e.y==t.y?(i.y-=2,n.y-=2):(i.x-=2,n.x-=2),this.moveLineTo(this.lineLeft,i,n)}},{key:"updateBorderRight",value:function(e,t){var i=new THREE.Vector2(e.x,e.y),n=new THREE.Vector2(t.x,t.y);e.y==t.y?(i.y+=2,n.y+=2):(i.x+=2,n.x+=2),this.moveLineTo(this.lineRight,i,n)}},{key:"hide",value:function(){this.lineLeft.style.display="none",this.lineRight.style.display="none",this.visibility=!1}},{key:"show",value:function(){this.lineLeft.style.display="block",this.lineRight.style.display="block",this.visibility=!0}},{key:"update",value:function(e,t){0!=this.visibility&&(this.updateBorderLeft(e,t),this.updateBorderRight(e,t))}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}}]),t}();t.HighlightBorderLines=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),i=function(){function t(e,i){_classCallCheck(this,t),this.svgContainer=e,this.viewer=i,this.borderline=new Glodon.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line");t.style.strokeWidth=2,t.style.stroke="#32D5A7",this.svgContainer.appendChild(t),this.line=t}},{key:"hide",value:function(){this.line.style.display="none",this.borderline.hide(),this.visibility=!1}},{key:"show",value:function(){this.line.style.display="block",this.borderline.show(),this.visibility=!0}},{key:"setLine",value:function(e){this.highlightLine=e}},{key:"setHeight",value:function(e){this.axisgridHeight=e}},{key:"update",value:function(){if(0!=this.visibility){var e=this.highlightLine,t=new THREE.Vector3(e[0],e[1],this.axisgridHeight),i=new THREE.Vector3(e[3],e[4],this.axisgridHeight),n=this.worldPointsToClient(t,i);n&&(this.moveLineTo(this.line,n.start,n.end),this.borderline.update(n.start,n.end))}}},{key:"worldPointsToClient",value:function(e,t){var i=this.viewer.getDomElement(),n=i.getBoundingClientRect(),o=this.viewer.getViewer(),a=o.worldPointsToClient(e,t);return a&&(a.start.x-=n.left,a.start.y-=n.top,a.end.x-=n.left,a.end.y-=n.top),a}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}}]),t}();t.HighlightLine=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),i=function(){function t(e,i){_classCallCheck(this,t),this.svgContainer=e,this.viewer=i,this.horizBorderline=new Glodon.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.verticalBorderline=new Glodon.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line"),i=t.cloneNode();i.style.strokeWidth=2,i.style.stroke="#32D5A7",this.svgContainer.appendChild(i),this.svgHorizLine=i;var n=t.cloneNode();n.style.strokeWidth=2,n.style.stroke="#32D5A7",this.svgContainer.appendChild(n),this.svgVerticalLine=n;var o=e.createNS("circle","bf-axisgrid-point");o.setAttribute("r",3),o.setAttribute("fill","#32D5A7"),this.svgContainer.appendChild(o),this.hoverPoint=o}},{key:"setLine",value:function(e,t){this.horizLine=e,this.verticalLine=t}},{key:"setPoint",value:function(e){this.intersectPoint=e}},{key:"setHeight",value:function(e){this.axisgridHeight=e}},{key:"update",value:function(){if(0!=this.visibility){var e=this.horizLine,t=this.verticalLine,i=this.viewer.worldToClient(this.intersectPoint),n=new THREE.Vector3(e[0],e[1],this.axisgridHeight),o=new THREE.Vector3(e[3],e[4],this.axisgridHeight),a=new THREE.Vector3(t[0],t[1],this.axisgridHeight),r=new THREE.Vector3(t[3],t[4],this.axisgridHeight),s=this.worldPointsToClient(n,o);s&&(this.moveLineTo(this.svgHorizLine,s.start,s.end),this.horizBorderline.update(s.start,s.end));var l=this.worldPointsToClient(a,r);l&&(this.moveLineTo(this.svgVerticalLine,l.start,l.end),this.verticalBorderline.update(l.start,l.end)),this.movePointTo(this.hoverPoint,i.x,i.y)}}},{key:"worldPointsToClient",value:function(e,t){var i=this.viewer.getDomElement(),n=i.getBoundingClientRect(),o=this.viewer.getViewer(),a=o.worldPointsToClient(e,t);return a&&(a.start.x-=n.left,a.start.y-=n.top,a.end.x-=n.left,a.end.y-=n.top),a}},{key:"hide",value:function(){this.svgHorizLine.style.display="none",this.svgVerticalLine.style.display="none",this.hoverPoint.style.display="none",this.horizBorderline.hide(),this.verticalBorderline.hide(),this.visibility=!1}},{key:"show",value:function(){this.svgHorizLine.style.display="block",this.svgVerticalLine.style.display="block",this.hoverPoint.style.display="block",this.horizBorderline.show(),this.verticalBorderline.show(),this.visibility=!0}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}},{key:"movePointTo",value:function(e,t,i){e.setAttribute("cx",t),e.setAttribute("cy",i)}}]),t}();t.HighlightIntersectLines=i}(),function(){var e="Bimface.Plugins.AxisGrid",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),o=function(){function n(o){_classCallCheck(this,n),t.send(e,"AxisGridManager"),this.snapMinDistance=5,this.viewer=o.viewer,this.registerEvent(),this.domContainer=i.create("div","bf-axisgrid-conext"),this.domContainer.style.position="absolute",this.domContainer.style.left=0,this.domContainer.style.top=0,this.domContainer.style.width="100%",this.domContainer.style.height="100%",this.svgContainer=i.createNS("svg","bf-axisgrid-svg"),this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.domContainer.appendChild(this.svgContainer),this.viewer.getDomElement().appendChild(this.domContainer);var a=Glodon.Bimface.Plugins.AxisGrid;this.highlightLine=new a.HighlightLine(this.svgContainer,this.viewer),this.highlightIntersectLines=new a.HighlightIntersectLines(this.svgContainer,this.viewer)}return _createClass(n,[{key:"registerEvent",value:function(){var e=Glodon.Bimface.Viewer.Viewer3DEvent,t=this,i=this.viewer.getEventManager(),n=null,o={component:"Component",room:"Room",axisGrids:"AxisGrids"};this.viewer.addEventListener(e.AxisGridHover,function(a){var r=a.snap.point,s=a.snap.height,l=a.snap.snapLines,c=a.snap.nearestPoint,u=l.intersectLines,d=l.gridLine,h=t.viewer.worldToClient(r),f=t.viewer.worldToClient(c.toGridLine),g=t.viewer.worldToClient(c.toIntersection),p=t.distance(h,f),v=t.distance(h,g),m=null;if(v<=t.snapMinDistance&&void 0!==u){t.highlightIntersectLines.show(),t.highlightLine.hide();var y=u[0],w=u[1];m=y.name+"-"+w.name,t.highlightIntersectLines.setHeight(s),t.highlightIntersectLines.setLine(y,w),t.highlightIntersectLines.setPoint(c.toIntersection),t.highlightIntersectLines.update()}else p<=t.snapMinDistance?(m=d.name,t.highlightLine.show(),t.highlightIntersectLines.hide(),t.highlightLine.setHeight(s),t.highlightLine.setLine(d),t.highlightLine.update(s)):(n=null,t.highlightLine.hide(),t.highlightIntersectLines.hide());n!=m&&(v<=t.snapMinDistance||p<=t.snapMinDistance)&&(i.fireEvent(e.Hover,{objectType:o.axisGrids,objectId:m,worldPostion:r}),n=m)}),this.viewer.addEventListener(e.Rendered,function(){t.highlightLine.update(),t.highlightIntersectLines.update()})}},{key:"distance",value:function(e,t){var i=e.x-t.x,n=e.y-t.y,o=e.z-t.z;return Math.sqrt(i*i+n*n+o*o)}}]),n}();n.AxisGridManager=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),t=function(){return{viewer:null}};e.AxisGridManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Snap"),t=function(){return{id:null,color:new Glodon.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon.Web.Graphics.Color(17,218,183,.2),objectColor:new Glodon.Web.Graphics.Color(17,218,183,.9),width:3,radius:25,viewer:null}};e.SnapConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Snap"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(e){this.viewer=e.viewer,this.maxPointsNum=1;var i=new Glodon.Web.Graphics.Color(17,218,183,.2),n=t.createNS("circle","bf-snap-handle");n.setAttribute("r",e.width),n.setAttribute("fill",i.getRGB()),n.style.fill=i.getRGB();var o=t.createNS("line","bf-snap-line");o.style.strokeWidth=2,o.style.stroke=i.getRGB();var a=t.createNS("polygon","bf-snap-rect");a.setAttribute("fill",i.getRGBA()),a.setAttribute("stroke",i.getRGB()),a.setAttribute("stroke-width",1),this.hoverLine=o,this.hoverPoint=n,this.hoverPanel=a,this.hoverPanelSize={width:20,height:20}},n={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.hoverLine,i=this.hoverPoint,n=this.hoverPanel,o=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":i.setAttribute("cx",e.hoverPosition.x),i.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(i);break;case"Line":t.setAttribute("x1",e.lineStartPoint.x),t.setAttribute("y1",e.lineStartPoint.y),t.setAttribute("x2",e.lineEndPoint.x),t.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(t);break;case"Panel":var a=e.clientPts,r=a[0].distanceTo(a[1]),s=a[0].distanceTo(a[3]),l=r/o.width,c=s/o.height;if(1!=l){var u=this.stretchOnDirection(a[0],a[1],o.width),d=this.stretchOnDirection(a[2],a[3],o.width);a=u.concat(d)}if(1!=c){var u=this.stretchOnDirection(a[0],a[3],o.height),d=this.stretchOnDirection(a[1],a[2],o.height);a=[u[0],d[0],d[1],u[1]]}for(var h="",f=0;f<a.length;f++)h+=a[f].x+",",h+=a[f].y+" ";n.setAttribute("points",h),e.svg.appendChild(n)}}};i.prototype=Object.assign(i.prototype,n),e.SnapItem=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Snap"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=null,n=[],o=null,a=null,r=function(e){var i=e.viewer,n=this;n.isOpen=!1;var o=new Glodon.Web.Lang.EventManager,a=t.create("div","bf-snap-conext");this.context={rootDomElement:a},this._opt=e,this.getEventManager=function(){return o},n.init(e),i.addEventListener("Rendered",function(){n.isOpen&&n.update()})};r.prototype={init:function(e){var i=this,n=i.context,o=i._opt.viewer;o.getViewer();i.isOpen=!0,o.getDomElement().appendChild(n.rootDomElement),o.setSelectedComponentsById();var a=(o.getDomElement(),t.createNS("svg","bf-snap-svg"));n.rootDomElement.innerHTML="",n.rootDomElement.appendChild(a),n.svg=a;var r=new Glodon.Bimface.Plugins.Snap.SnapItem(e);i.snapItem=r,o.render()},snapByPoint:function(e){var t=this;e&&(i=e.pickPoint?e.pickPoint:null,e.pickPlane?(o="Panel",a=e.normal):e.pickLine?(o="Line",n=e.pickLine):o=e.pickPoint?"Point":null,t.update())},update:function(){var e=this.context,t=this._opt.viewer,r=t.getDomElement(),s=r.getBoundingClientRect(),l=t.getViewer(),c=[],u=[];if(this.context.svg.innerHTML="",i?(e.hoverPosition=t.worldToClient(i),e.hoverPositionDS=l.getScene().worldToDrawing(i)):e.hoverPosition=null,e.hoverObjectType=o,"Line"==o&&2==n.length){e.lineStartPoint=t.worldToClient(n[0]),e.lineEndPoint=t.worldToClient(n[1]);var d=new THREE.Vector2(e.lineStartPoint.x,e.lineStartPoint.y),h=new THREE.Vector2(e.lineEndPoint.x,e.lineEndPoint.y),f=new THREE.Box2;f.min.set(r.clientLeft,r.clientTop),f.max.set(f.min.x+r.clientWidth,f.min.y+r.clientHeight);var g=!f.containsPoint(d),p=!f.containsPoint(h),v={start:d,end:h},m=CLOUD.CameraUtil.lineIntersectWithRect(v,f);if(g&&p)2==m.length&&(e.lineStartPoint=m[0],e.lineEndPoint=m[1]);else if(g||p)for(var y=new THREE.Vector2(e.hoverPosition.x,e.hoverPosition.y),w=g?h.clone():d.clone(),b=w.clone().sub(y).normalize(),C=0;C<m.length;C++){var x=w.clone().sub(m[C]).normalize();if(x.dot(b)>0){e.lineStartPoint=w,e.lineEndPoint=m[C];break}}}if("Panel"==e.hoverObjectType){e.normal=l.getScene().worldToDrawing(a),e.normal.normalize();var P=l.cameraControl,k=new THREE.Plane;k.setFromNormalAndCoplanarPoint(e.normal,e.hoverPositionDS);var M=new THREE.Vector2(e.hoverPosition.x-10,e.hoverPosition.y-10),I=new THREE.Vector2(e.hoverPosition.x+10,e.hoverPosition.y-10),E=e.hoverPositionDS,A=P.getRaycaster(M.x,M.y),d=A.ray.intersectPlane(k);A=P.getRaycaster(I.x,I.y);var h=A.ray.intersectPlane(k);if(null==d||null==h)return;var S=new THREE.Vector3(1,0,0),B=new THREE.Vector3(0,1,0),_=new THREE.Vector3(0,0,1),D=Math.abs(e.normal.clone().dot(S))<=.0025,L=Math.abs(e.normal.clone().dot(_))<=.0025;if(D&&L)var G=S.clone(),T=_.clone();else var N=B.clone(),G=N.cross(e.normal).normalize(),T=e.normal.clone().cross(G).normalize();var O=d.distanceTo(h)/2,W=G.clone().multiplyScalar(O),U=T.clone().multiplyScalar(O),V=E.clone().sub(W).add(U),H=E.clone().add(W).add(U),R=E.clone().sub(W).sub(U),z=E.clone().add(W).sub(U),F=[];F.push(V,H,z,R);for(var j=[],X=P.getContainerDimensions(),Y=0;Y<F.length;Y++){var Z=CLOUD.CameraUtil.drawingToCanvas(P.camera,F[Y],X.width,X.height);j.push(new THREE.Vector3(Z.x,Z.y,0))}e.clientPts=j}for(var C=0;C<c.length-1;C++){var q=l.worldPointsToClient(c[C],c[C+1]);if(q){var J={x:q.start.x-s.left,y:q.start.y-s.top};u.push(J)}}e.clientPoints=u,this.snapItem.draw(e)},reset:function(){this.context.svg.innerHTML=""},destroy:function(){var e=this.context.rootDomElement,t=this;t.reset(),e.remove(),t.snapItem=null,t.isOpen=!1}},e.Snap=r}(),function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)}([function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return o(e,[{key:"init",value:function(e){this.notify("enter")}},{key:"redraw",value:function(e){e.updateOverlays()}},{key:"onDrawing",value:function(e,t){}},{key:"begin",value:function(e,t,i,n){}},{key:"end",value:function(e,t,i,n){}},{key:"onKeyDown",value:function(e,t){this.keyDown&&this.keyDown(e,t)}},{key:"onKeyUp",value:function(e,t){this.keyUp&&this.keyUp(e,t)}},{key:"onDoubleClick",value:function(e,t){}},{key:"onMouseWheel",value:function(e,t){var i=t.deltaY||-t.wheelDelta||t.detail,n=Math.abs(e.ratio-1),o=n+1,a=1/o;e.zoomPan(i<0?o:a,t.offsetX,t.offsetY)}},{key:"onMouseMove",value:function(e,t){var i=this.formatEventOffset(e,t);this.isPanMode(t.buttons)&&e.panTo(i.x,i.y),this.onEditing(e,i.x,i.y,t.buttons)}},{key:"onMouseDown",value:function(e,t){var i=this.formatEventOffset(e,t);e.setStartPoint(i.x,i.y),this.begin(e,i.x,i.y,t.buttons)}},{key:"onMouseUp",value:function(e,t){var i=this.formatEventOffset(e,t);return this.end(e,i.x,i.y,t.buttons)}},{key:"onEditing",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.notify("exit")}},{key:"formatEventOffset",value:function(e,t){var i=t.offsetX,n=t.offsetY;if("CANVAS"!=t.target.tagName.toLocaleUpperCase()){var o=e.dom.getBoundingClientRect();i=t.clientX-o.x,n=t.clientY-o.y}return{x:i,y:n}}},{key:"notify",value:function(e,t,i,n,o){this.observer&&this.observer(this.name,e,t,i,n,o)}},{key:"isPanMode",value:function(t){return t==e.MiddleButton||t==e.RightButton}}]),e}();a.CONTINUE=0,a.FINISHED=1,a.LelftButton=1,a.RightButton=2,a.MiddleButton=4,a.MouseMode=1,a.TouchMode=2,t.default=a},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return o(e,null,[{key:"distance",value:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}},{key:"center",value:function(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}},{key:"centerByArr",value:function(e,t){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}},{key:"distanceByArr",value:function(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)}},{key:"normalize",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}},{key:"isPointInBBox",value:function(e,t,i,n){var o=.5*n[0];if(e<i[0]-o||e>i[0]+o)return!1;var a=.5*n[1];return!(t<i[1]-a||t>i[1]+a)}}]),e}();t.default=a},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(14),s=n(r),l=i(5),c=n(l),u=i(7),d=n(u),h=i(8),f=n(h),g=function(){function e(t,i,n,a){o(this,e);var r=document.getElementById(a);this.width=r.clientWidth,this.height=r.clientHeight,this.viewer=Module.createViewer(a,this.width,this.height),this.divId=a,this.dom=r,this.dc=s.default.create(t,i,n),this.ratio=1.1,this.drawHandle=null,this.scale=1,this.snapDistance=5,this.hover=!0,this.bindRendering=this.rendering.bind(this),this.markerManager=new c.default,this.customManager=new d.default,this.onViewChanges=function(){};var l=this;this.dc.overlayDrawers.marker=function(e){l.markerManager.draw(l,e)},this.dc.overlayDrawers.custom=function(e){l.customManager.draw(l,e)},this.sendHighlightMsg=!0}return a(e,[{key:"setZoomRatio",value:function(e){this.ratio=e}},{key:"getZoomRatio",value:function(){return this.ratio}},{key:"getViewScale",value:function(e){return this.scale}},{key:"setViewScale",value:function(e){this.scale=e}},{key:"setSnapDistance",value:function(e){this.snapDistance=e}},{key:"snapshot",value:function(e){var t=this.dc.canvasMain,i=this.dc.canvasOverlay,n=this.getDivId(),o=document.getElementById(n),a=document.createElement("canvas");a.width=o.clientWidth,a.height=o.clientHeight;var r=a.getContext("2d");return r.beginPath(),r.fillStyle=e||t.style.background,r.fillRect(0,0,a.width,a.height),r.drawImage(t,0,0),r.drawImage(i,0,0),a.toDataURL()}},{key:"snapshotPure",value:function(){var e=this.dc.canvasMain,t=this.dc.canvasOverlay,i=this.getDivId(),n=document.getElementById(i),o=document.createElement("canvas");o.width=n.clientWidth,o.height=n.clientHeight;var a=o.getContext("2d");return a.beginPath(),a.drawImage(e,0,0),a.drawImage(t,0,0),o}},{key:"setBackgroundColor",value:function(e){this.dc.setBackgroundColor(e)}},{key:"showFilledFace",value:function(e){this.viewer.FilledFace=e}},{key:"isShowFilledFace",value:function(){return this.viewer.FilledFace}},{key:"setModel",value:function(e){if(this.viewer.SetModel(e),this.dc.setResourceUrl(e.Url),this.viewer.UpdateVisibleSettings(),void 0!=e.indexJson.sealImages){var t;for(t=0;t<e.indexJson.sealImages.length;++t){var i=e.indexJson.sealImages[t],n=i.path,o=n.split("\\"),a=o[o.length-1];this.viewer.AddSealImage(a,parseFloat(i.x),parseFloat(i.y),parseFloat(i.width),parseFloat(i.height))}}}},{key:"rendering",value:function(){this.viewer.Draw(this.dc)>0?this.rendering():(this.updateOverlays(),requestAnimationFrame(this.bindRendering))}},{key:"getDivId",value:function(){return this.divId}},{key:"getModel",value:function(){return this.viewer.GetModel()}},{key:"getViewAngle",value:function(){return this.viewer.ViewAngle}},{key:"setViewAngle",value:function(e){this.viewer.ViewAngle=e,this.update()}},{key:"getLayers",value:function(){for(var e=[],t=this.getModel(),i=t.GetLayerIds(),n=0,o=i.size();n<o;++n){var a=i.get(n),r=t.GetLayer(a);null!=r?e.push({id:r.Id,name:r.Name,color:r.Color,visible:r.Visible}):console.log("Layer not found!"+a)}return e}},{key:"changeLayers",value:function(e){for(var t=this.getModel(),i=0;i<e.length;++i){var n=e[i];t.GetLayer(n.id).Visible=n.visible}this.viewer.UpdateVisibleSettings()}},{key:"getLayouts",value:function(){var e=[],t=this.getModel(),i=t.GetLayoutIds();e.push({id:0,name:"Model"});for(var n=0,o=i.size();n<o;++n){var a=i.get(n),r=t.GetLayout(a);e.push({id:r.Id,name:r.Name})}return e}},{key:"activeLayoutById",value:function(e){this.viewer.ActiveLayout(e),this.update()}},{key:"getActiveLayoutId",value:function(){return this.viewer.GetActiveLayoutId()}},{key:"isModelView",value:function(){return 0==this.getActiveLayoutId()}},{key:"updateOverlays",value:function(){this.dc.drawingOverlay(this.width,this.height)}},{key:"update",value:function(e){function t(){i.viewer.Draw(i.dc)>0?i.drawHandle=requestAnimationFrame(t):(i.drawHandle=null,i.updateOverlays())}1==e&&(this.viewer.RequstDraw(Module.EnumRedrawHints.FinialDraw),this.onViewChanges());var i=this;null!==i.drawHandle&&cancelAnimationFrame(i.drawHandle),this.minimap&&this.minimap.update(),i.drawHandle=requestAnimationFrame(t)}},{key:"onResize",value:function(){this.resize(this.dom.clientWidth,this.dom.clientHeight)}},{key:"clearAll",value:function(){this.dc.clearAll(this.width,this.height)}},{key:"resize",value:function(e,t){this.width=e||this.dom.clientWidth,this.height=t||this.dom.clientHeight,this.dc.resize(e,t),this.viewer.Resize(e,t),this.update(),this.onViewChanges()}},{key:"zoomToExtent",value:function(e){void 0==e&&(e=1),this.viewer.ZoomToExtent(e),this.onViewChanges()}},{key:"zoomToObject",value:function(e,t){void 0==t&&(t=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),this.viewer.ZoomToElement(e,t),this.onViewChanges()}},{key:"zoomToObjectWithBlock",value:function(e,t,i){void 0==i&&(i=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this.viewer.ZoomToElementWithBlock(e,t,i),this.onViewChanges()}},{key:"setStartPoint",value:function(e,t){this.startX=e,this.startY=t}},{key:"zoom",value:function(e,t,i,n){this.viewer.ZoomToRect(e,t,i,n),this.update(!0),this.onViewChanges()}},{key:"panTo",value:function(e,t){return this.startX&&this.startY?(this.offsetX=e-this.startX,this.offsetY=t-this.startY,(0!=this.offsetX||0!=this.offsetY)&&(this.viewer.Pan(this.offsetX,this.offsetY),this.update(),this.startX=e,this.startY=t,this.onViewChanges(),!0)):(this.startX=e,this.startY=t,!1)}},{key:"zoomPan",value:function(e,t,i){this.offsetX=(t||this.width/2)-this.width/2,this.offsetY=(i||this.height/2)-this.height/2,this.viewer.ZoomPan(e,this.offsetX,this.offsetY),this.update(),this.onViewChanges()}},{key:"preSelect",value:function(e,t,i){return i?this.viewer.PreSelect(this.startX,this.startY,e,t):this.viewer.PreSelect(e,t,e,t)}},{key:"select",value:function(){this.viewer.Select()}},{key:"getSelectedIds",value:function(){for(var e=[],t=this.viewer.GetSelection(),i=0,n=t.size();i<n;++i)e.push(t.get(i));return e}},{key:"getHighlightIds",value:function(){for(var e=[],t=this.viewer.GetHighlightIds(),i=0,n=t.size();i<n;++i)e.push(t.get(i));return e}},{key:"clearSelection",value:function(){this.viewer.ClearSelection()}},{key:"clearHighlight",value:function(){this.viewer.ClearHighlight()}},{key:"selectByIds",value:function(e){var t=this.viewer.GetSelection();t.resize(0,0);for(var i=0,n=e.length;i<n;++i)t.push_back(parseInt(e[i]));this.viewer.SelectIds(t)}},{key:"highlightById",value:function(e){this.viewer.HighlightId(parseInt(e))}},{key:"getObjectBoundingBox",value:function(e){var t=this.getModel().FindElement(e);if(t){var i=t.BoundingBox;return[i.GetMinPt(),i.GetMaxPt()]}return null}},{key:"enableHover",value:function(e){this.hover=e}},{key:"toWorldPoint",value:function(e){return this.viewer.ToWorldPoint(e)}},{key:"toScreenPoint",value:function(e){return this.viewer.ToScreenPoint(e)}},{key:"toViewportScreenPoint",value:function(e){return this.viewer.ToViewportScreenPoint(e)}},{key:"toModelWorld",value:function(e){return this.viewer.ToModelWorldPoint(e)}},{key:"snapToPoint",value:function(e,t,i){return void 0==i&&(i=this.snapDistance),this.viewer.SnapToPoint(e,t,i)}},{key:"snapToPoint2",value:function(e,t,i,n,o){return void 0==o&&(o=this.snapDistance),this.viewer.SnapToPoint2(e,t,i,n,o)}},{key:"getZoomFactor",value:function(){var e=this.viewer.GetWorldSize();return this.viewer.WorldScale/Math.min(1/e[0],1/e[1])}},{key:"getState",value:function(){var e={ver:1,WorldScale:this.viewer.WorldScale,ViewAngle:this.viewer.ViewAngle,ViewCenter:this.viewer.ViewCenter,ZoomFactor:this.getZoomFactor()};return JSON.stringify(e)}},{key:"setState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(this.viewer.WorldScale=t.WorldScale,this.viewer.ViewAngle=t.ViewAngle,this.viewer.ViewCenter=t.ViewCenter,this.viewer.UpdateViewMatrix(),!0)}},{key:"getAlignState",value:function(){var e={ver:1,AlignMatrixCol1:this.viewer.GetAlignMatrixCol(0),AlignMatrixCol2:this.viewer.GetAlignMatrixCol(1),AlignMatrixCol3:this.viewer.GetAlignMatrixCol(2),AlignMatrixCol4:this.viewer.GetAlignMatrixCol(3)};return JSON.stringify(e)}},{key:"setAlignState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(void 0!=t.AlignMatrixCol1&&null!=t.AlignMatrixCol1&&(this.viewer.SetAlignMatrixCol(0,t.AlignMatrixCol1),this.viewer.SetAlignMatrixCol(1,t.AlignMatrixCol2),this.viewer.SetAlignMatrixCol(2,t.AlignMatrixCol3),this.viewer.SetAlignMatrixCol(3,t.AlignMatrixCol4)),this.viewer.UpdateViewMatrix(),!0)}},{key:"showElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.ShowElementBox(e)}},{key:"showElementBoxByBBox",value:function(e){e&&this.customManager.add([e[0][0],e[0][1]],[e[1][0],e[1][1]])}},{key:"setElementBoxColor",value:function(e,t,i,n){this.customManager.setColor(e,t,i,n)}},{key:"getElementBoxColor",value:function(){return this.customManager.getColor()}},{key:"getElementBoxStyle",value:function(){return this.customManager.getStyle()}},{key:"setElementBoxStyle",value:function(e){this.customManager.setStyle(e)}},{key:"hideElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.HideElementBox(e)}},{key:"clearElementBox",value:function(){this.viewer.ClearElementBox(),this.customManager.clear()}},{key:"getVisibleBoxIds",value:function(){for(var e=[],t=this.viewer.GetVisibleBoxIds(),i=0;i<t.size();++i)e.push(t.get(i));return e}},{key:"enableHighlightEvent",value:function(e){this.sendHighlightMsg=e}},{key:"isHighlightEventEnabled",value:function(){return this.sendHighlightMsg}},{key:"addClickCallback",value:function(e){this.clickCallback=e}},{key:"getClickCallback",value:function(){return this.clickCallback}},{key:"getModelBBox",value:function(){return this.viewer.GetModelBBox()}},{key:"enableSelectInBlock",value:function(){this.viewer.EnableSelectInBlock()}},{key:"disableSelectInBlock",value:function(){this.viewer.DisableSelectInBlock()}},{key:"canSelectInBlock",value:function(){return this.viewer.CanSelectInBlock()}},{key:"getSelectionWithBlock",value:function(){return this.viewer.GetSelectionWithBlock()}},{key:"GetHighlightIdsWithBlock",value:function(){return this.viewer.GetHighlightIdsWithBlock()}},{key:"highlightIdWithBlock",value:function(e,t){this.viewer.HighlightIdWithBlock(e,t)}},{key:"selectIdWithBlock",value:function(e,t){this.viewer.SelectIdWithBlock(e,t)}},{key:"createMinimap",value:function(e,t,i,n){if(0==this.isModelView())return void console.warn("Only model view support minimap.");void 0==this.minimap&&(this.minimap=new f.default(e,t,i,n),this.minimap.setDrawingImpl(this),this.minimap.initialize())}},{key:"enableMinimap",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.enableMiniMap(e)}},{key:"setMinimapBoundingBox",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.setDrawingContentsBbox(e)}},{key:"setMinimapOffset",value:function(e){this.minimap.setOffset(e)}},{key:"hasMinimap",value:function(){
return 0==this.isModelView()?void console.warn("Only model view support minimap."):void 0!=this.minimap}},{key:"setGlobalColor",value:function(e){this.dc.customColor=e}},{key:"getGlobalColor",value:function(){return this.dc.customColor}},{key:"setPrintMode",value:function(e){this.dc.setPrintMode(e)}},{key:"zoomToWorldBox",value:function(e,t,i){void 0==i&&(i=1);var n=this.getModelBBox();n.SetMinMax(e,t),this.viewer.ZoomToWorldBox(n,i)}},{key:"alignDrawing",value:function(e,t){this.viewer.AlignDrawing(e,t)}},{key:"getAlignTranslate",value:function(){return this.viewer.GetAlignTranslate()}},{key:"scaleDrawing",value:function(e,t){this.viewer.AlignDrawingWithScale(e,t)}},{key:"getAlignScale",value:function(){return this.viewer.GetAlignScale()}}]),e}();t.default=g},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){n(this,e)};o.Measure={lineWidth:3,color:"#F99D0B",snapColor:"#11DAB7",auxLineDash:[6,4],auxLineWidth:1,auxColorX:"#7CCF21",auxColorY:"#CC021B"},o.Zoom={color:"#00ff00",lineWidth:2},t.default=o},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(0),c=n(l),u=i(3),d=n(u),h=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.step=0,e.tmpPoint=null,e.viewPort=null,e.originPoint=null,e.points=[],e}return r(t,e),s(t,[{key:"drawSnapPoint",value:function(e,t){if(this.drawing2D||(this.drawing2D=e,this.ctx=t),!this.ctx&&(this.ctx=t),null!=this.tmpPoint&&0!=this.tmpPoint.GetID()){this.isFootPoint=!1;var i=void 0,n=this.tmpPoint;if(this.points[0]&&this.step>0){var o=e.toScreenPoint(this.points[0].GetPoint()),a=this.tmpPointScreenPoint;n=e.snapToPoint2(a[0],a[1],o[0],o[1]),i=n.GetSnapTypeName()}else i=this.tmpPoint.GetSnapTypeName();var r=void 0;return r=e.viewer.IsActiveLayoutElement(n.GetID())?e.toScreenPoint(n.GetPoint()):e.toViewportScreenPoint(n.GetPoint()),this.drawTmpPoint(e,t,r,i),!0}return this.finalScreenPoint=null,this.captureFail(this.tmpPointScreenPoint),!1}},{key:"captureFail",value:function(e){}},{key:"drawTmpPoint",value:function(e,t,i,n){e=e||this.drawing2D,t=t||this.ctx,t.strokeStyle=t.fillStyle=d.default.Measure.snapColor,t.beginPath(),"EndPoint"==n?(t.lineWidth=2,t.rect(i[0]-4,i[1]-4,8,8),t.stroke()):"PointOnLine"==n?(t.arc(i[0],i[1],4.5,0,2*Math.PI,!0),t.fill()):"MiddlePoint"==n?(t.lineWidth=2,t.moveTo(i[0],i[1]-4),t.lineTo(i[0]-5,i[1]+4),t.lineTo(i[0]+5,i[1]+4),t.closePath(),t.stroke()):"FootPoint"==n&&(this.points[1]=this.tmpPoint,this.isFootPoint=!0,t.lineWidth=2,t.moveTo(i[0]-6,i[1]-6),t.lineTo(i[0]-6,i[1]+6),t.lineTo(i[0]+6,i[1]+6),t.moveTo(i[0]-6,i[1]-1),t.lineTo(i[0]+1,i[1]-1),t.lineTo(i[0]+1,i[1]+6),t.stroke()),this.finalScreenPoint=i,this.tmpPointScreenPoint=i}},{key:"onDrawing",value:function(e,t){if(this.drawSnapPoint(e,t),this.markPoint){var i=e.toScreenPoint(this.markPoint.slice(0,2));t.beginPath(),t.lineWidth=2,t.strokeStyle=d.default.Measure.color,t.fillStyle=t.strokeStyle,t.moveTo(i[0]-7.5,i[1]),t.lineTo(i[0]+7.5,i[1]),t.moveTo(i[0],i[1]-7.5),t.lineTo(i[0],i[1]+7.5),t.stroke(),t.rect(i[0]-2.5,i[1]-2.5,5,5),t.fill(),this.tmpPointScreenPoint&&(t.save(),t.lineDashOffset=10,t.setLineDash([3,3]),t.globalAlpha=.5,t.strokeStyle="#FF9D0B",t.moveTo(i[0],i[1]),t.lineTo(this.tmpPointScreenPoint[0],this.tmpPointScreenPoint[1]),t.stroke(),t.restore())}}},{key:"begin",value:function(e,t,i,n){1==n&&(this.markPoint?this.markPoint=null:this.finalScreenPoint?this.markPoint=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]]):this.markPoint=e.toModelWorld([t,i]),this.redraw(e))}},{key:"onEditing",value:function(e,t,i,n){this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.redraw(e)}},{key:"end",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.redraw(e)}}]),t}(c.default);t.default=h},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(6),s=n(r),l=i(1),c=n(l),u=i(15),d=n(u),h=function(){function e(){o(this,e),this.markers=[],this.markerType={size:[32,32],iconUrl:"http://bimface.com/images/index_fun_03.png"}}return a(e,[{key:"toString",value:function(){d.default.markers2json(this.markers)}},{key:"fromString",value:function(e){this.markers=d.default.json2markers(e)}},{key:"clear",value:function(){this.markers=[]}},{key:"setMarkerType",value:function(e,t){this.markerType={size:t,iconUrl:e}}},{key:"clear",value:function(){this.markers=[]}},{key:"setMarkerType",value:function(e,t){this.markerType={size:t,iconUrl:e}}},{key:"draw",value:function(e,t){for(var i=this.markers,n=0,o=i.length;n<o;++n)i[n].draw(e,t)}},{key:"add",value:function(e){var t=this.markerType,i=new s.default(e,t.size,t.iconUrl);return this.markers.push(i),i}},{key:"get",value:function(e){return this.markers[e]}},{key:"remove",value:function(e){e<0||this.markers.splice(e,1)}},{key:"hitTest",value:function(e,t,i){for(var n=this.markers,o=n.length-1;o>=0;--o){var a=n[o],r=e.toScreenPoint(a.position);if(c.default.isPointInBBox(t,i,r,a.size))return o}return-1}}]),e}();t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,o){n(this,e),this.position=t,this.size=i,this.iconUrl=o,this.id=""}return o(e,[{key:"draw",value:function(e,t){var i=e.toScreenPoint(this.position),n=this.size;e.dc.DrawImageImpl(t,this.iconUrl,i[0]-n[0]/2,i[1]-n[1]/2,n[0],n[1])}}]),e}();t.default=a},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(16),s=n(r),l=i(17),c=n(l),u=function(){function e(){o(this,e),this.markups=[],this.red=255,this.green=0,this.blue=0,this.alpha=1,this.strokeStyle="rgba(255,0,0,1)",this.lineWidth=3,this.fontSize=14,this.fontFamily="Arial",this.type="Rectangle",this.fillStyle="red",this.enableFillStyle=!1}return a(e,[{key:"add",value:function(e,t){var i=(this.markerType,"Rectangle"==this.type?new s.default(e,t,this.strokeStyle):new c.default(e,t,this.strokeStyle));this.markups.push(i)}},{key:"setColor",value:function(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n,this.strokeStyle="rgba("+e+","+t+","+i+","+n+")"}},{key:"getColor",value:function(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}},{key:"setStyle",value:function(e){this.type=e}},{key:"getStyle",value:function(){return this.type}},{key:"clear",value:function(){this.markups=[]}},{key:"draw",value:function(e,t){for(var i=this.markups,n=0,o=i.length;n<o;++n){var a=i[n];t.strokeStyle=a.strokeStyle,t.lineWidth=a.lineWidth,t.fillStyle=a.fillStyle,a.draw(e,t)}}},{key:"setFillColor",value:function(e){this.enableFillStyle=!0,this.fillStyle=e}},{key:"setFillStyleState",value:function(e){this.enableFillStyle=e}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setFont",value:function(e){this.font=e}},{key:"get",value:function(e){return this.markups[e]}},{key:"remove",value:function(e){e<0||this.markups.splice(e,1)}},{key:"setFontSize",value:function(e){this.fontSize=e}},{key:"getMarkupSize",value:function(e,t){var i=this.getMarkupBbox(e,t);return[Math.abs(i[2]-i[0]),Math.abs(i[3]-i[1])]}},{key:"setFontFamily",value:function(e){this.fontFamily=e}},{key:"translatePos",value:function(e,t,i,n){for(var o=(this.getMarkupCenter(e,t),n[0]-i[0]),a=n[1]-i[1],r=this.markups[t],s=r.getPoints(),l=0;l<s.length;l+=2)s[l]+=o,s[l+1]+=a;r.setPoints(s)}},{key:"hitGrip",value:function(e,t,i){for(var n=this.markups[i],o=n.getGrips(e),a=0;a<o.length;a+=2){var r=[o[a],o[a+1]];if(r=e.toScreenPoint(r),this.isPointInCircle(t,r,8))return 4==o.length?0==a?0:4:a/2}return-1}}]),e}();t.default=u},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(18),r=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,i,o,a){n(this,e),this.width=o||300,this.height=a||240,this.imageUrl=i,this.domContainer=document.getElementById(t),this.xmlns="http://www.w3.org/2000/svg",this.naviAlgorithm=new r.default,this.boundingBox=null,this.drawingImpl=null,this.isEnabled=!0}return o(e,[{key:"initialize",value:function(){this.initMinimapContainer(),this.initImageNode(this.imageUrl),this.initOutline(),this.initSvgRect()}},{key:"initMinimapContainer",value:function(){this.minimapContainer=document.createElementNS(this.xmlns,"svg");var e={width:this.width+"",height:this.height+""};this.setAttribute(this.minimapContainer,e);var t={position:"absolute","z-index":10,right:"10px",bottom:"10px",display:"block",backgroundColor:"#000000",opacity:"0.88"};this.setStyle(this.minimapContainer,t),this.domContainer.appendChild(this.minimapContainer);var i=this;this.minimapContainer.addEventListener("mousedown",function(e){i.bMousedown=!0,e.stopPropagation()}),this.minimapContainer.addEventListener("mouseup",function(e){if(1==i.bMousedown){i.bMousedown=!1,e.stopPropagation();var t={x:e.offsetX,y:e.offsetY},n=i.naviAlgorithm;n.minimapToNormalizedPoint(t,i.getMinimapContentsBbox()),n.normalizedPointToWorld(t,i.getDrawingContentsBbox());var o=i.drawingImpl.toScreenPoint([t.x,t.y]),a=i.drawingImpl.toScreenPoint([i.lastPoint.x,i.lastPoint.y]),r=[a[0]-o[0],a[1]-o[1]];i.drawingImpl.viewer.Pan(r[0],r[1]),i.drawingImpl.update(),i.drawingImpl.onViewChanges()}})}},{key:"setOffset",value:function(e){var t=this.minimapContainer;this.setStyle(t,e)}},{key:"initImageNode",value:function(e){this.svgImage=document.createElementNS(this.xmlns,"image"),this.svgImage.href.baseVal=e;var t={preserveAspectRatio:"xMidYMid meet",width:this.width+"",height:this.height+""};this.setAttribute(this.svgImage,t),this.minimapContainer.appendChild(this.svgImage)}},{key:"initSvgRect",value:function(){this.svgRect=document.createElementNS(this.xmlns,"rect");var e={width:"300",height:"240"};this.setAttribute(this.svgRect,e);var t={position:"absolute",display:"block",fillOpacity:"0.1",fill:"#11DAB7",stroke:"#11DAB7",strokeWidth:"2px"};this.setStyle(this.svgRect,t),this.minimapContainer.appendChild(this.svgRect)}},{key:"initOutline",value:function(){this.outline=document.createElementNS(this.xmlns,"rect");var e={width:"300",height:"240"};this.setAttribute(this.outline,e);var t={position:"absolute",fill:"none",stroke:"#555555",strokeWidth:"1px"};this.setStyle(this.outline,t),this.minimapContainer.appendChild(this.outline)}},{key:"moveTo",value:function(e,t){this.svgRect.setAttribute("transform","translate("+e+","+t+")")}},{key:"resize",value:function(e,t){var i={width:e+"",height:t+""};this.setAttribute(this.svgRect,i)}},{key:"setStyle",value:function(e,t){for(var i in t)e.style[i]=t[i]}},{key:"setAttribute",value:function(e,t){for(var i in t)e.setAttribute(i,t[i])}},{key:"enableMiniMap",value:function(e,t){var i={display:"none"};!0===e&&(i.display="block"),1!=t&&(this.isEnabled=e),this.setStyle(this.minimapContainer,i)}},{key:"setDrawingImpl",value:function(e){this.drawingImpl=e}},{key:"getMinimapContentsBbox",value:function(){var e=this.height,t=this.width;this.contentsRatio<=1?t=e*this.contentsRatio:e=t/this.contentsRatio;var i=(this.width-this.height)/2,n={x:this.width/2,y:this.height/2};return{min:{x:n.x-t/2+i,y:n.y-e/2},max:{x:n.x+t/2-i,y:n.y+e/2}}}},{key:"setDrawingContentsBbox",value:function(e){this.contentsRatio=(e.max.x-e.min.x)/(e.max.y-e.min.y),void 0==this.lastPoint&&(this.lastPoint={x:(e.min.x+e.max.x)/2,y:(e.min.y+e.max.y)/2}),this.boundingBox=e}},{key:"getDrawingContentsBbox",value:function(){return this.boundingBox}},{key:"update",value:function(){if(0==this.drawingImpl.isModelView())return void this.enableMiniMap(!1,!0);this.enableMiniMap(this.isEnabled);var e=this.domContainer.clientWidth,t=this.domContainer.clientHeight,i=this.drawingImpl.toWorldPoint([0,t]),n=this.drawingImpl.toWorldPoint([e,0]);this.lastPoint={x:(n[0]+i[0])/2,y:(n[1]+i[1])/2};var o={x:i[0],y:i[1]},a={x:n[0],y:n[1]},r=this.naviAlgorithm;r.worldToNormalizedPoint(o,this.getDrawingContentsBbox()),r.normalizedPointToMinimap(o,this.getMinimapContentsBbox()),r.worldToNormalizedPoint(a,this.getDrawingContentsBbox()),r.normalizedPointToMinimap(a,this.getMinimapContentsBbox());var s=[(o.x+a.x)/2,(o.y+a.y)/2],l=Math.abs(a.x-o.x),c=Math.abs(a.y-o.y);this.resize(l,c),this.moveTo(s[0]-l/2,s[1]-c/2)}}]),e}();t.default=s},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(2),c=(n(l),i(1)),u=n(c),d=i(0),h=n(d),f=i(10),g=n(f),p=i(25),v=n(p),m=function(e){function t(e){o(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,h.default.TouchMode));return i.rltTopHeight=i.relativeHight(e),i.auxMobileMeasureTool=new v.default(e,i.editors),i}return r(t,e),s(t,[{key:"relativeHight",value:function(e){var t=e.getDivId();return document.getElementById(t).getBoundingClientRect().top}},{key:"__getMobileEvt",value:function(e){for(var e=e.originalEvent||e,t=[],i=null,n=0,o=e.touches.length;n<o;n++)i=e.touches[n],t.push({x:i.pageX,y:i.pageY});return 0==e.touches.length&&(i=e.changedTouches[0],t.push({x:i.pageX,y:i.pageY})),t.length<=1?{isMulti:!1,point:t[0]}:{isMulti:!0,distance:u.default.distance(t[0],t[1]),point:t}}},{key:"onTouchStart",value:function(e){var t=this.__getMobileEvt(e);if(t.isMulti){var i=u.default.center(t.point[0],t.point[1]);this.drawing2D.setStartPoint(i.x,i.y)}else if("measure"==this.getEditorName())this.auxMobileMeasureTool.setEditor(this.getEditor()),t.point.y-=this.rltTopHeight,this.auxMobileMeasureTool.onTouchStart(t);else{this.drawing2D.setStartPoint(t.point.x,t.point.y-this.rltTopHeight);var n=this.getEditor();n.begin(this.drawing2D,t.point.x,t.point.y-this.rltTopHeight,1)}this.startEvent=t}},{key:"onTouchEnd",value:function(e){var t=e.changedTouches;if(1==t.length){if("measure"==this.getEditorName()){var i=this.__getMobileEvt(e);return i.point.y-=this.rltTopHeight,void this.auxMobileMeasureTool.onTouchEnd(i)}var n=this.getEditor();if(n.end(this.drawing2D,t[0].pageX,t[0].pageY-this.rltTopHeight,1)===h.default.FINISHED&&(n.onExit(this.drawing2D),this.editors.pop()),1==e.touches.length){var o=e.touches[0];this.drawing2D.setStartPoint(o.pageX,o.pageY-this.rltTopHeight)}}}},{key:"onTouchMove",value:function(e){var t=this.__getMobileEvt(e);if(t.isMulti){if(!this.startEvent.distance)return;var i=t.distance/this.startEvent.distance;if(1!=i){var n=t.point;this.drawing2D.zoomPan(i,(n[0].x+n[1].x)/2,(n[0].y+n[1].y)/2)}}else if("measure"==this.getEditorName())t.point.y-=this.rltTopHeight,this.auxMobileMeasureTool.onTouchMove(t);else{var o=this.getEditor();o.onEditing(this.drawing2D,t.point.x,t.point.y-this.rltTopHeight,1)}this.startEvent=t}},{key:"bindEvents",value:function(){function e(e){e.preventDefault(),n.onTouchStart(e)}function t(e){e.preventDefault(),n.onTouchEnd(e)}function i(e){e.preventDefault(),n.onTouchMove(e)}var n=this,o=n.getDom();o.addEventListener("touchstart",e,!1),o.addEventListener("touchend",t,!1),o.addEventListener("touchmove",i,!1)}}]),t}(g.default);t.default=m},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(2),s=(n(r),i(0)),l=(n(s),i(19)),c=n(l),u=i(20),d=n(u),h=i(21),f=n(h),g=i(22),p=n(g),v=i(23),m=n(v),y=i(24),w=n(y),b=i(4),C=n(b),x=function(){function e(t,i){o(this,e),this.drawing2D=t,this.id="editor-"+i,this.mode=i,this.editors=[],this.editors.push(new d.default),this.observer=null,e.editorMode=this.mode;var n=this;t.dc.overlayDrawers[this.id]=function(e){for(var i=0;i<n.editors.length;++i)n.editors[i].onDrawing(t,e)}}return a(e,[{key:"destroy",value:function(){delete this.drawing2D.dc.overlayDrawers[this.id],this.drawing2D=null}},{key:"getDom",value:function(){return this.drawing2D.dom}},{key:"getEditor",value:function(){return this.editors[this.editors.length-1]}},{key:"getEditorName",value:function(){return this.getEditor().name}},{key:"activeEditorByName",value:function(e){var t=null;switch(e){case"zoom":t=new c.default;break;case"pick":t=new f.default;break;case"pan":t=new d.default;break;case"measure":t=new p.default;break;case"area-measure":t=new m.default;break;case"marker":t=new w.default;break;case"capture":t=new C.default}if(t.name=e,t.mode=this.mode,t.observer=this.observer,t.init(this.drawing2D),"zoom"==e){var i=this.editors.length;i>0&&this.editors[i-1].name==e||this.editors.push(t)}else this.getEditor().onExit(this.drawing2D),this.editors=[],this.editors.push(t)}},{key:"enableSnap",value:function(e){this.getEditor().enableSnap&&this.getEditor().enableSnap(e)}}]),e}();x.editorMode=-1,t.default=x},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(2),c=(n(l),i(0)),u=n(c),d=i(10),h=n(d),f=function(e){function t(e){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MouseMode))}return r(t,e),s(t,[{key:"onDoubleClick",value:function(e){this.getEditor().onDoubleClick(this.drawing2D,e)}},{key:"onMouseDown",value:function(e){this.getEditor().onMouseDown(this.drawing2D,e);var t=this.drawing2D.getClickCallback();t&&t([e.offsetX,e.offsetY])}},{key:"onMouseUp",value:function(e){var t=this.getEditor();t.onMouseUp(this.drawing2D,e)===u.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"onMouseMove",value:function(e){this.getEditor().onMouseMove(this.drawing2D,e)}},{key:"onMouseWheel",value:function(e){this.getEditor().onMouseWheel(this.drawing2D,e)}},{key:"onKeyDown",value:function(e){var t=this.getEditor();t.onKeyDown(this.drawing2D,e)==u.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"onKeyUp",value:function(e){var t=this.getEditor();t.onKeyUp(this.drawing2D,e)==u.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"bindEvents",value:function(){function e(e){e.preventDefault(),s.onDoubleClick(e)}function t(e){e.preventDefault(),s.onMouseDown(e)}function i(e){s.onMouseMove(e)}function n(e){e.preventDefault(),s.onMouseWheel(e)}function o(e){e.preventDefault(),s.onMouseUp(e)}function a(e){s.onKeyDown(e)}function r(e){s.onKeyUp(e)}var s=this,l=s.getDom();l.addEventListener("dblclick",e,!1),l.addEventListener("mousedown",t,!1),l.addEventListener("mouseup",o,!1),l.addEventListener("mousemove",i,!1),l.addEventListener("mousewheel",n,!1),l.addEventListener("DOMMouseScroll",n,!1),l.oncontextmenu=function(e){e.preventDefault()},document.addEventListener("keydown",a),document.addEventListener("keyup",r)}}]),t}(h.default);t.default=f},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}var o=i(13),a=n(o),r=i(26),s=n(r),l=i(29),c=n(l),u={preRun:[],postRun:[],print:function(e){console.log(e)},printErr:function(e){e=Array.prototype.slice.call(arguments).join(" "),console.log(e)},progress:function(e,t,i){""==e?(console.log("Initialized."),a.default.ready()):console.log(e)},locateFile:function(e){return a.default.sdkUrl+e},setStatus:function(e){if(u.setStatus.last||(u.setStatus.last={time:Date.now(),text:""}),e!==u.setStatus.text){var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);t?u.progress(e,100*parseInt(t[2]),100*parseInt(t[4])):u.progress(e,null,null)}},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),u.setStatus(e?"Preparing... ("+(this.totalDependencies-e+1)+"/"+this.totalDependencies+")":"Complete.")}};u.setStatus("20180528"),a.default.loadModel=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0==i.status){var n=u.LoadCallback.extend("LoadCallback",{OnLoad:function(e){e.indexJson=JSON.parse(i.responseText),t(e)},OnError:function(){t(null)},OnDownloading:function(e){a.default.onLoadProgress(e)}}),o=JSON.parse(i.responseText),r=!0;0!=o.metadata.gz&&"false"!=o.metadata.gz||(r=!1);var s=new n;u.loadModel(e+"/",s,r)}else 404===i.status&&t(null)},i.open("GET",e+"/index.json.gz"),i.send()},a.default.loadGrids=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0==i.status){var e=JSON.parse(i.responseText);t(e)}else 404===i.status&&t(null)},i.open("GET",e+"/grids.json"),i.send()},s.default.loadModel=function(e,t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status||0==n.status){var o=JSON.parse(n.responseText);0!=o.metadata.gz&&o.metadata.gz;var a=0,r=0;void 0!=o.metadata.translate_x&&null!=o.metadata.translate_x&&(a=parseFloat(o.metadata.translate_x)),void 0!=o.metadata.translate_y&&null!=o.metadata.translate_y&&(r=parseFloat(o.metadata.translate_y));var l=document.getElementById(t),c=document.createElement("canvas");c.id=t+"-main-drawing",c.width=l.clientWidth,c.height=l.clientHeight,c.style.position="absolute",l.appendChild(c);var u=BimButterfly({canvas:c});window.Butterfly=u;var d={preserveDrawingBuffer:!0};c.getContext("webgl",d);for(var h=new u.DrawingView("No.1");s.default.drawingIDs.indexOf(h.ptr)>-1;)h=new u.DrawingView("No.1");s.default.drawingIDs.push(h.ptr),h.Create(l.clientWidth,l.clientHeight);var f=new u.LoadReactor;f.OnLoad=function(){0==h.PrepareModel()&&console.error("The model data is not ready!"),h.translateX=a,h.translateY=r,i(h)},f.OnDownloading=function(e){s.default.onLoadProgress(1-e)},f.OnError=function(){console.error("error when parse")},h.url=e,h.Load(e,f)}else 404===n.status&&i(null)},n.open("GET",e+"/index.json.gz"),n.send()},s.default.addModel=function(e,t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status||0==n.status){var o=JSON.parse(n.responseText);0!=o.metadata.gz&&o.metadata.gz;var a=new Butterfly.LoadReactor;a.OnLoad=function(){0==t.viewer.PrepareLastModel()&&console.error("The model data is not ready!"),i()},a.OnDownloading=function(e){s.default.onLoadProgress(1-e)},a.OnError=function(){console.error("error when parse")},t.viewer.Add(e,a)}else 404===n.status&&i(null)},n.open("GET",e+"/index.json.gz"),n.send()},s.default.loadGrids=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0==i.status){var e=JSON.parse(i.responseText);t(e)}else 404===i.status&&t(null)},i.open("GET",e+"/grids.json"),i.send()},window.Module=u,window.Glodon=window.Glodon||{},window.Glodon.Bimface=window.Glodon.Bimface||{},window.Glodon.Bimface.DrawingSheet=a.default,window.Glodon.Bimface.WebglDrawingSheet=s.default,window.Glodon.Bimface.RevitInterop=c.default},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(2),s=n(r),l=i(9),c=n(l),u=i(11),d=n(u),h=function(){function e(){o(this,e)}return a(e,null,[{key:"initialize",value:function(t){void 0!==t&&(e.ready=t);var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",n.src=e.sdkUrl+"/mdvjs.js",i.appendChild(n)}},{key:"ready",value:function(){console.log("Drawing2D engine is ready!")}},{key:"onLoadProgress",value:function(e){console.log(e)}},{key:"loadModel",value:function(e,t){console.log("not implemented!")}},{key:"createDrawing",value:function(e){var t=document.getElementById(e),i=document.createElement("canvas");i.id=e+"-main-drawing",i.width=t.clientWidth,i.height=t.clientHeight,i.style.position="absolute",t.appendChild(i);var n=document.createElement("canvas");n.id=e+"-aux-drawing",n.width=t.clientWidth,n.height=t.clientHeight,n.style.position="absolute",t.appendChild(n);var o=document.createElement("canvas");return o.id=e+"-ovl-drawing",o.width=t.clientWidth,o.height=t.clientHeight,o.style.position="absolute",t.appendChild(o),new s.default(i,n,o,e)}},{key:"createMouseEditorManager",value:function(e){return new d.default(e)}},{key:"createTouchEditorManager",value:function(e){return new c.default(e)}}]),e}();h.sdkUrl="js/",t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),r=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return o(e,null,[{key:"create",value:function(e,t,i){var n=Module.DeviceContext.extend("DeviceContext",{initialize:function(e,t){this.canvasMain=e,this.canvasTemp=t,this.canvasOverlay=i,this.ctxMain=this.canvasMain.getContext("2d"),this.ctxTemp=this.canvasTemp.getContext("2d"),this.ctxOverlay=this.canvasOverlay.getContext("2d"),this.inPath=!1,this.fontSize=12,this.colorTable={},this.faceColorTable={},this.globalOpacity=null,this.Normal=0,this.White=1,this.Black=2,this.Gray=3,this.Custom=4,this.printMode=this.Normal,this.printColorTable={},this.printFaceColorTable={},this.resUrl="",this.images={},this.ignoreImage=!1,this.targetId=0,this.overlayDrawers={},this.customColor=-1},drawingOverlay:function(e,t){var i=this.ctxOverlay;i.clearRect(0,0,e,t);var n=this.overlayDrawers;for(var o in n)n[o](i)},setBackgroundColor:function(e){this.canvasMain.style.background=e},setPrintMode:function(e){if("Normal"==e)this.printMode=this.Normal;else if("Gray"==e)this.printMode=this.Gray;else if("Black"==e)this.printMode=this.Black;else if("White"==e)this.printMode=this.White;else{if("Custom"!=e)return;this.printMode=this.Custom}},setResourceUrl:function(e){this.resUrl=e},setGlobalOpacity:function(e){this.globalOpacity=e},getGlobalOpacity:function(){return this.globalOpacity},restoreGlobalOpacity:function(){this.globalOpacity=null},getHexColor:function(e){var t=null===this.globalOpacity?1:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printColorTable[e]}return this.colorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.colorTable[e]},getFaceColor:function(e){var t=null===this.globalOpacity?.9:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printFaceColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printFaceColorTable[e]}return this.faceColorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.faceColorTable[e]},resize:function(e,t){this.canvasMain.setAttribute("width",e),this.canvasMain.setAttribute("height",t),this.canvasTemp.setAttribute("width",e),this.canvasTemp.setAttribute("height",t),this.canvasOverlay.setAttribute("width",e),
this.canvasOverlay.setAttribute("height",t)},clearAll:function(e,t){this.ctxMain.clearRect(0,0,e,t),this.ctxTemp.clearRect(0,0,e,t),this.ctxOverlay.clearRect(0,0,e,t)},SetTarget:function(e){0==e?this.ctx=this.ctxMain:(this.ctx=this.ctxTemp,this.ctx.strokeStyle="#ff0000"),this.targetId=e},BeginDraw:function(e,t){this.ctx.clearRect(t[0],t[1],t[2],t[3])},EndDraw:function(e){},BeginPath:function(){this.inPath=!0,this.ctx.beginPath()},EndPath:function(e,t){this.inPath=!1,e&&(this.ctx.fillStyle=this.getFaceColor(t),this.ctx.closePath(),this.ctx.fill()),this.ctx.stroke()},BeginClip:function(e){e&&(this.ctx.save(),this.ctx.clip())},EndClip:function(e){e&&this.ctx.restore()},SetLineColor:function(e){var t=this.getHexColor(e);this.ctx.strokeStyle=t,this.ctx.fillStyle=t},SetLineWidth:function(e){this.ctx.lineWidth=e},SetLineDash:function(e,t){if(0==e)return void this.ctx.setLineDash([]);if(1==e)return void this.ctx.setLineDash([10]);for(var i=[],n=0,o=t.size();n<o;++n)i.push(t.get(n));this.ctx.setLineDash(i)},SetFont:function(e){this.fontSize=e,this.ctx.font=this.fontSize+"px 仿宋"},DrawPoint:function(e,t,i){},DrawLine:function(e,t){if(this.inPath)this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(t[0],t[1]);else{for(var i=this.ctx.getLineDash(),n=0,o=0;o<i.length;++o)n+=i[o];this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])<n*n&&this.ctx.setLineDash([]),this.ctx.lineTo(t[0],t[1]),this.ctx.stroke(),this.ctx.setLineDash(i)}},DrawArc:function(e,t,i,n){this.inPath?this.ctx.arc(e[0],e[1],t,-i,-n,!0):(this.ctx.beginPath(),this.ctx.arc(e[0],e[1],t,-i,-n,!0),this.ctx.stroke())},DrawRec:function(e,t){this.inPath?this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]):(this.ctx.beginPath(),this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]),this.ctx.stroke())},DrawCloudRec:function(e,t,i){var n=e,o=t;i=i||this.ctx,n=[n[0]+18/3.5,n[1]+18/3.5],o=[o[0]-18/3.5,o[1]-18/3.5];var a=o[1]-n[1],r=o[0]-n[0],s=Math.abs(r),l=Math.abs(a),c=parseInt(s/18),u=parseInt(l/18),d=0==c?s:s/c,h=0==u?l:l/u;i.beginPath(),this.drawSide("orientation",d,s,n[0],n[1],i),this.drawSide("orientation",d,s,n[0]+s,n[1]+l,i,!0),this.drawSide("portrait",h,l,n[0]+s,n[1],i),this.drawSide("portrait",h,l,n[0],n[1]+l,i,!0),i.stroke()},drawSide:function(e,t,i,n,o,a,r){var s=0,l=0,c=i/t,u=void 0,d=n,h=o;"orientation"==e?s=t:l=t;for(var f=0;f<c;f++){a.moveTo(n,o),u=r?[n-s,o-l]:[n+s,o+l],s&&Math.abs(u[0]-d)>i?u[0]=r?d-i:d+i:l&&Math.abs(u[1]-h)>i&&(u[1]=r?h-i:h+i);var g=this.getControlPt([n,o],u);a.quadraticCurveTo(g[0],g[1],u[0],u[1]),n=u[0],o=u[1]}},getControlPt:function(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=.4*r.default.distanceByArr(e,t),a=[t[1]-e[1],e[0]-t[0]];return a=r.default.normalize(a),[n[0]+a[0]*o,n[1]+a[1]*o]},DrawPolyline:function(e){var t=e.size();if(!(t<1))if(this.inPath){this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var i=1;i<t;++i)this.pt=e.get(i),this.ctx.lineTo(this.pt[0],this.pt[1])}else{for(var n=this.ctx.getLineDash(),o=0,a=0;a<n.length;++a)o+=n[a];this.ctx.beginPath(),this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var r=1;r<t;++r){var s=(this.pt[0]-e.get(r)[0])*(this.pt[0]-e.get(r)[0])+(this.pt[1]-e.get(r)[1])*(this.pt[1]-e.get(r)[1]);s<o*o?this.ctx.setLineDash([]):this.ctx.setLineDash(n),this.pt=e.get(r),this.ctx.lineTo(this.pt[0],this.pt[1]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.pt[0],this.pt[1])}this.ctx.setLineDash(n)}},DrawText:function(e,t){this.ctx.fillText(e,t[0],t[1])},DrawTextW:function(e,t,i){0!=i?(this.ctx.save(),this.ctx.translate(t[0],t[1]),this.ctx.rotate(i),this.ctx.fillText(e,0,0),this.ctx.restore()):this.ctx.fillText(e,t[0],t[1])},DrawImageImpl:function(e,t,i,n,o,a,r){function s(t,i,n,o,a,r){0==r?e.drawImage(t,i,n,o,a):(e.save(),e.translate(i,n+a),e.rotate(r),e.drawImage(t,0,-a,o,a),e.restore())}var l=this,c=l.images[t];if(l.ignoreImage)return!1;void 0===c?(c=new Image,c.onload=function(){s(c,i,n,o,a,r),l.images[t]=c},c.src=t):s(c,i,n,o,a,r)},DrawImage:function(e,t,i,n,o,a){this.DrawImageImpl(this.ctx,this.resUrl+"image/"+e,t,i,n,o,a)}}),o=new n;return o.initialize(e,t),o}}]),e}();t.default=s},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(6),r=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return o(e,null,[{key:"markers2json",value:function(e){return JSON.stringify(e)}},{key:"json2markers",value:function(e){for(var t=[],i=JSON.parse(e),n=0;n<i.length;n++){var o=i[n],a=o.drawPoints,s=o.size,l=o.iconUrl,c=o.id,u=new r.default(a,s,l,c);t.push(u)}return t}}]),e}();t.default=s},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,o){n(this,e),this.min=t,this.max=i,this.markupType="Rect",this.strokeStyle=o,this.lineWidth=4,this.fontSize=14,this.fontFamily="Arial",this.fillStyle="white",this.id=""}return o(e,[{key:"draw",value:function(e,t){var i=e.toScreenPoint(this.min),n=e.toScreenPoint(this.max),o=n[0]-i[0],a=i[1]-n[1];if(e.dc.ctx)e.dc.ctx.strokeStyle=this.strokeStyle,e.dc.SetLineWidth(this.lineWidth),e.dc.SetLineDash(0),e.dc.DrawRec([i[0]-.5*o,n[1]-.5*a],[n[0]+.5*o,i[1]+.5*a]);else{e.dc.ctxOverlay.strokeStyle=this.strokeStyle,e.dc.ctxOverlay.lineWidth=this.lineWidth;var r=[i[0]-.5*o,n[1]-.5*a],s=[n[0]+.5*o,i[1]+.5*a];this.inPath?e.dc.ctxOverlay.rect(r[0],r[1],s[0]-r[0],s[1]-r[1]):(e.dc.ctxOverlay.beginPath(),e.dc.ctxOverlay.rect(r[0],r[1],s[0]-r[0],s[1]-r[1]),e.dc.ctxOverlay.stroke())}}}]),e}();t.default=a},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,o){n(this,e),this.min=t,this.max=i,this.markupType="CloudRect",this.strokeStyle=o,this.lineWidth=4,this.fontSize=14,this.fontFamily="Arial",this.fillStyle="white",this.id=""}return o(e,[{key:"draw",value:function(e,t){var i=e.toScreenPoint(this.min),n=e.toScreenPoint(this.max),o=n[0]-i[0],a=i[1]-n[1];e.dc.ctx?(e.dc.ctx.strokeStyle=this.strokeStyle,e.dc.SetLineWidth(this.lineWidth),e.dc.SetLineDash(0),e.dc.DrawCloudRec([i[0]-.5*o,n[1]-.5*a],[n[0]+.5*o,i[1]+.5*a])):(e.dc.ctxOverlay.strokeStyle=this.strokeStyle,e.dc.ctxOverlay.lineWidth=this.lineWidth,e.dc.DrawCloudRec([i[0]-.5*o,n[1]-.5*a],[n[0]+.5*o,i[1]+.5*a],e.dc.ctxOverlay))}}]),e}();t.default=a},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return o(e,[{key:"worldToNormalizedPoint",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=(e.x-t.min.x)/i*2-1,e.y=(e.y-t.min.y)/n*2-1,e.y=-e.y}},{key:"normalizedPointToWorld",value:function(e,t){e.y=-e.y;var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=.5*(e.x+1)*i+t.min.x,e.y=.5*(e.y+1)*n+t.min.y}},{key:"normalizedPointToMinimap",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=.5*(e.x+1)*i+t.min.x,e.y=.5*(e.y+1)*n+t.min.y}},{key:"minimapToNormalizedPoint",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=(e.x-t.min.x)/i*2-1,e.y=(e.y-t.min.y)/n*2-1}}]),e}();t.default=a},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(0),c=n(l),u=i(3),d=n(u),h=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.startPt=[0,0],e.endPt=null,e}return r(t,e),s(t,[{key:"onDrawing",value:function(e,t){null!=this.endPt&&(t.strokeStyle=d.default.Zoom.color,t.lineWidth=d.default.Zoom.lineWidth,t.strokeRect(this.startPt[0],this.startPt[1],this.endPt[0]-this.startPt[0],this.endPt[1]-this.startPt[1]))}},{key:"begin",value:function(e,t,i,n){n==c.default.LelftButton&&(this.startPt[0]=t,this.startPt[1]=i,this.starting=!0)}},{key:"onEditing",value:function(e,t,i,n){this.starting&&(this.endPt=[t,i],this.redraw(e))}},{key:"end",value:function(e,t,i,n){return this.starting&&e.zoom(this.startPt[0],this.startPt[1],t,i),this.endPt=null,this.redraw(e),c.default.FINISHED}}]),t}(c.default);t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(0),l=function(e){return e&&e.__esModule?e:{default:e}}(s),c=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),r(t,[{key:"begin",value:function(e,t,i,n){this.isPanMode(n)||(this.start=!0)}},{key:"onEditing",value:function(e,t,i,n){this.start&&e.panTo(t,i)}},{key:"end",value:function(e,t,i,n){1==this.start&&(e.update(!0),this.start=!1)}}]),t}(l.default);t.default=c},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},l=i(4),c=function(e){return e&&e.__esModule?e:{default:e}}(l),u=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.snapIsEnabled=!1,e}return a(t,e),r(t,[{key:"init",value:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.picked=!1,this.preSelectCount=0}},{key:"begin",value:function(e,t,i,n){n==c.default.LelftButton?(this.picked=!0,this.start=!0):n==c.default.MiddleButton&&(this.moving=!0,this.start=!0),this.mode==c.default.TouchMode&&(this.pickMode=!0,e.isHighlightEventEnabled()&&this.notify("highlight",e.getHighlightIds(),t,i))}},{key:"onEditing",value:function(e,t,i,n,o){if(this.mode==c.default.TouchMode)e.panTo(t,i)&&(this.pickMode=!1);else if(this.pickMode=!0,e.hover){var a=e.preSelect(t,i,1===n);if(a==this.preSelectCount&&0==this.preSelectCount||(e.update(),this.preSelectCount=a),e.isHighlightEventEnabled()&&this.notify("highlight",e.getHighlightIds(),t,i,o),this.snapIsEnabled){this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i);var r=e.dc.ctxOverlay;this.redraw(e,r)}}}},{key:"end",value:function(e,t,i,n){!0===this.pickMode&&this.picked&&(this.mode==c.default.TouchMode&&e.preSelect(t,i,!1),e.preSelect(t,i,!1),e.select(),e.update(),this.notify("selection",e.getSelectedIds()),this.pickMode=!1,this.picked=!1),this.start&&(this.start=!1)}},{key:"onMouseMove",value:function(e,t){var i=this.formatEventOffset(e,t);1!=t.ctrlKey&&this.isPanMode(t.buttons)?this.start&&e.panTo(i.x,i.y)&&(this.pickMode=!1):this.onEditing(e,i.x,i.y,t.buttons,t)}},{key:"isPanMode",value:function(e){return 0!=e}},{key:"enableSnap",value:function(e){this.snapIsEnabled=e}}]),t}(c.default);t.default=u},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},c=i(1),u=n(c),d=i(3),h=n(d),f=i(4),g=n(f),p=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.worldPtForOtherDrawing={},e.pressShift=!1,e.parallel=!1,e.viewPortBBox={},e.viewPortBBoxMask={},e}return r(t,e),s(t,[{key:"reset",value:function(){this.step=0,this.points=[],this.needMaskVPId=0}},{key:"captureFail",value:function(e){return!1}},{key:"clearSnapPoint",value:function(){this.finalScreenPoint=null,this.tmpPoint=null}},{key:"needToMaskViewport",value:function(e,t){if(void 0==this.needMaskVPId||0==this.needMaskVPId)return!1;var i=void 0,n=void 0;if(this.viewPortBBoxMask[this.needMaskVPId])i=this.viewPortBBoxMask[this.needMaskVPId].min,n=this.viewPortBBoxMask[this.needMaskVPId].max;else{var o=e.viewer.GetViewportBBox(this.needMaskVPId);i=o.GetMinPt(),n=o.GetMaxPt(),i.splice(2,1),n.splice(2,1),this.viewPortBBoxMask[this.needMaskVPId]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);return t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),!0}},{key:"onDrawing",value:function(e,t){if(this.showMask){var i=void 0,n=void 0;if(this.viewPortBBox[this.viewPort])i=this.viewPortBBox[this.viewPort].min,n=this.viewPortBBox[this.viewPort].max;else{var o=e.viewer.GetViewportBBox(this.viewPort);i=o.GetMinPt(),n=o.GetMaxPt(),i.splice(2,1),n.splice(2,1),this.viewPortBBox[this.viewPort]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(0,0,3e3,3e3),t.globalCompositeOperation="destination-out",t.globalAlpha=1,t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),t.globalCompositeOperation="source-over"}else if(!this.needToMaskViewport(e,t)&&!this.drawSnapPoint(e,t)&&this.points.length>0){t.strokeStyle=h.default.Measure.color,t.lineWidth=h.default.Measure.lineWidth,t.fillStyle=t.strokeStyle,t.beginPath();var s=e.toScreenPoint(this.points[0].GetPoint());t.arc(s[0],s[1],6,0,2*Math.PI,!0),t.fill()}if(0!=this.points.length){if(1==this.points.length){var l=void 0,c=this.points[0].GetPoint();return l=this.points[0].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[0].GetID())?e.toViewportScreenPoint(c):e.toScreenPoint(c),t.fillStyle=h.default.Measure.color,t.beginPath(),t.arc(l[0],l[1],6,0,2*Math.PI,!0),void t.fill()}var u=this.points[0].GetPoint(),d=this.points[1].GetPoint(),f=void 0,g=void 0;if(f=this.points[0].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[0].GetID())?e.toViewportScreenPoint(u):e.toScreenPoint(u),g=this.points[1].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[1].GetID())?e.toViewportScreenPoint(d):e.toScreenPoint(d),this.pressShift){this.originPoint=g;var p=Math.abs(g[0]-f[0]),v=Math.abs(g[1]-f[1]),m=p<10,y=v<10;m||y?(m&&y?p>v?(g=[g[0],f[1]],this.parallel="Y"):(g=[f[0],g[1]],this.parallel="X"):m?(g=[f[0],g[1]],this.parallel="X"):(g=[g[0],f[1]],this.parallel="Y"),this.points[1]=e.snapToPoint(g[0],g[1])):this.parallel=!1}else this.parallel=!1;if(0==this.step){if(f[0]!=g[0]&&f[1]!=g[1]){var w=[f[0],g[1]];t.setLineDash(h.default.Measure.auxLineDash),t.lineWidth=h.default.Measure.auxLineWidth,t.strokeStyle=h.default.Measure.auxColorX,t.beginPath(),t.moveTo(f[0],f[1]),t.lineTo(w[0],w[1]),t.stroke(),t.strokeStyle=h.default.Measure.auxColorY,t.beginPath(),t.moveTo(g[0],g[1]),t.lineTo(w[0],w[1]),t.stroke(),t.setLineDash([])}t.strokeStyle=h.default.Measure.color,t.fillStyle=t.strokeStyle,t.lineWidth=h.default.Measure.lineWidth,t.beginPath(),t.arc(g[0],g[1],6,0,2*Math.PI,!0),t.fill()}t.strokeStyle=h.default.Measure.color,t.lineWidth=h.default.Measure.lineWidth,t.beginPath(),t.moveTo(f[0],f[1]),t.lineTo(g[0],g[1]),t.stroke(),t.fillStyle=t.strokeStyle,t.beginPath(),t.arc(f[0],f[1],6,0,2*Math.PI,!0),t.fill()}}},{key:"begin",value:function(e,t,i,n){if(!this.isPanMode(n)){var o=e.toModelWorld([t,i]);if(this.showMask||this.needMaskVPId>0)return;if(0==this.step&&(this.points=[],this.viewPort=o[2],-1==o[2]?this.firstPointOutsideVP=!0:this.firstPointOutsideVP=!1),this.parallel||(this.finalScreenPoint?(this.points[this.step]=e.snapToPoint(this.finalScreenPoint[0],this.finalScreenPoint[1]),this.worldPtForOtherDrawing[this.step]=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]])):(this.points[this.step]=e.snapToPoint(t,i),this.worldPtForOtherDrawing[this.step]=null)),o[2]!=this.viewPort)return this.points.splice(1,1);if(this.step=this.step+1,this.step>=2){var a=this.points[0].GetPoint(),r=this.points[1].GetPoint(),s=[a,r];if(this.worldPtForOtherDrawing[0])s[0]=this.worldPtForOtherDrawing[0];else if(!this.points[0].GetID()){var l=e.toScreenPoint(a),c=e.toModelWorld(l);c[2]>0&&(s[0]=c)}if(this.worldPtForOtherDrawing[1])s[1]=this.worldPtForOtherDrawing[1];else if(!this.points[1].GetID()){var d=e.toScreenPoint(r),h=e.toModelWorld(d);h[2]>0&&(s[1]=h)}"X"==this.parallel?s[1][0]=s[0][0]:"Y"==this.parallel&&(s[1][1]=s[0][1]);var f=u.default.distanceByArr(s[0],s[1]);this.notify("change",{distance:f,start:s[0],end:s[1]}),this.step=0,this.pressShift=!1,this.parallel=!1,this.viewPort=null}else this.notify("change",null);this.redraw(e)}}},{key:"onEditing",value:function(e,t,i,n){if(this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.step>0){var o=e.toModelWorld([t,i]);this.viewPort&&o[2]!=this.viewPort&&-1!=this.viewPort?this.showMask=!0:this.showMask=!1,this.firstPointOutsideVP&&o[2]>0?this.needMaskVPId=o[2]:this.needMaskVPId=0,this.points[this.step]=this.tmpPoint}this.redraw(e)}},{key:"keyDown",value:function(e,t){this.pressShift||16!=t.keyCode||0==this.step?27==t.keyCode&&this.step>0&&(this.points=[],this.step=0,t.stopImmediatePropagation(),this.redraw(e)):(this.pressShift=!0,this.redraw(e),this.onDrawing(e,this.ctx))}},{key:"keyUp",value:function(e,t){this.pressShift=!1,16==t.keyCode&&0!=this.step&&this.originPoint&&this.onEditing(e,this.originPoint[0],this.originPoint[1])}},{key:"end",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.reset(),this.redraw(e),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onExit",this).call(this,e)}}]),t}(g.default);t.default=p},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},c=i(0),u=n(c),d=i(1),h=(n(d),i(3)),f=n(h),g=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.worldPtForOtherDrawing={},e.tmpPoint=null,e.viewPort=null,e.originPoint=null,e.pressShift=!1,e.parallel=!1,e.closePath=!1,e.points=[],e.viewPort=null,e.viewPortBBox={},e.viewPortBBoxMask={},e}return r(t,e),s(t,[{key:"reset",value:function(){this.points=[],this.needMaskVPId=0}},{key:"captureFail",value:function(e){return!1}},{key:"drawTmpPoint",value:function(e,t,i,n){e=e||this.drawing2D,t=t||this.ctx,t.strokeStyle=t.fillStyle=f.default.Measure.snapColor,t.beginPath(),"EndPoint"==n?(t.lineWidth=2,t.rect(i[0]-4,i[1]-4,8,8),t.stroke()):"PointOnLine"==n?(t.arc(i[0],i[1],4.5,0,2*Math.PI,!0),t.fill()):"MiddlePoint"==n?(t.lineWidth=2,t.moveTo(i[0],i[1]-4),t.lineTo(i[0]-5,i[1]+4),t.lineTo(i[0]+5,i[1]+4),t.closePath(),t.stroke()):"FootPoint"==n&&(this.isFootPoint=!0,t.lineWidth=2,t.moveTo(i[0]-6,i[1]-6),t.lineTo(i[0]-6,i[1]+6),t.lineTo(i[0]+6,i[1]+6),t.moveTo(i[0]-6,i[1]-1),t.lineTo(i[0]+1,i[1]-1),t.lineTo(i[0]+1,i[1]+6),t.stroke()),this.finalScreenPoint=i}},{key:"drawSnapPoint",value:function(e,t){if(!this.ctx&&(this.ctx=t),this.tmpPoint&&0!=this.tmpPoint.GetID()){this.isFootPoint=!1;var i=void 0,n=this.points.length,o=this.tmpPoint;if(n&&!this.closePath){var a=e.toScreenPoint(this.points[n-1].GetPoint()),r=this.tmpPointScreenPoint;o=e.snapToPoint2(r[0],r[1],a[0],a[1]),i=o.GetSnapTypeName()}else i=this.tmpPoint.GetSnapTypeName();var s=void 0;return s=e.viewer.IsActiveLayoutElement(o.GetID())?e.toScreenPoint(o.GetPoint()):e.toViewportScreenPoint(o.GetPoint()),this.drawTmpPoint(e,t,s,i),!0}return this.finalScreenPoint=null,this.captureFail(this.tmpPointScreenPoint,e,t)}},{key:"needToMaskViewport",value:function(e,t){if(void 0==this.needMaskVPId||0==this.needMaskVPId)return!1;var i=void 0,n=void 0;if(this.viewPortBBoxMask[this.needMaskVPId])i=this.viewPortBBoxMask[this.needMaskVPId].min,n=this.viewPortBBoxMask[this.needMaskVPId].max;else{var o=e.viewer.GetViewportBBox(this.needMaskVPId);i=o.GetMinPt(),n=o.GetMaxPt(),i.splice(2,1),n.splice(2,1),this.viewPortBBoxMask[this.needMaskVPId]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);return t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),!0}},{key:"onDrawing",value:function(e,t){if(this.showMask){var i=void 0,n=void 0;if(this.viewPortBBox[this.viewPort])i=this.viewPortBBox[this.viewPort].min,n=this.viewPortBBox[this.viewPort].max;else{var o=e.viewer.GetViewportBBox(this.viewPort);i=o.GetMinPt(),n=o.GetMaxPt(),i.splice(2,1),n.splice(2,1),this.viewPortBBox[this.viewPort]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(0,0,3e3,3e3),t.globalCompositeOperation="destination-out",t.globalAlpha=1,t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),t.globalCompositeOperation="source-over"}else this.needToMaskViewport(e,t)||this.drawSnapPoint(e,t);var s=this.points,l=s.length;if(l>0){if(this.pressShift&&this.tmpPoint){var c=this.points[l-1].GetPoint(),u=this.tmpPoint.GetPoint(),d=void 0,h=void 0;d=this.points[l-1].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[l-1].GetID())?e.toViewportScreenPoint(c):e.toScreenPoint(c),h=this.tmpPoint.GetID()&&!e.viewer.IsActiveLayoutElement(this.tmpPoint.GetID())?e.toViewportScreenPoint(u):e.toScreenPoint(u),this.originPoint=h;var g=Math.abs(h[0]-d[0]),p=Math.abs(h[1]-d[1]),v=g<10,m=p<10;v||m?(this.parallel=!0,h=v&&m?g>p?[h[0],d[1]]:[d[0],h[1]]:v?[d[0],h[1]]:[h[0],d[1]],this.tmpPoint=e.snapToPoint(h[0],h[1])):this.parallel=!1}else this.parallel=!1;t.strokeStyle=f.default.Measure.color,t.lineWidth=f.default.Measure.lineWidth,t.fillStyle=t.strokeStyle;var y=s;!this.closePath&&this.tmpPoint&&(y=s.concat(this.tmpPoint));for(var w=0;w<y.length-1;w++){var b=void 0,C=void 0;b=y[w].GetID()&&!e.viewer.IsActiveLayoutElement(y[w].GetID())?e.toViewportScreenPoint(y[w].GetPoint()):e.toScreenPoint(y[w].GetPoint()),C=y[w+1].GetID()&&!e.viewer.IsActiveLayoutElement(y[w+1].GetID())?e.toViewportScreenPoint(y[w+1].GetPoint()):e.toScreenPoint(y[w+1].GetPoint()),this.closePath?(0==w&&(t.beginPath(),t.moveTo(b[0],b[1])),t.lineTo(C[0],C[1]),w==y.length-2&&(t.closePath(),t.globalAlpha=.2,t.fill(),t.globalAlpha=1,t.stroke())):(t.beginPath(),t.arc(b[0],b[1],5,0,2*Math.PI,!0),t.fill(),t.moveTo(b[0],b[1]),t.lineTo(C[0],C[1]),t.stroke())}}}},{key:"begin",value:function(e,t,i,n){if(!this.isPanMode(n)){var o=e.toModelWorld([t,i]);if(this.showMask||this.needMaskVPId>0)return;if(0==this.points.length&&(this.viewPort=o[2],-1==o[2]?this.firstPointOutsideVP=!0:this.firstPointOutsideVP=!1),this.closePath&&(this.points=[],this.viewPort=o[2],this.closePath=!1),this.finalScreenPoint){var a=e.snapToPoint(this.finalScreenPoint[0],this.finalScreenPoint[1]);this.worldPtForOtherDrawing[this.points.length-1]=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]])}else{var a=e.snapToPoint(t,i);this.worldPtForOtherDrawing[this.points.length-1]=null}if(this.parallel?this.points[this.points.length]=this.tmpPoint:this.points[this.points.length]=a,o[2]!=this.viewPort)return this.points.splice(1,1);var r=this.points,s=r.length,l=r[0].GetPoint(),c=a.GetPoint();if(s>2&&this.isClosePath(e,l,c)){this.closePath=!0,this.pressShift=!1,this.parallel=!1,this.viewPort=null,r.pop();var u=this.getArea(r.slice());this.notify("change",{area:u})}else this.notify("change",null);this.redraw(e)}}},{key:"isClosePath",value:function(e,t,i){var n=e.toScreenPoint(t),o=e.toScreenPoint(i);return Math.abs(n[0]-o[0])<6&&Math.abs(n[1]-o[1])<6}},{key:"getArea",value:function(e){for(var t=e.length,i=0;i<t;i++)e[i]=this.worldPtForOtherDrawing[i]||e[i].GetPoint();if(t<3)return 0;for(var n=e[0][1]*(e[t-1][0]-e[1][0]),i=1;i<t;++i)n+=e[i][1]*(e[i-1][0]-e[(i+1)%t][0]);return Math.abs(n/2)}},{key:"onEditing",value:function(e,t,i,n){if(this.mode!=u.default.TouchMode){this.tmpPointScreenPoint=[t,i];var o=e.toModelWorld([t,i]);this.viewPort&&o[2]!=this.viewPort&&-1!=this.viewPort?this.showMask=!0:this.showMask=!1,this.firstPointOutsideVP&&o[2]>0?this.needMaskVPId=o[2]:this.needMaskVPId=0,this.tmpPoint=e.snapToPoint(t,i),this.redraw(e)}}},{key:"keyDown",value:function(e,t){this.pressShift||16!=t.keyCode?27==t.keyCode&&this.points.length&&!this.closePath&&(this.points.pop(),t.stopImmediatePropagation(),this.redraw(e)):(this.pressShift=!0,this.redraw(e),this.onDrawing(e,this.ctx))}},{key:"keyUp",value:function(e,t){this.pressShift=!1,16==t.keyCode&&this.originPoint&&this.onEditing(e,this.originPoint[0],this.originPoint[1])}},{key:"end",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.reset(),this.redraw(e),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onExit",this).call(this,e)}}]),t}(u.default);t.default=g},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(0),l=function(e){return e&&e.__esModule?e:{default:e}}(s),c=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return a(t,e),r(t,[{key:"onDrawing",value:function(e,t){this.notify("onDrawing",{drawing:e})}},{key:"begin",value:function(e,t,i,n){this.notify("begin",{drawing:e,x:t,y:i,flags:n})}},{key:"end",value:function(e,t,i,n){this.notify("end",{drawing:e,x:t,y:i,flags:n})}},{key:"onEditing",value:function(e,t,i,n){this.notify("onEditing",{drawing:e,x:t,y:i,flags:n})}},{key:"onKeyDown",value:function(e,t){this.notify("onKeyDown",{drawing:e,event:t})}}]),t}(l.default);t.default=c},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),this.drawing2D=t,this.touchEndCounts=0,
this.outerCircleRadius=60,this.outerCircleFillStyle="rgba(255, 255, 255, 0.3)",this.outerCircleBorderWidth=2,this.outerCircleBorderColor="#999999",this.innerCircleRadius=50,this.innerCircleFillStyle="rgba(204, 204, 204, 0.5)",this.innerCircleBorderWidth=2,this.triangleWidth=20,this.triangleFillStyle="rgba(204, 204, 204, 0.5)",this.triangleBorderWidth=2,this.triangleBorderColor="#999999"}return o(e,[{key:"setEditor",value:function(e){this.editor=e}},{key:"updateAuxMeasure",value:function(e){var t={};t.outerCircle={},t.outerCircle.center=e,t.outerCircle.radius=this.outerCircleRadius,t.innerCircle={},t.innerCircle.center=e,t.innerCircle.radius=this.innerCircleRadius,t.triangle=[];var i={x:e.x-this.outerCircleRadius,y:e.y-this.outerCircleRadius};return t.triangle.push({x:i.x,y:i.y}),t.triangle.push({x:i.x+this.triangleWidth,y:i.y}),t.triangle.push({x:i.x,y:i.y+this.triangleWidth}),t}},{key:"draw",value:function(e){var t=this.drawing2D.dc.ctxOverlay,i=e.outerCircle;t.strokeStyle=this.outerCircleBorderColor,t.lineWidth=this.outerCircleBorderWidth,t.fillStyle=this.outerCircleFillStyle,t.beginPath(),t.arc(i.center.x,i.center.y,i.radius,0,2*Math.PI,!0),t.fill(),t.stroke();var n=e.innerCircle;t.fillStyle=this.innerCircleFillStyle,t.beginPath(),t.arc(n.center.x,n.center.y,n.radius,0,2*Math.PI,!0),t.fill();var o=e.triangle;t.lineWidth=this.triangleBorderWidth,t.fillStyle=this.triangleFillStyle,t.beginPath(),t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y),t.closePath(),t.fill(),t.stroke()}},{key:"getRealPoint",value:function(e){var t={x:this.outerCircleRadius,y:this.outerCircleRadius};return{x:e.x-t.x,y:e.y-t.y}}},{key:"onTouchStart",value:function(e,t){var i=this.updateAuxMeasure({x:e.point.x,y:e.point.y});this.draw(i),this.saveAction(e)}},{key:"onTouchMove",value:function(e){var t=this.updateAuxMeasure({x:e.point.x,y:e.point.y}),i=this.editor,n=this.getRealPoint(e.point);i.onEditing(this.drawing2D,n.x,n.y,1),this.draw(t),this.saveAction(e)}},{key:"onTouchEnd",value:function(e,t){var i=this.editor,n=this.getRealPoint(e.point);++this.touchEndCounts%2==1&&this.drawing2D.setStartPoint(n.x,n.y),i.clearSnapPoint(),i.begin(this.drawing2D,n.x,n.y,1),this.touchEndCounts%2==0&&i.end(this.drawing2D,n.x,n.y,1),!t&&i.redraw(this.drawing2D),this.prevActionEvent=null}},{key:"saveAction",value:function(e){this.prevActionEvent=e}},{key:"redraw",value:function(){if(this.prevActionEvent){var e=this.prevActionEvent,t=this.updateAuxMeasure({x:e.point.x,y:e.point.y});this.draw(t)}}}]),e}();t.default=a},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(27),s=n(r),l=i(9),c=n(l),u=i(11),d=n(u),h=function(){function e(){o(this,e)}return a(e,null,[{key:"initialize",value:function(t){void 0!==t&&(e.ready=t);var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",i.appendChild(n)}},{key:"ready",value:function(){console.log("Drawing2D engine is ready!")}},{key:"onLoadProgress",value:function(e){console.log(e)}},{key:"loadModel",value:function(e,t,i){console.log("not implemented!")}},{key:"addModel",value:function(e,t,i){console.log("not implemented!")}},{key:"createDrawing",value:function(e,t){var i=document.getElementById(e),n=document.getElementById(e+"-main-drawing"),o=document.createElement("canvas");o.id=e+"-aux-drawing",o.width=i.clientWidth,o.height=i.clientHeight,o.style.position="absolute",i.appendChild(o);var a=document.createElement("canvas");return a.id=e+"-ovl-drawing",a.width=i.clientWidth,a.height=i.clientHeight,a.style.position="absolute",i.appendChild(a),new s.default(n,o,a,e,t)}},{key:"createMouseEditorManager",value:function(e){return new d.default(e)}},{key:"createTouchEditorManager",value:function(e){var t=new c.default(e);return e.auxMobileMeasureTool=t.auxMobileMeasureTool,t}}]),e}();h.sdkUrl="js/",h.drawingIDs=[],t.default=h},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(28),s=n(r),l=i(5),c=n(l),u=i(7),d=n(u),h=i(8),f=n(h),g=function(){function e(t,i,n,a,r){o(this,e),console.log(r.GetId());var l=document.getElementById(a);this.width=l.clientWidth,this.height=l.clientHeight,this.viewer=r,this.translateX=void 0!=r.translateX?r.translateX:0,this.translateY=void 0!=r.translateY?r.translateY:0,this.divId=a,this.dom=l,this.dc=s.default.create(t,i,n),this.ratio=1.1,this.drawHandle=null,this.scale=1,this.snapDistance=5,this.hover=!0,this.bindRendering=this.rendering.bind(this),this.markerManager=new c.default,this.customManager=new d.default,this.onViewChanges=function(){};var u=this;this.dc.overlayDrawers.marker=function(e){u.markerManager.draw(u,e)},this.dc.overlayDrawers.custom=function(e){u.customManager.draw(u,e)},this.sendHighlightMsg=!0,this.url=void 0!=r.url?r.url:null,this.model={Url:void 0!=r.url?r.url:null}}return a(e,[{key:"getUrl",value:function(){return this.url}},{key:"setUrl",value:function(e){this.url=e}},{key:"setZoomRatio",value:function(e){this.ratio=e}},{key:"getZoomRatio",value:function(){return this.ratio}},{key:"getViewScale",value:function(e){return this.scale}},{key:"setViewScale",value:function(e){this.scale=e}},{key:"setSnapDistance",value:function(e){this.snapDistance=e}},{key:"snapshot",value:function(e){var t=this.dc.canvasMain,i=this.dc.canvasOverlay,n=this.getDivId(),o=document.getElementById(n),a=document.createElement("canvas");a.width=o.clientWidth,a.height=o.clientHeight;var r=a.getContext("2d");return r.beginPath(),r.fillStyle=e||t.style.background,r.fillRect(0,0,a.width,a.height),r.drawImage(t,0,0),r.drawImage(i,0,0),a.toDataURL()}},{key:"snapshotPure",value:function(){var e=this.dc.canvasMain,t=this.dc.canvasOverlay,i=this.getDivId(),n=document.getElementById(i),o=document.createElement("canvas");o.width=n.clientWidth,o.height=n.clientHeight;var a=o.getContext("2d");return a.beginPath(),a.drawImage(e,0,0),a.drawImage(t,0,0),o}},{key:"setBackgroundColor",value:function(e){this.dc.setBackgroundColor(e)}},{key:"showFilledFace",value:function(e){this.viewer.FilledFace=e}},{key:"isShowFilledFace",value:function(){return this.viewer.FilledFace}},{key:"setModel",value:function(e){if(console.error("abondon! DON't use this function"),this.viewer.SetModel(e),this.dc.setResourceUrl(e.Url),this.viewer.UpdateVisibleSettings(),void 0!=e.indexJson.sealImages){var t;for(t=0;t<e.indexJson.sealImages.length;++t){var i=e.indexJson.sealImages[t],n=i.path,o=n.split("\\"),a=o[o.length-1];this.viewer.AddSealImage(a,parseFloat(i.x),parseFloat(i.y),parseFloat(i.width),parseFloat(i.height))}}}},{key:"rendering",value:function(){this.viewer.Draw(),this.rendering(),this.updateOverlays()}},{key:"getDivId",value:function(){return this.divId}},{key:"getModel",value:function(){return console.log("carefully to use getModel()"),this.model}},{key:"getViewAngle",value:function(){return this.viewer.GetViewAngle()}},{key:"setViewAngle",value:function(e){this.viewer.SetViewAngle(e)}},{key:"getLayers",value:function(){for(var e=[],t=this.viewer.GetLayerIds(),i=0,n=t.size();i<n;++i){var o=t.at(i),a=this.viewer.GetLayer(o);null!=a?e.push({id:a.id,name:a.name,color:a.color,visible:a.visible}):console.log("Layer not found!"+o)}return e}},{key:"changeLayers",value:function(e){for(var t=new Butterfly.ObjectIDList,i=new Butterfly.ObjectIDList,n=0;n<e.length;++n){var o=e[n];o.visible?t.push_back(o.id):i.push_back(o.id)}this.viewer.HideByLayerId(i),this.viewer.ShowByLayerId(t)}},{key:"getLayouts",value:function(){for(var e=[],t=this.viewer.GetLayoutIds(),i=this.viewer.GetLayoutNames(),n=0,o=t.size();n<o;++n){var a=t.at(n);e.push({id:a,name:i.at(n)})}return e}},{key:"activeLayoutById",value:function(e){this.viewer.ActiveLayout(e),this.update()}},{key:"getActiveLayoutId",value:function(){return this.viewer.GetActiveLayoutId()}},{key:"isModelView",value:function(){return 0==this.getActiveLayoutId()}},{key:"updateOverlays",value:function(){this.dc.drawingOverlay(this.width,this.height,this)}},{key:"update",value:function(e){function t(){i.viewer.Draw(),i.drawHandle=requestAnimationFrame(t),i.updateOverlays()}1==e&&this.onViewChanges();var i=this;null!==i.drawHandle&&cancelAnimationFrame(i.drawHandle),this.minimap&&this.minimap.update(),i.drawHandle=requestAnimationFrame(t)}},{key:"onResize",value:function(){this.resize(this.dom.clientWidth,this.dom.clientHeight)}},{key:"clearAll",value:function(){this.dc.clearAll(this.width,this.height)}},{key:"resize",value:function(e,t){this.width=e||this.dom.clientWidth,this.height=t||this.dom.clientHeight,this.dc.resize(e,t),this.viewer.Resize(e,t),this.update(),this.onViewChanges()}},{key:"zoomToExtent",value:function(e){void 0==e&&(e=1),this.viewer.ZoomToExtent(e),this.onViewChanges()}},{key:"zoomToObject",value:function(e,t){void 0==t&&(t=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),this.viewer.ZoomToElement(e,t),this.onViewChanges()}},{key:"zoomToObjectWithBlock",value:function(e,t,i){void 0==i&&(i=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this.viewer.ZoomToElementWithBlock(e,t,i),this.onViewChanges()}},{key:"zoomToWorldBox",value:function(e,t,i){void 0==i&&(i=1);var n=new Butterfly.BBox3(new Butterfly.Vector3(e[0],e[1],e[2]),new Butterfly.Vector3(t[0],t[1],t[2]));this.viewer.ZoomToWorldBox(n,i)}},{key:"setStartPoint",value:function(e,t){this.startX=e,this.startY=t}},{key:"zoom",value:function(e,t,i,n){this.viewer.ZoomToRect(e,t,i,n),this.update(!0),this.onViewChanges()}},{key:"panTo",value:function(e,t){return this.startX&&this.startY?(this.offsetX=e-this.startX,this.offsetY=t-this.startY,(0!=this.offsetX||0!=this.offsetY)&&(this.viewer.Pan(this.offsetX,this.offsetY),this.update(),this.startX=e,this.startY=t,this.onViewChanges(),!0)):(this.startX=e,this.startY=t,!1)}},{key:"zoomPan",value:function(e,t,i){this.offsetX=(t||this.width/2)-this.width/2,this.offsetY=(i||this.height/2)-this.height/2,this.viewer.ZoomPan(this.offsetX,this.offsetY,e),this.update(),this.onViewChanges()}},{key:"preSelect",value:function(e,t,i){return i?this.viewer.PreSelect(this.startX,this.startY,e,t):this.viewer.PreSelect(e,t,e,t)}},{key:"select",value:function(){this.viewer.Select()}},{key:"getSelectedIds",value:function(){for(var e=[],t=this.viewer.GetSelection(),i=0,n=t.size();i<n;++i)e.push(t.at(i));return e}},{key:"getHighlightIds",value:function(){for(var e=[],t=this.viewer.GetHighlightIds(),i=0,n=t.size();i<n;++i)e.push(t.at(i));return e}},{key:"clearSelection",value:function(){this.viewer.ClearSelection()}},{key:"clearHighlight",value:function(){this.viewer.ClearHighlight()}},{key:"selectByIds",value:function(e){var t=this.viewer.GetSelection();t.clear();for(var i=0,n=e.length;i<n;++i)t.push_back(parseInt(e[i]));this.viewer.SelectIds(t)}},{key:"highlightById",value:function(e){this.viewer.HighlightId(parseInt(e))}},{key:"getObjectBoundingBox",value:function(e){var t=this.viewer.GetObjectBoundingBox(e),i=t.GetMinPt(),n=t.GetMaxPt();return[[i.x+this.translateX,i.y+this.translateY,i.z],[n.x+this.translateX,n.y+this.translateY,n.z]]}},{key:"enableHover",value:function(e){this.hover=e}},{key:"normalizePt",value:function(e){return e.constructor==Array?void 0==e[2]?{x:e[0],y:e[1]}:{x:e[0],y:e[1],z:e[2]}:void 0!=e.x&&void 0!=e.y?e:null}},{key:"toWorldPoint",value:function(e){var t=this.normalizePt(e),i=this.viewer.ToWorldPoint(new Butterfly.Vector2(t.x,t.y));return[i.x+this.translateX,i.y+this.translateY]}},{key:"toScreenPoint",value:function(e){var t=this.normalizePt(e);t.x=t.x-this.translateX,t.y=t.y-this.translateY;var i=this.viewer.ToScreenPoint(new Butterfly.Vector2(t.x,t.y));return[i.x,i.y]}},{key:"toViewportScreenPoint",value:function(e){var t=this.normalizePt(e);t.x=t.x-this.translateX,t.y=t.y-this.translateY;var i=this.viewer.ToViewportScreenPoint(new Butterfly.Vector2(t.x,t.y));return[i.x,i.y,i.z]}},{key:"toModelWorld",value:function(e){var t=this.normalizePt(e),i=this.viewer.ToModelWorldPoint(new Butterfly.Vector2(t.x,t.y));return[i.x+this.translateX,i.y+this.translateY,i.z]}},{key:"snapToPoint",value:function(e,t,i){void 0==i&&(i=this.snapDistance);var n=this.viewer.SnapToPoint(e,t,i),o=[n.snapPoint.x+this.translateX,n.snapPoint.y+this.translateY,void 0!=n.snapPoint.z?n.snapPoint.z:-1],a=["None","Vertex","PointOnLine","Inner","PointInText","FootPoint","MiddlePoint","EndPoint"];return{GetPoint:function(){return o},GetID:function(){return n.snapID},GetSnapType:function(){return n.snapType},GetSnapTypeName:function(){return n.snapType<a.length?a[n.snapType]:a[0]}}}},{key:"snapToPoint2",value:function(e,t,i,n,o){void 0==o&&(o=this.snapDistance);var a=this.viewer.SnapToPoint2(e,t,i,n,o),r={x:a.snapPoint.x+this.translateX,y:a.snapPoint.y+this.translateY,z:void 0!=a.snapPoint.z?a.snapPoint.z:-1},s=["None","Vertex","PointOnLine","Inner","PointInText","FootPoint","MiddlePoint","EndPoint"];return{GetPoint:function(){return r},GetID:function(){return a.snapID},GetSnapType:function(){return a.snapType},GetSnapTypeName:function(){return a.snapType<s.length?s[a.snapType]:s[0]}}}},{key:"getZoomFactor",value:function(){var e=this.viewer.GetWorldSize();return this.viewer.GetWorldScale()/Math.min(1/e.x,1/e.y)}},{key:"getState",value:function(){var e={ver:1,WorldScale:this.viewer.GetWorldScale(),ViewAngle:this.viewer.GetViewAngle(),ViewCenter:{x:this.viewer.GetViewCenter().x,y:this.viewer.GetViewCenter().y},ZoomFactor:this.getZoomFactor()};return JSON.stringify(e)}},{key:"setState",value:function(e){var t=JSON.parse(e);if(1!==t.ver)return!1;this.viewer.SetWorldScale(t.WorldScale),this.viewer.SetViewAngle(t.ViewAngle);var i;return i=t.ViewCenter instanceof Array?{x:t.ViewCenter[0],y:t.ViewCenter[1]}:{x:t.ViewCenter.x,y:t.ViewCenter.y},this.viewer.SetViewCenter(i.x,i.y),this.viewer.UpdateViewMatrix(),!0}},{key:"showElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.ShowElementBox(e)}},{key:"showElementBoxByBBox",value:function(e){e&&this.customManager.add([e[0][0],e[0][1]],[e[1][0],e[1][1]])}},{key:"setElementBoxColor",value:function(e,t,i,n){this.customManager.setColor(e,t,i,n)}},{key:"getElementBoxColor",value:function(){return this.customManager.getColor()}},{key:"getElementBoxStyle",value:function(){return this.customManager.getStyle()}},{key:"setElementBoxStyle",value:function(e){this.customManager.setStyle(e)}},{key:"hideElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.HideElementBox(e)}},{key:"clearElementBox",value:function(){this.viewer.ClearElementBox(),this.customManager.clear()}},{key:"getVisibleBoxIds",value:function(){for(var e=[],t=this.viewer.GetVisibleBoxIds(),i=0;i<t.size();++i)e.push(t.get(i));return e}},{key:"enableHighlightEvent",value:function(e){this.sendHighlightMsg=e}},{key:"isHighlightEventEnabled",value:function(){return this.sendHighlightMsg}},{key:"addClickCallback",value:function(e){this.clickCallback=e}},{key:"getClickCallback",value:function(){return this.clickCallback}},{key:"getModelBBox",value:function(){var e=this.viewer.GetModelBBox(),t=e.GetMinPt(),i=e.GetMaxPt();return{GetMinPt:function(){return[t.x+this.translateX,t.y+this.translateY,t.z]},GetMaxPt:function(){return[i.x+this.translateX,i.y+this.translateY,i.z]}}}},{key:"enableSelectInBlock",value:function(){this.viewer.EnableSelectInBlock()}},{key:"disableSelectInBlock",value:function(){this.viewer.DisableSelectInBlock()}},{key:"canSelectInBlock",value:function(){return this.viewer.CanSelectInBlock()}},{key:"getSelectionWithBlock",value:function(){return this.viewer.GetSelectionWithBlock()}},{key:"GetHighlightIdsWithBlock",value:function(){return this.viewer.GetHighlightIdsWithBlock()}},{key:"highlightIdWithBlock",value:function(e,t){this.viewer.HighlightIdWithBlock(e,t)}},{key:"selectIdWithBlock",value:function(e,t){this.viewer.SelectIdWithBlock(e,t)}},{key:"createMinimap",value:function(e,t,i,n){if(0==this.isModelView())return void console.warn("Only model view support minimap.");void 0==this.minimap&&(this.minimap=new f.default(e,t,i,n),this.minimap.setDrawingImpl(this),this.minimap.initialize())}},{key:"enableMinimap",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.enableMiniMap(e)}},{key:"setMinimapBoundingBox",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.setDrawingContentsBbox(e)}},{key:"setMinimapOffset",value:function(e){this.minimap.setOffset(e)}},{key:"hasMinimap",value:function(){return 0==this.isModelView()?void console.warn("Only model view support minimap."):void 0!=this.minimap}},{key:"setGlobalColor",value:function(e){this.dc.customColor=e}},{key:"getGlobalColor",value:function(){return this.dc.customColor}},{key:"setPrintMode",value:function(e){this.dc.setPrintMode(e),"Black"==e?this.viewer.UpdateColorMode(1):"Custom"==e?this.viewer.UpdateColorMode(2):this.viewer.UpdateColorMode(0)}},{key:"setClearColor",value:function(e,t,i,n){this.viewer.SetClearColor(e,t,i,n)}},{key:"setElementColor",value:function(e,t,i,n){this.viewer.setElementColor(e,t,i,n)}},{key:"alignDrawing",value:function(e,t){var i=new Butterfly.Vector2(e[0],e[1]),n=new Butterfly.Vector2(t[0],t[1]);this.viewer.AlignDrawing(i,n)}},{key:"getAlignTranslate",value:function(){var e=this.viewer.GetAlignTranslate();return[e.x,e.y]}},{key:"activeDrawing",value:function(e){this.viewer.ActiveDrawing(e)}},{key:"getActiveDrawing",value:function(){return this.viewer.GetActiveDrawingIndex()}},{key:"getDrawingCount",value:function(){return this.viewer.GetDrawingCount()}}]),e}();t.default=g},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),r=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return o(e,[{key:"initialize",value:function(e,t,i){this.canvasMain=e,this.canvasTemp=t,this.canvasOverlay=i,this.ctxMain=this.canvasMain.getContext("2d"),this.ctxTemp=this.canvasTemp.getContext("2d"),this.ctxOverlay=this.canvasOverlay.getContext("2d"),this.inPath=!1,this.fontSize=12,this.colorTable={},this.faceColorTable={},this.globalOpacity=null,this.Normal=0,this.White=1,this.Black=2,this.Gray=3,this.Custom=4,this.printMode=this.Normal,this.printColorTable={},this.printFaceColorTable={},this.resUrl="",this.images={},this.ignoreImage=!1,this.targetId=0,this.overlayDrawers={},this.customColor=-1}},{key:"drawingOverlay",value:function(e,t,i){var n=this.ctxOverlay;n.clearRect(0,0,e,t);var o=this.overlayDrawers;for(var a in o)o[a](n);i.auxMobileMeasureTool&&i.auxMobileMeasureTool.redraw()}},{key:"setBackgroundColor",value:function(e){this.canvasMain.style.background=e}},{key:"setPrintMode",value:function(e){if("Normal"==e)this.printMode=this.Normal;else if("Gray"==e)this.printMode=this.Gray;else if("Black"==e)this.printMode=this.Black;else if("White"==e)this.printMode=this.White;else{if("Custom"!=e)return;this.printMode=this.Custom}}},{key:"setResourceUrl",value:function(e){this.resUrl=e}},{key:"setGlobalOpacity",value:function(e){this.globalOpacity=e}},{key:"getGlobalOpacity",value:function(){return this.globalOpacity}},{key:"restoreGlobalOpacity",value:function(){this.globalOpacity=null}},{key:"getHexColor",value:function(e){var t=null===this.globalOpacity?1:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printColorTable[e]}return this.colorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.colorTable[e]}},{key:"getFaceColor",value:function(e){var t=null===this.globalOpacity?.9:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printFaceColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printFaceColorTable[e]}return this.faceColorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.faceColorTable[e]}},{key:"resize",value:function(e,t){this.canvasMain.setAttribute("width",e),this.canvasMain.setAttribute("height",t),this.canvasTemp.setAttribute("width",e),this.canvasTemp.setAttribute("height",t),this.canvasOverlay.setAttribute("width",e),this.canvasOverlay.setAttribute("height",t)}},{key:"clearAll",value:function(e,t){this.ctxMain.clearRect(0,0,e,t),this.ctxTemp.clearRect(0,0,e,t),this.ctxOverlay.clearRect(0,0,e,t)}},{key:"SetTarget",value:function(e){0==e?this.ctx=this.ctxMain:(this.ctx=this.ctxTemp,this.ctx.strokeStyle="#ff0000"),this.targetId=e}},{key:"BeginDraw",value:function(e,t){this.ctx.clearRect(t[0],t[1],t[2],t[3])}},{key:"EndDraw",value:function(e){}},{key:"BeginPath",value:function(){this.inPath=!0,this.ctx.beginPath()}},{key:"EndPath",value:function(e,t){this.inPath=!1,e&&(this.ctx.fillStyle=this.getFaceColor(t),this.ctx.closePath(),this.ctx.fill()),this.ctx.stroke()}},{key:"BeginClip",value:function(e){e&&(this.ctx.save(),this.ctx.clip())}},{key:"EndClip",value:function(e){e&&this.ctx.restore()}},{key:"SetLineColor",value:function(e){var t=this.getHexColor(e);this.ctx.strokeStyle=t,this.ctx.fillStyle=t}},{key:"SetLineWidth",value:function(e){this.ctx.lineWidth=e}},{key:"SetLineDash",value:function(e,t){if(0==e)return void this.ctx.setLineDash([]);if(1==e)return void this.ctx.setLineDash([10]);for(var i=[],n=0,o=t.size();n<o;++n)i.push(t.get(n));this.ctx.setLineDash(i)}},{key:"SetFont",value:function(e){this.fontSize=e,this.ctx.font=this.fontSize+"px 仿宋"}},{key:"DrawPoint",value:function(e,t,i){}},{key:"DrawLine",value:function(e,t){if(this.inPath)this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(t[0],t[1]);else{for(var i=this.ctx.getLineDash(),n=0,o=0;o<i.length;++o)n+=i[o];this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])<n*n&&this.ctx.setLineDash([]),this.ctx.lineTo(t[0],t[1]),this.ctx.stroke(),this.ctx.setLineDash(i)}}},{key:"DrawArc",value:function(e,t,i,n){this.inPath?this.ctx.arc(e[0],e[1],t,-i,-n,!0):(this.ctx.beginPath(),this.ctx.arc(e[0],e[1],t,-i,-n,!0),this.ctx.stroke())}},{key:"DrawRec",value:function(e,t){this.inPath?this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]):(this.ctx.beginPath(),this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]),this.ctx.stroke())}},{key:"DrawCloudRec",value:function(e,t,i){var n=e,o=t;i=i||this.ctx,n=[n[0]+18/3.5,n[1]+18/3.5],o=[o[0]-18/3.5,o[1]-18/3.5];var a=o[1]-n[1],r=o[0]-n[0],s=Math.abs(r),l=Math.abs(a),c=parseInt(s/18),u=parseInt(l/18),d=0==c?s:s/c,h=0==u?l:l/u;i.beginPath(),this.drawSide("orientation",d,s,n[0],n[1],i),this.drawSide("orientation",d,s,n[0]+s,n[1]+l,i,!0),this.drawSide("portrait",h,l,n[0]+s,n[1],i),this.drawSide("portrait",h,l,n[0],n[1]+l,i,!0),i.stroke()}},{key:"drawSide",value:function(e,t,i,n,o,a,r){var s=0,l=0,c=i/t,u=void 0,d=n,h=o;"orientation"==e?s=t:l=t;for(var f=0;f<c;f++){a.moveTo(n,o),u=r?[n-s,o-l]:[n+s,o+l],s&&Math.abs(u[0]-d)>i?u[0]=r?d-i:d+i:l&&Math.abs(u[1]-h)>i&&(u[1]=r?h-i:h+i);var g=this.getControlPt([n,o],u);a.quadraticCurveTo(g[0],g[1],u[0],u[1]),n=u[0],o=u[1]}}},{key:"getControlPt",value:function(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=.4*r.default.distanceByArr(e,t),a=[t[1]-e[1],e[0]-t[0]];return a=r.default.normalize(a),[n[0]+a[0]*o,n[1]+a[1]*o]}},{key:"DrawPolyline",value:function(e){var t=e.size();if(!(t<1))if(this.inPath){this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var i=1;i<t;++i)this.pt=e.get(i),this.ctx.lineTo(this.pt[0],this.pt[1])}else{for(var n=this.ctx.getLineDash(),o=0,a=0;a<n.length;++a)o+=n[a];this.ctx.beginPath(),this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var r=1;r<t;++r){var s=(this.pt[0]-e.get(r)[0])*(this.pt[0]-e.get(r)[0])+(this.pt[1]-e.get(r)[1])*(this.pt[1]-e.get(r)[1]);s<o*o?this.ctx.setLineDash([]):this.ctx.setLineDash(n),this.pt=e.get(r),this.ctx.lineTo(this.pt[0],this.pt[1]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.pt[0],this.pt[1])}this.ctx.setLineDash(n)}}},{key:"DrawText",value:function(e,t){this.ctx.fillText(e,t[0],t[1])}},{key:"DrawTextW",value:function(e,t,i){0!=i?(this.ctx.save(),this.ctx.translate(t[0],t[1]),this.ctx.rotate(i),this.ctx.fillText(e,0,0),this.ctx.restore()):this.ctx.fillText(e,t[0],t[1])}},{key:"DrawImageImpl",value:function(e,t,i,n,o,a,r){function s(t,i,n,o,a,r){0==r?e.drawImage(t,i,n,o,a):(e.save(),e.translate(i,n+a),e.rotate(r),e.drawImage(t,0,-a,o,a),e.restore())}var l=this,c=l.images[t];if(l.ignoreImage)return!1;void 0===c?(c=new Image,c.onload=function(){s(c,i,n,o,a,r),l.images[t]=c},c.src=t):s(c,i,n,o,a,r)}},{key:"DrawImage",value:function(e,t,i,n,o,a){this.DrawImageImpl(this.ctx,this.resUrl+"image/"+e,t,i,n,o,a)}}],[{key:"create",value:function(t,i,n){var o=new e;return o.initialize(t,i,n),o}}]),e}();t.default=s},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e),this.revitIds={}}return o(e,[{key:"initialize",value:function(e){function t(e){return new Promise(function(t,i){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200==n.status?t(JSON.parse(n.response)):i(n.statusText)},n.send()})}var i=this;i.revitIds={},i.linkRevitIds={},i.revitToCad={};var n=e.getModel().Url,o=n+"revitIds.json.gz",a=n+"index.json",r=!1;t(o).then(function(e){return i.revitIds=e,t(a)},function(e){console.warn(e)}).then(function(e){if(e.metadata.hasOwnProperty("links")&&""!=e.metadata.links)return r=!0,a=n+e.metadata.links,t(a)}).then(function(o){if(0!=r){i.linkRevitIds=o,o&&e.enableSelectInBlock();var a=[],s=[];for(var l in i.linkRevitIds)if(0!=l){var c=n+"links/"+l+".json.gz",u=t(c);s.push(u),a.push(l)}Promise.all(s).then(function(e){for(var t=0;t<e.length;t++){var n=e[t],o={};for(var r in n)i.revitIds[r]=n[r],o.hasOwnProperty(n[r])||(o[n[r]]=[]),o[n[r]].push(r);var s=a[t];i.revitToCad[i.linkRevitIds[s]]=o}})}},function(e){console.warn(e)})}},{key:"toRevitId",value:function(e){return this.revitIds[e]}},{key:"toLinkRevitId",value:function(e,t){return 0==e||void 0==this.linkRevitIds?this.toRevitId(t):this.linkRevitIds.hasOwnProperty(e)?{fileId:this.linkRevitIds[e],revitId:this.toRevitId(t)}:this.toRevitId(e)}},{key:"fromRevitId",value:function(e){var t=this.revitIds;for(var i in t)if(t[i]==e)return i}},{key:"fromLinkRevitId",value:function(e,t){if(0==e||void 0==this.linkRevitIds||""==e)return this.fromRevitId(t);var i=0;for(var n in this.linkRevitIds)this.linkRevitIds[n]==e&&(i=n);var o=this.revitToCad[e];return o?{blockId:i,ids:o[t]}:null}}]),e}();t.default=a}]),window.Glodon=Glodon;